     1                                  ; -----------------------------------------------------------------------------
     2                                  ; \file  start.asm
     3                                  ; \note  (c) 2025 by Jens Kallup - paule32
     4                                  ;        all rights reserved.
     5                                  ;
     6                                  ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                                  ; -----------------------------------------------------------------------------
     8                                  %include 'basexx.inc'
     1                              <1> ;---------------------------------------------------
     2                              <1> ; \file  bitsXX.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ;---------------------------------------------------
     8                              <1> default rel
     9                              <1> 
    10                              <1> %define IMAGEBASE    0x0000000140000000
    11                              <1> %define FILEALIGN    0x200      ; 512
    12                              <1> %define SECTALIGN    0x1000
    13                              <1> 
    14                              <1> %define IMAGE_BASE   IMAGEBASE
    15                              <1> 
     9                                  %include 'windows.inc'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  windows.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> 
     9                              <1> ; -----------------------------------------------------------------------------
    10                              <1> ; CPU machine ...
    11                              <1> ; -----------------------------------------------------------------------------
    12                              <1> %define IMAGE_FILE_MACHINE_AMD64        0x8664  ; x64
    13                              <1> %define IMAGE_FILE_MACHINE_I386         0x14c   ; Intel 386 or later
    14                              <1> %define IMAGE_FILE_MACHINE_IA64         0x200   ; Intel Itanium processor family
    15                              <1> 
    16                              <1> ; -----------------------------------------------------------------------------
    17                              <1> ; COFF + PE32 header ...
    18                              <1> ; -----------------------------------------------------------------------------
    19                              <1> %define IMAGE_FILE_RELOCS_STRIPPED      0x0001
    20                              <1> %define IMAGE_FILE_EXECUTABLE_IMAGE     0x0002
    21                              <1> %define IMAGE_FILE_LOCAL_SYMS_STRIPPED  0x0008
    22                              <1> %define IMAGE_FILE_AGGRESSIVE_WS_TRIM   0x0010
    23                              <1> %define IMAGE_FILE_LARGE_ADDRESS_AWARE  0x0020
    24                              <1> %define IMAGE_FILE_32BIT_MACHINE        0x0100
    25                              <1> %define IMAGE_FILE_DEBUG_STRIPPED       0x0200
    26                              <1> %define IMAGE_FILE_DLL                  0x2000
    27                              <1> 
    28                              <1> %define IMAGE_IS_FILE_EXE   IMAGE_FILE_EXECUTABLE_IMAGE    |                            IMAGE_FILE_LARGE_ADDRESS_AWARE
    30                              <1> ; -----------------------------------------------------------------------------
    31                              <1> %define IMAGE_IS_FILE_DLL   IMAGE_FILE_DLL                 |                            IMAGE_FILE_LARGE_ADDRESS_AWARE
    33                              <1> 
    34                              <1> ; -----------------------------------------------------------------------------
    35                              <1> ; DLL Characteristics
    36                              <1> ; -----------------------------------------------------------------------------
    37                              <1> %define IMAGE_DLLCHARACTERISTICS_NX_COMPAT  0x0100  ; Image is NX compatible.
    38                              <1> %define IMAGE_DLLCHARACTERISTICS_NO_SEH     0x0400  ; no SEH
    39                              <1> 
    40                              <1> ; -----------------------------------------------------------------------------
    41                              <1> ; win32 constants
    42                              <1> ; -----------------------------------------------------------------------------
    43                              <1> %define SW_SHADOW            32       ; 32-Byte Shadow Space pro CALL
    44                              <1> 
    45                              <1> %define WS_OVERLAPPEDWINDOW  0x00CF0000
    46                              <1> %define CW_USEDEFAULT        0x80000000
    47                              <1> %define SW_SHOWDEFAULT       10
    48                              <1> 
    49                              <1> %define IDC_ARROW            32512
    50                              <1> 
    51                              <1> %define COLOR_WINDOW         5
    52                              <1> 
    53                              <1> %define FOREGROUND_BLUE      0x0001
    54                              <1> %define FOREGROUND_GREEN     0x0002
    55                              <1> %define FOREGROUND_RED       0x0004
    56                              <1> %define FOREGROUND_INTENSITY 0x0008
    57                              <1> 
    58                              <1> ; -----------------------------------------------------------------------------
    59                              <1> ; Window Messages ...
    60                              <1> ; -----------------------------------------------------------------------------
    61                              <1> %define WM_CLOSE            0x0010
    62                              <1> %define WM_COMMAND          0x0111
    63                              <1> %define WM_ERASEBKGND       0x0014
    64                              <1> %define WM_SYSCOMMAND       0x0112
    65                              <1> 
    66                              <1> ; -----------------------------------------------------------------------------
    67                              <1> ; window style constant's ...
    68                              <1> ; -----------------------------------------------------------------------------
    69                              <1> %define SWP_FRAMECHANGED    0x0020
    70                              <1> %define SWP_NOACTIVATE      0x0010
    71                              <1> %define SWP_NOMOVE          0x0002
    72                              <1> %define SWP_NOSIZE          0x0001
    73                              <1> %define SWP_NOZORDER        0x0004
    74                              <1> %define SWP_SHOWWINDOW      0x0040
    75                              <1> 
    76                              <1> %define GWL_STYLE           -16
    77                              <1> 
    78                              <1> ; -----------------------------------------------------------------------------
    79                              <1> ; Konstanten
    80                              <1> ; -----------------------------------------------------------------------------
    81                              <1> %define WS_CAPTION           0x00C00000
    82                              <1> %define WS_MAXIMIZEBOX       0x00010000
    83                              <1> %define WS_MINIMIZEBOX       0x00020000
    84                              <1> %define WS_OVERLAPPED        0x00000000
    85                              <1> %define WS_OVERLAPPEDWINDOW  ( WS_OVERLAPPED                               | WS_CAPTION                                  | WS_SYSMENU                                  | WS_THICKFRAME                               | WS_MINIMIZEBOX                              | WS_MAXIMIZEBOX )
    91                              <1> %define WS_SIZEBOX           0x00040000    ; = WS_THICKFRAME
    92                              <1> %define WS_SYSMENU           0x00080000
    93                              <1> 
    94                              <1> %define SW_SHOWDEFAULT       10
    95                              <1> %define WS_THICKFRAME        0x00040000
    96                              <1> 
    97                              <1> %define CW_USEDEFAULT        0x80000000
    98                              <1> %define CS_HREDRAW           0x0002
    99                              <1> %define CS_VREDRAW           0x0001
   100                              <1> 
   101                              <1> ; -----------------------------------------------------------------------------
   102                              <1> ; menu flag constant's ...
   103                              <1> ; -----------------------------------------------------------------------------
   104                              <1> %define MF_BYCOMMAND         0x00000000
   105                              <1> %define MF_GRAYED            0x00000001
   106                              <1> 
   107                              <1> ; -----------------------------------------------------------------------------
   108                              <1> ; window color constant's ...
   109                              <1> ; -----------------------------------------------------------------------------
   110                              <1> %define COLOR_WINDOW         5
   111                              <1> %define GCLP_HBRBACKGROUND  -10
   112                              <1> 
   113                              <1> ; -----------------------------------------------------------------------------
   114                              <1> ; system context constant's (system menu of windows) ...
   115                              <1> ; -----------------------------------------------------------------------------
   116                              <1> %define SC_CLOSE             0xF060
   117                              <1> %define SC_MAXIMIZE          0xF030
   118                              <1> %define SC_MINIMIZE          0xF020
   119                              <1> %define SC_RESTORE           0xF120
   120                              <1> %define SC_SIZE              0xF000
   121                              <1> 
   122                              <1> ; -----------------------------------------------------------------------------
   123                              <1> ; cursor arrow id's ...
   124                              <1> ; -----------------------------------------------------------------------------
   125                              <1> %define IDC_ARROW            32512
   126                              <1> 
   127                              <1> ; -----------------------------------------------------------------------------
   128                              <1> ; Message Box's ...
   129                              <1> ; -----------------------------------------------------------------------------
   130                              <1> %define MB_OK         0x00000000
   131                              <1> %define MB_ICONERROR  0x00000010
   132                              <1> 
   133                              <1> ; -----------------------------------------------------------------------------
   134                              <1> ; text console handle's for stdin, stdout, and stderr ...
   135                              <1> ; -----------------------------------------------------------------------------
   136                              <1> %define STD_INPUT_HANDLE  -10
   137                              <1> %define STD_OUTPUT_HANDLE -11
   138                              <1> %define STD_ERROR_HANDLE  -12
   139                              <1> 
   140                              <1> ; Console mode bits (wincon.h)
   141                              <1> %define ENABLE_PROCESSED_INPUT  0x0001
   142                              <1> %define ENABLE_LINE_INPUT       0x0002
   143                              <1> %define ENABLE_ECHO_INPUT       0x0004
   144                              <1> %define ENABLE_WINDOW_INPUT     0x0008     ; optional für Window-Events (nicht nötig für KEY_EVENT)
   145                              <1> %define ENABLE_PROCESSED_INPUT  0x0001
   146                              <1> %define ENABLE_QUICK_EDIT_MODE  0x0040
   147                              <1> %define ENABLE_EXTENDED_FLAGS   0x0080
   148                              <1> 
   149                              <1> ; INPUT_RECORD.EventType
   150                              <1> %define KEY_EVENT               0x0001
   151                              <1> 
   152                              <1> ; -----------------------------------------------------------------------------
   153                              <1> ; code page constant's ...
   154                              <1> ; -----------------------------------------------------------------------------
   155                              <1> %define CP_UTF8 65001
   156                              <1> 
   157                              <1> ; -----------------------------------------------------------------------------
   158                              <1> ; constant's for the monitor ...
   159                              <1> ; -----------------------------------------------------------------------------
   160                              <1> %define MONITOR_DEFAULTTONEAREST 2
   161                              <1> 
   162                              <1> %define DPI_AWARENESS_CONTEXT_PER_MONITOR_AWARE_V2  -4   ; WinUser.h: ((DPI_AWARENESS_CONTEXT)-4)
   163                              <1> 
   164                              <1> ; Console-Mode-Flags (wincon.h)
   165                              <1> %define ENABLE_VIRTUAL_TERMINAL_PROCESSING  0x0004
   166                              <1> %define DISABLE_NEWLINE_AUTO_RETURN         0x0008    ; optional
   167                              <1> %define ENABLE_VIRTUAL_TERMINAL_INPUT       0x0200
   168                              <1> 
   169                              <1> ; -----------------------------------------------------------------------------
   170                              <1> ; DOS ANSI foreground color's   0..15
   171                              <1> ; -----------------------------------------------------------------------------
   172                              <1> %define ATTR_FG_BLACK           30
   173                              <1> %define ATTR_FG_DARK_RED        31
   174                              <1> %define ATTR_FG_DARK_GREEN      32
   175                              <1> %define ATTR_FG_DARK_YELLOW     33
   176                              <1> %define ATTR_FG_DARK_BLUE       34
   177                              <1> %define ATTR_FG_DARK_PURPLE     35
   178                              <1> %define ATTR_FG_DARK_CYAN       36
   179                              <1> %define ATTR_FG_LIGHT_GRAY      37
   180                              <1> ; -----------------------------------------------------------------------------
   181                              <1> %define ATTR_FG_DARK_GRAY       90
   182                              <1> %define ATTR_FG_LIGHT_RED       91
   183                              <1> %define ATTR_FG_LIGHT_GREEN     92
   184                              <1> %define ATTR_FG_LIGHT_YELLOW    93
   185                              <1> %define ATTR_FG_LIGHT_BLUE      94
   186                              <1> %define ATTR_FG_LIGHT_PURPLE    95
   187                              <1> %define ATTR_FG_LIGHT_CYAN      96
   188                              <1> %define ATTR_FG_WHITE           97
   189                              <1> ; -----------------------------------------------------------------------------
   190                              <1> ; DOS ANSI background color's   0..15
   191                              <1> ; -----------------------------------------------------------------------------
   192                              <1> %define ATTR_BG_BLACK           40
   193                              <1> %define ATTR_BG_DARK_RED        41
   194                              <1> %define ATTR_BG_DARK_GREEN      42
   195                              <1> %define ATTR_BG_DARK_YELLOW     43
   196                              <1> %define ATTR_BG_DARK_BLUE       44
   197                              <1> %define ATTR_BG_DARK_PURPLE     45
   198                              <1> %define ATTR_BG_DARK_CYAN       46
   199                              <1> %define ATTR_BG_LIGHT_GRAY      47
   200                              <1> ; -----------------------------------------------------------------------------
   201                              <1> %define ATTR_BG_DARK_GRAY       100
   202                              <1> %define ATTR_BG_LIGHT_RED       101
   203                              <1> %define ATTR_BG_LIGHT_GREEN     102
   204                              <1> %define ATTR_BG_LIGHT_YELLOW    103
   205                              <1> %define ATTR_BG_LIGHT_BLUE      104
   206                              <1> %define ATTR_BG_LIGHT_PURPLE    105
   207                              <1> %define ATTR_BG_LIGHT_CYAN      106
   208                              <1> %define ATTR_BG_WHITE           107
   209                              <1> 
   210                              <1> %define ATTR_DEFAULT        ATTR_BG_BLACK | ATTR_FG_GRAY   ; Hellgrau auf Schwarz
   211                              <1> 
   212                              <1> ; -----------------------------------------------------------------------------
   213                              <1> ; format flags (often used for debug messages) ...
   214                              <1> ; -----------------------------------------------------------------------------
   215                              <1> %define FORMAT_MESSAGE_ALLOCATE_BUFFER 0x00000100
   216                              <1> %define FORMAT_MESSAGE_IGNORE_INSERTS  0x00000200
   217                              <1> %define FORMAT_MESSAGE_FROM_SYSTEM     0x00001000
   218                              <1> 
   219                              <1> %define FM_FLAGS     FORMAT_MESSAGE_ALLOCATE_BUFFER |     FORMAT_MESSAGE_FROM_SYSTEM     |     FORMAT_MESSAGE_IGNORE_INSERTS
   223                              <1> 
   224                              <1> ; -----------------------------------------------------------------------------
   225                              <1> ; language support ...
   226                              <1> ; -----------------------------------------------------------------------------
   227                              <1> %define LANG_NEUTRAL    0
   228                              <1> %define SUBLANG_DEFAULT 1
   229                              <1> 
   230                              <1> ; für NASM als Zahl nutzen:
   231                              <1> LANGID_DEFAULT  equ (SUBLANG_DEFAULT << 10) | LANG_NEUTRAL
   232                              <1> 
   233                              <1> ; -----------------------------------------------------------------------------
   234                              <1> ; misc
   235                              <1> ; -----------------------------------------------------------------------------
   236                              <1> %define INFINITE                0xFFFFFFFF
   237                              <1> %define WAIT_OBJECT_0           0
    10                                  %include 'usefunc.inc'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  usefunc.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> 
     9                              <1> ; -----------------------------------------------------------------------------
    10                              <1> ; user32.dll functions ...
    11                              <1> ; -----------------------------------------------------------------------------
    12                              <1> %define USER32_FUNCS                    CreateWindowExW,                                                        DefWindowProcW,                     DispatchMessageW,                   DrawMenuBar,                                                            EnableMenuItem,                     FillRect,                                                               GetClassLongPtrW,                   GetClientRect,                      GetMessageW,                        GetMonitorInfoW,                    GetSysColorBrush,                   GetSystemMenu,                                                          GetWindowLongPtrA,                  GetWindowRect,                                                          LoadCursorW,                                                            MessageBoxA,                        MessageBoxW,                                                            MonitorFromWindow,                  MoveWindow,                                                             Register...
    53                              <1> 
    54                              <1> ; -----------------------------------------------------------------------------
    55                              <1> ; kernel32.dll functions ...
    56                              <1> ; -----------------------------------------------------------------------------
    57                              <1> %define KERNEL32_FUNCS                  lstrlenA,                                                               AllocConsole,                       ExitProcess,                                                            FormatMessageW,                                                         FillConsoleOutputAttribute,         FillConsoleOutputCharacterW,                                            GetConsoleMode,                     GetConsoleScreenBufferInfo,         GetConsoleWindow,                                                       GetCurrentConsoleFont,                                                  GetLargestConsoleWindowSize,        GetLastError,                       GetModuleHandleW,                   GetProcAddress,                     GetStdHandle,                                                           LoadLibraryA,                       LocalFree,                                                              ReadConsoleA,                       ReadConsoleInputW,                  ReadCons...
   104                              <1> 
   105                              <1> ; -----------------------------------------------------------------------------
   106                              <1> ; msvcrt.dll functions ...
   107                              <1> ; -----------------------------------------------------------------------------
   108                              <1> %define MSVCRT_FUNCS                    fgets,                              scanf,                              sprintf,                            printf, puts
    11                                  
    12                                  %include 'macros.inc'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  macros.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> 
     9                              <1> ; -----------------------------------------------------------------------------
    10                              <1> ; \brief some pre-defines, to make maintain easier ...
    11                              <1> ; -----------------------------------------------------------------------------
    12                              <1> %define ERROR_Win32API 'this macro can only be use with win32api (Windows).'
    13                              <1> 
    14                              <1> ; -----------------------------------------------------------------------------
    15                              <1> ; \brief DOS error codes for int 0x21 - 3Dh
    16                              <1> ; -----------------------------------------------------------------------------
    17                              <1> %define ERROR_INVALID_FUNCTION      0x01
    18                              <1> %define ERROR_FILE_NOT_FOUND        0x02
    19                              <1> %define ERROR_PATH_NOT_FOUND        0x03
    20                              <1> %define ERROR_TOO_MANY_OPEN_FILES   0x04
    21                              <1> %define ERROR_ACCESS_DENIED         0x05
    22                              <1> %define ERROR_INVALID_HANDLE        0x06
    23                              <1> %define ERROR_ARENA_TRASHED         0x07
    24                              <1> %define ERROR_NOT_ENOUGH_MEMORY     0x08
    25                              <1> %define ERROR_INVALID_ACCESS        0x0C
    26                              <1> %define ERROR_INVALID_DRIVE         0x0F
    27                              <1> %define ERROR_CURRENT_DIRECTORY     0x10
    28                              <1> %define ERROR_NOT_SAME_DEVICE       0x11
    29                              <1> %define ERROR_NO_MORE_FILES         0x12
    30                              <1> %define ERROR_SEEK                  0x1D
    31                              <1> %define ERROR_NOT_DOS_DISK          0x1E
    32                              <1> 
    33                              <1> ; -----------------------------------------------------------------------------
    34                              <1> ; \brief DOS file open modes ...
    35                              <1> ; -----------------------------------------------------------------------------
    36                              <1> %define DOS_READ_ONLY   0x00    ; read  only
    37                              <1> %define DOS_WRITE_ONLY  0x01    ; write only
    38                              <1> %define DOS_READWRITE   0x02    ; read/write
    39                              <1> 
    40                              <1> ; -----------------------------------------------------------------------------
    41                              <1> ; \brief DOS file seek constants ...
    42                              <1> ; -----------------------------------------------------------------------------
    43                              <1> %define SEEK_BEGIN      0x00    ; begin of file
    44                              <1> %define SEEK_SET        0x01    ; current position
    45                              <1> %define SEEK_END        0x02    ; file end
    46                              <1> 
    47                              <1> ; -----------------------------------------------------------------------------
    48                              <1> ; \brief DOS console settings ...
    49                              <1> ; -----------------------------------------------------------------------------
    50                              <1> %define ATTR_DOS_ERROR              0x0E | 0x10     ; yeloow on blue bakcground
    51                              <1> 
    52                              <1> %define MAX_ARGV        32      ; maximum count of command line arguments
    53                              <1> 
    54                              <1> ; -----------------------------------------------------------------------------
    55                              <1> ; \brief DOS 16-Bit applications handles the offsets of symbols otherwise as
    56                              <1> ;        Windows 32 or 64-Bit.
    57                              <1> ; -----------------------------------------------------------------------------
    58                              <1> %ifndef PTR16
    59                              <1> %define PTR16(sym) (sym-code16_start+0x100)
    60                              <1> %endif
    61                              <1> 
    62                              <1> ; -----------------------------------------------------------------------------
    63                              <1> ; \brief Windows 32 or 64-Bit applications handles the offsets of symbols other
    64                              <1> ;        wise as DOS 16-Bit programs.
    65                              <1> ; -----------------------------------------------------------------------------
    66                              <1> %ifndef PTR64
    67                              <1> %define PTR64(sym) (IMAGE_BASE + RVA_DATA(sym))
    68                              <1> %endif
    69                              <1> 
    70                              <1> ; -----------------------------------------------------------------------------
    71                              <1> ; \brief pre-processor variables and constants ...
    72                              <1> ; \note  __pre_stop -> nasm does not have a return or exit directive to stop
    73                              <1> ;                      the pre-processing. But, we can tell nasm, to use a var
    74                              <1> ;                      to sign: "stop pre-processing, and handle all following
    75                              <1> ;                      directives as rejected."
    76                              <1> ; -----------------------------------------------------------------------------
    77                              <1> %assign __pre_stop 0        ; only display one error, if __pre_stop == 1 !
    78                              <1> %assign __vargs    0        ; number of command line arguments
    79                              <1> 
    80                              <1> ; -----------------------------------------------------------------------------
    81                              <1> ; \brief  get the positional argument of a command line parameter in console.
    82                              <1> ; \param  1. <id> -> ARGV_n where n can be 1..32 (MAX_ARGV == 32).
    83                              <1> ; \return __vargs <imm> -> the number of the parameter > 0
    84                              <1> ; -----------------------------------------------------------------------------
    85                              <1> %macro GET_VARGS 2
    86                              <1>     %if __pre_stop == 0
    87                              <1>         %assign __count 0
    88                              <1>         %assign __vargs 0
    89                              <1>         %assign __stop  0
    90                              <1>         %rep MAX_ARGV
    91                              <1>             %if __stop == 0
    92                              <1>                 %assign __count (__count + 1)
    93                              <1>                 %ifidni %1,  ARGV_%+__count
    94                              <1>                     %assign __vargs __count
    95                              <1>                     %assign __stop 1
    96                              <1>                     %assign _%2 __count  ; the _%2 there is a pitfail: todo!
    97                              <1>                 %endif
    98                              <1>             %endif
    99                              <1>         %endrep
   100                              <1>         %undef __count
   101                              <1>         %undef __stop
   102                              <1>     %endif
   103                              <1> %endmacro
   104                              <1> 
   105                              <1> ; -----------------------------------------------------------------------------
   106                              <1> ; \brief display a nasm error message with macro argument %1. Then the
   107                              <1> ;        __pre_stop pre-processor variable will set to 1.
   108                              <1> ;        (1 -> ignore all next macros)
   109                              <1> ; -----------------------------------------------------------------------------
   110                              <1> %macro EMIT_ERROR 1
   111                              <1>     %if __pre_stop == 0
   112                              <1>         EMIT_ERROR 1
   113                              <1>         %assign __pre_stop 1
   114                              <1>     %endif
   115                              <1> %endmacro
   116                              <1> 
   117                              <1> ; -----------------------------------------------------------------------------
   118                              <1> ; \brief display a nasm warning message with macro argument %1. Then the
   119                              <1> ;        __pre_stop pre-processor variable will set to 1.
   120                              <1> ;        (1 -> ignore all next macros)
   121                              <1> ; -----------------------------------------------------------------------------
   122                              <1> %macro EMIT_WARN 1
   123                              <1>     %if __pre_stop == 0
   124                              <1>         EMIT_ERROR 1
   125                              <1>         %assign __pre_stop 1
   126                              <1>     %endif
   127                              <1> %endmacro
   128                              <1> 
   129                              <1> ; -----------------------------------------------------------------------------
   130                              <1> ; \brief perform a system call (in this case a DOS int 0x21 call)
   131                              <1> ; -----------------------------------------------------------------------------
   132                              <1> %macro SysCall 0
   133                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   134                              <1>     int 0x21        ; DOS interrupt 0x21
   135                              <1> %else
   136                              <1>     EMIT_ERROR 'todo: windows'
   137                              <1> %endif
   138                              <1> %endmacro
   139                              <1> 
   140                              <1> ; -----------------------------------------------------------------------------
   141                              <1> ; \brief perform a video call. It is only used in DOS 16-Bit applications.
   142                              <1> ; -----------------------------------------------------------------------------
   143                              <1> %macro VideoCall 0
   144                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   145                              <1>     int 0x10
   146                              <1> %else
   147                              <1>     EMIT_ERROR 'only DOS supports interrupts.'
   148                              <1> %endif
   149                              <1> %endmacro
   150                              <1> 
   151                              <1> ; -----------------------------------------------------------------------------
   152                              <1> ; add win64 abi shadow ...
   153                              <1> ; -----------------------------------------------------------------------------
   154                              <1> %macro AddShadow 0-1
   155                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <1>     EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <1> %else
   158                              <1>     %if __pre_stop == 0
   159                              <1>         %if %0 == 1
   160                              <1>             sub rsp, %1
   161                              <1>         %else
   162                              <1>             sub rsp, SW_SHADOW
   163                              <1>         %endif
   164                              <1>     %endif
   165                              <1> %endif
   166                              <1> %endmacro
   167                              <1> 
   168                              <1> ; -----------------------------------------------------------------------------
   169                              <1> ; delete added win64 abi shadow ...
   170                              <1> ; -----------------------------------------------------------------------------
   171                              <1> %macro DelShadow 0-1
   172                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <1>     EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <1> %else
   175                              <1>     %if __pre_stop == 0
   176                              <1>         %if %0 == 1
   177                              <1>             add rsp, %1
   178                              <1>         %else
   179                              <1>             add rsp, SW_SHADOW
   180                              <1>         %endif
   181                              <1>     %endif
   182                              <1> %endif
   183                              <1> %endmacro
   184                              <1> 
   185                              <1> ; -----------------------------------------------------------------------------
   186                              <1> ; MAKE_INT <Label>, <Func1>, <Func2>, ...
   187                              <1> ; -----------------------------------------------------------------------------
   188                              <1> %macro MAKE_INT 2-*
   189                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   190                              <1>     EMIT_ERROR 'MAKE_INT is only used for Windows 10+ 64-Bit development.'
   191                              <1> %else
   192                              <1>     %if __pre_stop == 0
   193                              <1>     %1:
   194                              <1>         %assign __n %0-1
   195                              <1>         %rep __n
   196                              <1>             dq RVA_IDATA(HN_win32_%2)
   197                              <1>             %rotate 1
   198                              <1>         %endrep
   199                              <1>         dq 0
   200                              <1>     %endif
   201                              <1> %endif
   202                              <1> %endmacro
   203                              <1> 
   204                              <1> ; -----------------------------------------------------------------------------
   205                              <1> ; MAKE_IAT <Label>, <Func1>, <Func2>, ...
   206                              <1> ; -----------------------------------------------------------------------------
   207                              <1> %macro MAKE_IAT 2-*
   208                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   209                              <1>     EMIT_ERROR 'MAKE_IAT is only used for Windows 10+ 64-Bit development.'
   210                              <1> %else
   211                              <1>     %if __pre_stop == 0
   212                              <1>         iat_win32_%1:
   213                              <1>         %assign __n %0-1
   214                              <1>         %rep __n
   215                              <1>             IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <1>             %rotate 1
   217                              <1>         %endrep
   218                              <1>         dq 0
   219                              <1>     %endif
   220                              <1> %endif
   221                              <1> %endmacro
   222                              <1> 
   223                              <1> ; -----------------------------------------------------------------------------
   224                              <1> ; HNSTR <Func1>, <Func2>, ...
   225                              <1> ; -----------------------------------------------------------------------------
   226                              <1> %macro HNSTR 1-*
   227                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   228                              <1>     EMIT_ERROR 'HNSTR is only used for Windows 10+ 64-Bit development.'
   229                              <1> %else
   230                              <1>     %if __pre_stop == 0
   231                              <1>         %assign __n %0
   232                              <1>         %rep __n
   233                              <1>             HN_win32_%1: dw 0
   234                              <1>             db %str(%1), 0
   235                              <1>             %rotate 1
   236                              <1>         %endrep
   237                              <1>     %endif
   238                              <1> %endif
   239                              <1> %endmacro
   240                              <1> 
   241                              <1> ; -----------------------------------------------------------------------------
   242                              <1> ; MAKE_IMPORT <dir_label>, <mod1>, <mod2>, ...
   243                              <1> ; erzeugt:
   244                              <1> ; dir_label:
   245                              <1> ;   dd RVA_IDATA(INT_<mod>), 0,0, RVA_IDATA(dll_<mod>), RVA_IDATA(iat_<mod>) ...
   246                              <1> ;   dd 0,0,0,0,0
   247                              <1> ; dir_label_end:
   248                              <1> ; -----------------------------------------------------------------------------
   249                              <1> %macro MAKE_IMPORT 1-*
   250                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   251                              <1>     EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   252                              <1> %else
   253                              <1>     %if __pre_stop == 0
   254                              <1>         %define __DIR %1
   255                              <1>         %1:
   256                              <1>         %assign __n %0-1
   257                              <1>         %rep __n
   258                              <1>             dd RVA_IDATA(INT_win32_%2)
   259                              <1>             dd 0,0
   260                              <1>             dd RVA_IDATA(dll_win32_%2)
   261                              <1>             dd RVA_IDATA(iat_win32_%2)
   262                              <1>             %rotate 1
   263                              <1>         %endrep
   264                              <1>             dd 0,0,0,0,0
   265                              <1>         __DIR %+ _end:
   266                              <1>         %undef __DIR
   267                              <1>     %endif
   268                              <1> %endif
   269                              <1> %endmacro
   270                              <1> 
   271                              <1> ; -----------------------------------------------------------------------------
   272                              <1> ; mini helper ...
   273                              <1> ; -----------------------------------------------------------------------------
   274                              <1> %macro WIN64_PROLOG 0
   275                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   276                              <1>     EMIT_ERROR 'This macro is only used for Windows 10+ 64-Bit development.'
   277                              <1> %else
   278                              <1>     %if __pre_stop == 0
   279                              <1>         mov rbp, rsp
   280                              <1>         and rsp, -16
   281                              <1>         AddShadow 32         ; Shadow Space
   282                              <1>     %endif
   283                              <1> %endif
   284                              <1> %endmacro
   285                              <1> 
   286                              <1> %macro CALL_IAT 1        ; CALL_IAT ExitProcess / RegisterClassExW / ...
   287                              <1> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <1>     EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <1> %else
   290                              <1>     %if __pre_stop == 0
   291                              <1>         AddShadow
   292                              <1>         mov     rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   293                              <1>         call    [rax]
   294                              <1>         DelShadow
   295                              <1>     %endif
   296                              <1> %endif
   297                              <1> %endmacro
   298                              <1> 
   299                              <1> ; -----------------------------------------------------------------------------
   300                              <1> ; zero register's
   301                              <1> ; -----------------------------------------------------------------------------
   302                              <1> %macro Zero 1
   303                              <1>     %if __pre_stop == 0
   304                              <1>         xor %1, %1
   305                              <1>     %endif
   306                              <1> %endmacro
   307                              <1> 
   308                              <1> ; -----------------------------------------------------------------------------
   309                              <1> ; UTF-16LE aus ASCII (<=0x7F) schnell schreiben
   310                              <1> ; -----------------------------------------------------------------------------
   311                              <1> %ifndef WSTR_DEBUG
   312                              <1>     %if __pre_stop == 0
   313                              <1>         %define WSTR_DEBUG 0
   314                              <1>     %endif
   315                              <1> %endif
   316                              <1> 
   317                              <1> ; -----------------------------------------------------------------------------
   318                              <1> ; WSTR <name>, <items...>
   319                              <1> ; items: Strings ("..."), Zahlen (123, 0x41) oder Ausdrücke/Labels
   320                              <1> ; erzeugt:
   321                              <1> ;   _cW_<name>:              dw ... , 0
   322                              <1> ;   _cW_<name>_end:
   323                              <1> ;   _cW_<name>_length_bytes  equ (_cW_<name>_end - _cW_<name> - 2) ; ohne Terminator
   324                              <1> ;   _cW_<name>_length_words  equ (_cW_<name>_length_bytes/2)
   325                              <1> ; -----------------------------------------------------------------------------
   326                              <1> %macro WSTR 2+
   327                              <1>     %if __pre_stop == 0
   328                              <1>     %push WSTR
   329                              <1> 
   330                              <1>     ; Namen sichern, damit %rotate keine Probleme macht
   331                              <1>     %define _WSTR_LBL   _cW_%1
   332                              <1>     %define _WSTR_END   _cW_%1_end
   333                              <1>     %define _WSTR_LENB  _cW_%1_length_bytes
   334                              <1>     %define _WSTR_LENW  _cW_%1_length_words
   335                              <1> 
   336                              <1> _WSTR_LBL:
   337                              <1>     ; restliche Argumente abarbeiten
   338                              <1>     %assign %$nargs %0-1
   339                              <1>     %rotate 1
   340                              <1> 
   341                              <1>     %rep %$nargs
   342                              <1>         %ifstr %1
   343                              <1>             %strlen %$n %1
   344                              <1>             %assign %$i 0
   345                              <1>             %rep %$n
   346                              <1>                 %substr %$c %1 %$i+1,1
   347                              <1>                 dw %$c                      ; eine 16-bit Code Unit 0x00xx
   348                              <1>                 %assign %$i %$i+1
   349                              <1>             %endrep
   350                              <1>         %elifnum %1
   351                              <1>             dw %1                           ; Zahl/Konstante
   352                              <1>         %else
   353                              <1>             dw %1                           ; Label/Equate/Expression
   354                              <1>         %endif
   355                              <1>         %rotate 1
   356                              <1>     %endrep
   357                              <1> 
   358                              <1>     dw 0                                    ; Null-Terminator (1 Word)
   359                              <1> 
   360                              <1> _WSTR_END:
   361                              <1> _WSTR_LENB  equ (_WSTR_END - _WSTR_LBL - 2) ; Länge in BYTES (ohne Terminator)
   362                              <1> _WSTR_LENW  equ (_WSTR_LENB/2)              ; Länge in WORDS
   363                              <1> 
   364                              <1>     ; Aufräumen
   365                              <1>     %undef _WSTR_LBL
   366                              <1>     %undef _WSTR_END
   367                              <1>     %undef _WSTR_LENB
   368                              <1>     %undef _WSTR_LENW
   369                              <1>     %pop
   370                              <1>     %endif      ; __pre_stop
   371                              <1> %endmacro
   372                              <1> ; -----------------------------------------------------------------------------
   373                              <1> ; WSTRU <name>, <items...>
   374                              <1> ; items:
   375                              <1> ;   - "ASCII/Latin-1-Strings"  -> jedes Zeichen als 16-bit Code Unit 0x00xx
   376                              <1> ;   - Zahlen/Expressions        -> als Unicode-Codepoint interpretiert:
   377                              <1> ;                                 <=0xFFFF (außer Surrogatbereich) -> 1 Word
   378                              <1> ;                                 >0xFFFF -> Surrogatpaar (2 Words)
   379                              <1> ; erzeugt:
   380                              <1> ;   _cW_<name>:              dw ..., 0
   381                              <1> ;   _cW_<name>_end:
   382                              <1> ;   _cW_<name>_length_bytes  equ (_cW_<name>_end - _cW_<name> - 2) ; ohne Terminator
   383                              <1> ;   _cW_<name>_length_words  equ (_cW_<name>_length_bytes/2)
   384                              <1> ; -----------------------------------------------------------------------------
   385                              <1> ; --- Helper: einen Unicode-Codepoint als UTF-16 ausgeben ---
   386                              <1> ; -----------------------------------------------------------------------------
   387                              <1> %macro __WSTR_EMIT_CP 1
   388                              <1>     %if __pre_stop == 0
   389                              <1>         %assign __cp (%1)
   390                              <1> 
   391                              <1>         %if __cp < 0
   392                              <1>             EMIT_ERROR "WSTR: negativer Codepoint"
   393                              <1>         %elif __cp <= 0xFFFF
   394                              <1>             ; verbiete explizite Surrogat-Codepoints
   395                              <1>             %if __cp >= 0xD800 && __cp <= 0xDFFF
   396                              <1>                 EMIT_ERROR "WSTR: Codepoint im Surrogatbereich ist ungueltig"
   397                              <1>             %else
   398                              <1>                 dw __cp
   399                              <1>             %endif
   400                              <1>         %elif __cp <= 0x10FFFF
   401                              <1>             %assign __tmp (__cp - 0x10000)
   402                              <1>             %assign __hi  (0xD800 + (__tmp >> 10))
   403                              <1>             %assign __lo  (0xDC00 + (__tmp & 0x3FF))
   404                              <1>             dw __hi, __lo
   405                              <1>         %else
   406                              <1>             EMIT_ERROR "WSTR: Codepoint > U+10FFFF"
   407                              <1>         %endif
   408                              <1>     %endif
   409                              <1> %endmacro
   410                              <1> 
   411                              <1> ; --- Hauptmakro ---
   412                              <1> %macro WSTRU 2+
   413                              <1>     %if __pre_stop == 0
   414                              <1>     %push WSTRU
   415                              <1> 
   416                              <1>     %define _WSTR_LBL   _cW_%1
   417                              <1>     %define _WSTR_END   _cW_%1_end
   418                              <1>     %define _WSTR_LENB  _cW_%1_length_bytes
   419                              <1>     %define _WSTR_LENW  _cW_%1_length_words
   420                              <1> 
   421                              <1> _WSTR_LBL:
   422                              <1>     %assign %$nargs %0-1
   423                              <1>     %rotate 1
   424                              <1> 
   425                              <1>     %rep %$nargs
   426                              <1>         %ifstr %1
   427                              <1>             ; String: byteweise -> 0x00xx
   428                              <1>             %strlen %$n %1
   429                              <1>             %assign %$i 0
   430                              <1>             %rep %$n
   431                              <1>                 %substr %$c %1 %$i+1,1
   432                              <1>                 dw %$c
   433                              <1>                 %assign %$i %$i+1
   434                              <1>             %endrep
   435                              <1>         %elifnum %1
   436                              <1>             ; Zahl/Expression als Unicode-Scalar
   437                              <1>             __WSTR_EMIT_CP %1
   438                              <1>         %else
   439                              <1>             ; Label/Expression, zur Sicherheit ebenfalls als Codepoint behandeln
   440                              <1>             __WSTR_EMIT_CP %1
   441                              <1>         %endif
   442                              <1>         %rotate 1
   443                              <1>     %endrep
   444                              <1> 
   445                              <1>     dw 0
   446                              <1> 
   447                              <1> _WSTR_END:
   448                              <1> _WSTR_LENB  equ (_WSTR_END - _WSTR_LBL - 2)
   449                              <1> _WSTR_LENW  equ (_WSTR_LENB/2)
   450                              <1> 
   451                              <1>     %undef _WSTR_LBL
   452                              <1>     %undef _WSTR_END
   453                              <1>     %undef _WSTR_LENB
   454                              <1>     %undef _WSTR_LENW
   455                              <1>     %pop
   456                              <1>     %endif      ; __pre_stop
   457                              <1> %endmacro
   458                              <1> 
   459                              <1> ; -----------------------------------------------------------------------------
   460                              <1> ; WSTRUL  <name>, <args...>   -> definiert <name> und <name>_len
   461                              <1> ; (in Codeunits, ohne Null)
   462                              <1> ; -----------------------------------------------------------------------------
   463                              <1> %macro WSTR_AND_LEN 2-*
   464                              <1>     %if __pre_stop == 0
   465                              <1>     %push WSTRUL
   466                              <1>     %define %$name %1
   467                              <1> %1:
   468                              <1>     WSTRU %2
   469                              <1> %$name %+ _end:
   470                              <1>     %xdefine %$name %+ _len ( ((%$name %+ _end) - (%$name))/2 - 1 )
   471                              <1>     %pop
   472                              <1>     %endif
   473                              <1> %endmacro
   474                              <1> 
   475                              <1> ; -----------------------------------------------------------------------------
   476                              <1> ; Nach JEDEM vorhandenen Stringlabel einfach:
   477                              <1> ;   <label>_end:   (direkt nach dem String)
   478                              <1> ; und dann:
   479                              <1> ; -----------------------------------------------------------------------------
   480                              <1> %macro WSTR_LENGTH 1
   481                              <1>     %if __pre_stop == 0
   482                              <1>         %xdefine %1_len ( ((%1_end) - (%1))/2 - 1 )
   483                              <1>     %endif
   484                              <1> %endmacro
   485                              <1> 
   486                              <1> %macro AWSTR 1
   487                              <1> %if __pre_stop == 0
   488                              <1>     %push
   489                              <1>     %strlen __n %1
   490                              <1>     %assign __i 0
   491                              <1>     %rep __n
   492                              <1>         %substr __c %1 __i+1,1
   493                              <1>         dw __c
   494                              <1>         %assign __i __i+1
   495                              <1>     %endrep
   496                              <1>         dw 0
   497                              <1>     %pop
   498                              <1> %endif
   499                              <1> %endmacro
   500                              <1> 
   501                              <1> ; -----------------------------------------------------------------------------
   502                              <1> ; \brief String-Definition mit auto *_length (ohne 0-Byte)
   503                              <1> ; \desc  section .data
   504                              <1> ;        ZSTR cap2A, "Hallo", 13, 10
   505                              <1> ;
   506                              <1> ;        ergibt automatisch:
   507                              <1> ;        cap2A          db "Hallo",13,10,0
   508                              <1> ;        cap2A_end:
   509                              <1> ;        %define cap2A_length (cap2A_end - cap2A - 1)
   510                              <1> ; -----------------------------------------------------------------------------
   511                              <1> %macro ASTR 2+                    ; ASTR <name>, <bytes...>
   512                              <1> %if __pre_stop == 0
   513                              <1>     _cA_%1:       db %2, 0
   514                              <1>     _cA_%1_end:
   515                              <1>     _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <1> %endif
   517                              <1> %endmacro
   518                              <1> 
   519                              <1> ; -----------------------------------------------------------------------------
   520                              <1> ; \brief set the string label from %2 to register %1 ...
   521                              <1> ; -----------------------------------------------------------------------------
   522                              <1> %macro GETEXT 2
   523                              <1> %if __pre_stop == 0
   524                              <1>     mov     %1, IMAGE_BASE
   525                              <1>     add     %1, RVA_DATA(_cW_%2)
   526                              <1> %endif
   527                              <1> %endmacro
   528                              <1> 
   529                              <1> ; ------------------------------------------------------------
   530                              <1> ; ---- RVA-Helfer: bleibt wie bei dir ----
   531                              <1> ; %define RVA_DATA(L)   (DATA_VA  + ((L) - data_start))
   532                              <1> ; ------------------------------------------------------------
   533                              <1> ; Optional: einfacher Alias ohne Klammern/EXPR:
   534                              <1> ; ------------------------------------------------------------
   535                              <1> %imacro DATA_ABS 1
   536                              <1> %if __pre_stop == 0
   537                              <1>     IMAGE_BASE + RVA_DATA(%1)
   538                              <1> %endif
   539                              <1> %endmacro
   540                              <1> ; ------------------------------------------------------------
   541                              <1> ; Helfer: absolute VA einer Data-Variable bauen
   542                              <1> ; ------------------------------------------------------------
   543                              <1> %macro DATA_PTR 1
   544                              <1> %if __pre_stop == 0
   545                              <1>     (IMAGE_BASE + RVA_DATA(%1))
   546                              <1> %endif
   547                              <1> %endmacro
   548                              <1> ; ---------------------------------------------------------------------------
   549                              <1> ;; SETDATA <name>, <src> [, <size>]
   550                              <1> ;  - Schreibt <src> an Datenlabel <name>
   551                              <1> ;  - Wenn <size> fehlt, wird die Größe aus <src>-Register abgeleitet
   552                              <1> ;    (al/ax/eax/rax → 8/16/32/64 Bit). Bei Immediate bitte <size> angeben.
   553                              <1> ;  - <size> darf BYTE/WORD/DWORD/QWORD oder 8/16/32/64 sein.
   554                              <1> ; ---------------------------------------------------------------------------
   555                              <1> ;; Beispiele:
   556                              <1> ; last_error: dd 0
   557                              <1> ; orig_attr:  dw 0
   558                              <1> ; flag8:      db 0
   559                              <1> ; ---------------------------------------------------------------------------
   560                              <1> ;; schreiben (Registergröße bestimmt Breite)
   561                              <1> ; mov   eax, 0xDEADBEEF
   562                              <1> ; SETDATA last_error, eax          ; dword write
   563                              <1> ; ---------------------------------------------------------------------------
   564                              <1> ;; schreiben (Immediate -> Größe angeben)
   565                              <1> ; SETDATA orig_attr, 0x000F, WORD  ; word write
   566                              <1> ; SETDATA flag8,     1,      BYTE  ; byte write
   567                              <1> ; ---------------------------------------------------------------------------
   568                              <1> ;; lesen (Registergröße passt)
   569                              <1> ; GETDATA eax, last_error          ; dword read → eax
   570                              <1> ; ---------------------------------------------------------------------------
   571                              <1> ;; lesen (Größe erzwingen)
   572                              <1> ; GETDATA ax,  orig_attr, WORD     ; word read → ax
   573                              <1> ; GETDATA al,  flag8,     BYTE     ; byte read → al
   574                              <1> ; ---------------------------------------------------------------------------
   575                              <1> %macro SET_DATA 1-3
   576                              <1> %if DOS_SHELL == 1
   577                              <1>     %if __pre_stop == 0
   578                              <1>         %if %0 == 2
   579                              <1>             %ifnum %2
   580                              <1>                 section .text
   581                              <1>                 lea ax, [PTR16(_cA_%1)]
   582                              <1>                 mov ax, %2
   583                              <1>             %endif
   584                              <1>         %elif %0 == 3
   585                              <1>             %ifstr %2
   586                              <1>                 %ifndef __var__%1
   587                              <1>                     %define __var__%1 1
   588                              <1>                     section .data
   589                              <1>                     %%__v: db %2, 0
   590                              <1>                 %endif
   591                              <1>             %endif
   592                              <1>             section .text
   593                              <1>             lea ax, [PTR16(_cA_%1)]
   594                              <1>             mov ax, %2
   595                              <1>             jmp %3
   596                              <1>         %endif
   597                              <1>     %endif
   598                              <1> %else
   599                              <1>     %if __pre_stop == 0
   600                              <1>         EMIT_ERROR 'todo'
   601                              <1>     %endif
   602                              <1> %endif
   603                              <1> %endmacro
   604                              <1> %macro SETDATA 2-3
   605                              <1> %if DOS_SHELL == 1
   606                              <1> %else
   607                              <1>     push    rdx
   608                              <1>     mov     rdx, IMAGE_BASE
   609                              <1>     add     rdx, RVA_DATA(%1)
   610                              <1>     %if %0 = 2
   611                              <1>         mov     [%2], rdx
   612                              <1>         pop     rdx
   613                              <1>     %else
   614                              <1>         pop     rdx
   615                              <1>       %ifidni %3, BYTE
   616                              <1>         mov     byte  [rdx], %2
   617                              <1>       %elifidni %3, WORD
   618                              <1>         mov     word  [rdx], %2
   619                              <1>       %elifidni %3, DWORD
   620                              <1>         mov     dword [rdx], %2
   621                              <1>       %elifidni %3, QWORD
   622                              <1>         mov     qword [rdx], %2
   623                              <1>       %elif %3 = 8
   624                              <1>         mov     byte  [rdx], %2
   625                              <1>       %elif %3 = 16
   626                              <1>         mov     word  [rdx], %2
   627                              <1>       %elif %3 = 32
   628                              <1>         mov     dword [rdx], %2
   629                              <1>       %elif %3 = 64
   630                              <1>         mov     qword [rdx], %2
   631                              <1>       %else
   632                              <1>         EMIT_ERROR "SETDATA: 3rd arg must be BYTE/WORD/DWORD/QWORD or 8/16/32/64"
   633                              <1>       %endif
   634                              <1>     %endif
   635                              <1> %endif
   636                              <1> %endmacro
   637                              <1> 
   638                              <1> ; ------------------------------------------------------------
   639                              <1> ; GETDATA <dst>, <name> [, <size>]
   640                              <1> ;  - Liest aus Datenlabel <name> in Register <dst>
   641                              <1> ;  - Wenn <size> fehlt, muss <dst> die passende Größe haben
   642                              <1> ;    (al/ax/eax/rax). Sonst <size> angeben (BYTE/WORD/DWORD/QWORD oder 8/16/32/64).
   643                              <1> ; ------------------------------------------------------------
   644                              <1> %macro GETDATA 2-3
   645                              <1>     mov     %1, IMAGE_BASE
   646                              <1>     add     %1, RVA_DATA(%2)
   647                              <1>     %if %0 = 2
   648                              <1>         ;mov     %1, [rdx]
   649                              <1>     %else
   650                              <1>       %ifidni %3, BYTE
   651                              <1>         mov     %1, byte  [rdx]
   652                              <1>       %elifidni %3, WORD
   653                              <1>         mov     %1, word  [rdx]
   654                              <1>       %elifidni %3, DWORD
   655                              <1>         mov     %1, dword [rdx]
   656                              <1>       %elifidni %3, QWORD
   657                              <1>         mov     %1, qword [rdx]
   658                              <1>       %elif %3 = 8
   659                              <1>         mov     %1, byte  [rdx]
   660                              <1>       %elif %3 = 16
   661                              <1>         mov     %1, word  [rdx]
   662                              <1>       %elif %3 = 32
   663                              <1>         mov     %1, dword [rdx]
   664                              <1>       %elif %3 = 64
   665                              <1>         mov     %1, qword [rdx]
   666                              <1>       %else
   667                              <1>         EMIT_ERROR "GETDATA: 3rd arg must be BYTE/WORD/DWORD/QWORD or 8/16/32/64"
   668                              <1>       %endif
   669                              <1>     %endif
   670                              <1> %endmacro
   671                              <1> 
   672                              <1> %macro Return 0-1
   673                              <1> %if %0 == 1
   674                              <1>     mov eax, %1
   675                              <1> %else
   676                              <1>     ret
   677                              <1> %endif
   678                              <1> %endmacro
   679                              <1> 
   680                              <1> ; -----------------------------------------------------------------------------
   681                              <1> ; condition jump's after function call -> test eax, eax
   682                              <1> ; -----------------------------------------------------------------------------
   683                              <1> %macro CHECK_NZ 1-2
   684                              <1> %if %0 == 2
   685                              <1>     test eax, eax
   686                              <1>     jnz %1
   687                              <1>     jmp %2
   688                              <1> %else
   689                              <1>     test eax, eax
   690                              <1>     jnz %1
   691                              <1> %endif
   692                              <1> %endmacro
   693                              <1> 
   694                              <1> ; -----------------------------------------------------------------------------
   695                              <1> %macro CHECK_NE 1-2
   696                              <1> %if %0 == 2
   697                              <1>     test eax, eax
   698                              <1>     jne %1
   699                              <1>     jmp %2
   700                              <1> %else
   701                              <1>     test eax, eax
   702                              <1>     jne %1
   703                              <1> %endif
   704                              <1> %endmacro
   705                              <1> 
   706                              <1> ; -----------------------------------------------------------------------------
   707                              <1> %macro CHECK_E 1-2
   708                              <1> %if %0 == 2
   709                              <1>     test eax, eax
   710                              <1>     je  %1
   711                              <1>     jmp %2
   712                              <1> %else
   713                              <1>     test eax, eax
   714                              <1>     je  %1
   715                              <1> %endif
   716                              <1> %endmacro
   717                              <1> 
   718                              <1> ; -----------------------------------------------------------------------------
   719                              <1> ; \brief prolog of a assembler routine + 32 Windows 64 Bit shadow
   720                              <1> ; \param optional shadow at start -> int
   721                              <1> ; -----------------------------------------------------------------------------
   722                              <1> %macro FUNC_ENTER 0-1
   723                              <1> %if %0 == 1
   724                              <1>     AddShadow %1
   725                              <1> %else
   726                              <1>     AddShadow
   727                              <1> %endif
   728                              <1>     push    rbp
   729                              <1>     mov     rbp, rsp
   730                              <1> %endmacro
   731                              <1> 
   732                              <1> ; -----------------------------------------------------------------------------
   733                              <1> ; \brief epilog of a assembler routine - 32 Windows 64 Bit shadow
   734                              <1> ; \param optional shadow at end -> int
   735                              <1> ; -----------------------------------------------------------------------------
   736                              <1> %macro FUNC_LEAVE 0-1
   737                              <1> %if %0 == 1
   738                              <1>     DelShadow %1
   739                              <1> %else
   740                              <1>     DelShadow
   741                              <1> %endif
   742                              <1>     pop     rbp
   743                              <1>     ret
   744                              <1> %endmacro
   745                              <1> 
   746                              <1> ; -----------------------------------------------------------------------------
   747                              <1> ; \brief allocate/open a text console window under Windows 11 desktop.
   748                              <1> ; \param ok  -> label
   749                              <1> ; \param err -> label
   750                              <1> ; \since 1.0
   751                              <1> ;
   752                              <1> ; \return bool - 0 no Error; else Error
   753                              <1> ; -----------------------------------------------------------------------------
   754                              <1> %macro call_AllocConsole 2
   755                              <1> %if DOS_SHELL == 1
   756                              <1>     EMIT_ERROR ERROR_Win32API
   757                              <1> %else
   758                              <1>     CALL_IAT AllocConsole
   759                              <1>     %if %0 == 2
   760                              <1>         CHECK_NZ %1, %2
   761                              <1>     %endif
   762                              <1> %endif
   763                              <1> %endmacro
   764                              <1> 
   765                              <1> ; -----------------------------------------------------------------------------
   766                              <1> ; \brief call the Windows 10 win32api function ExitProcess, to close the thread
   767                              <1> ; -----------------------------------------------------------------------------
   768                              <1> %macro call_ExitProcess 0-1
   769                              <1> %if DOS_SHELL == 1
   770                              <1>     EMIT_ERROR ERROR_Win32API
   771                              <1> %else
   772                              <1>     %if %0 == 1
   773                              <1>         mov rax, %1
   774                              <1>     %else
   775                              <1>         mov rax, 0
   776                              <1>     %endif
   777                              <1>     CALL_IAT ExitProcess
   778                              <1> %endif
   779                              <1> %endmacro
   780                              <1> 
   781                              <1> ; -----------------------------------------------------------------------------
   782                              <1> ; \brief helper function to save source code space for win32api FormatMessageW.
   783                              <1> ; -----------------------------------------------------------------------------
   784                              <1> %macro call_FormatMessageW 0
   785                              <1>     CALL_IAT FormatMessageW
   786                              <1> %endmacro
   787                              <1> 
   788                              <1> ; -----------------------------------------------------------------------------
   789                              <1> ; \brief
   790                              <1> ; -----------------------------------------------------------------------------
   791                              <1> ;macro call_GetConsoleScreenBufferInfo
   792                              <1> ;endmacro
   793                              <1> 
   794                              <1> ; -----------------------------------------------------------------------------
   795                              <1> ; \brief  this macro call the win32api function GetLastError.
   796                              <1> ; \param  nothing
   797                              <1> ; \return ExitCode - int
   798                              <1> ; -----------------------------------------------------------------------------
   799                              <1> %macro call_GetLastError 0
   800                              <1> %if DOS_SHELL == 1
   801                              <1>     EMIT_ERROR ERROR_Win32API
   802                              <1> %else
   803                              <1>     CALL_IAT GetLastError
   804                              <1>     test rax, rax
   805                              <1>     jnz  %%ok
   806                              <1>     AddShadow
   807                              <1>     call HandleLastError
   808                              <1>     DelShadow
   809                              <1> %%ok:
   810                              <1> ;ShowMessageW ShowLastW,capW
   811                              <1> %endif
   812                              <1> %endmacro
   813                              <1> 
   814                              <1> ; -----------------------------------------------------------------------------
   815                              <1> ; \brief  get the standard output device.
   816                              <1> ; \param  ok     -> label
   817                              <1> ; \param  error  -> label
   818                              <1> ; \param  handle -> int
   819                              <1> ; \see    AllocConsole
   820                              <1> ; \since  1.0
   821                              <1> ; \return ?
   822                              <1> ; -----------------------------------------------------------------------------
   823                              <1> %macro call_GetStdHandle 3
   824                              <1> %if DOS_SHELL == 1
   825                              <1>     EMIT_ERROR ERROR_Win32API
   826                              <1> %else
   827                              <1>     mov ecx, %3
   828                              <1>     CALL_IAT GetStdHandle
   829                              <1>     cmp   rax, -1     ; INVALID_HANDLE_VALUE ?
   830                              <1>     je    %%error     ; yes -> error
   831                              <1>     test  rax, rax    ; 0 ?
   832                              <1>     jz    %%error     ; yes -> error
   833                              <1>     ;
   834                              <1>     mov   r12, rax    ; valid handle in rax
   835                              <1>     jmp   %%ok
   836                              <1> %%error:
   837                              <1>     call HandleLastError
   838                              <1>     jmp  %2
   839                              <1> %%ok:
   840                              <1>     jmp  %1
   841                              <1> %endif
   842                              <1> %endmacro
   843                              <1> 
   844                              <1> %macro call_LoadCursorW 0
   845                              <1> %if DOS_SHELL == 1
   846                              <1>     EMIT_ERROR ERROR_Win32API
   847                              <1> %else
   848                              <1>     CALL_IAT LoadCursorW
   849                              <1>     ;ShowMessageW ShowHelloW,capW
   850                              <1>     ;call_GetLastError
   851                              <1> %endif
   852                              <1> %endmacro
   853                              <1> 
   854                              <1> %macro call_LocalFree 0
   855                              <1> %if DOS_SHELL == 1
   856                              <1>     EMIT_ERROR ERROR_Win32API
   857                              <1> %else
   858                              <1>     CALL_IAT MessageBoxW
   859                              <1> %endif
   860                              <1> %endmacro
   861                              <1> 
   862                              <1> ; -----------------------------------------------------------------------------
   863                              <1> ; \brief helper macro to shorten code, and call the win32api MessageBox W
   864                              <1> ; -----------------------------------------------------------------------------
   865                              <1> %macro call_MessageBoxW 0
   866                              <1>     CALL_IAT MessageBoxW
   867                              <1> %endmacro
   868                              <1> 
   869                              <1> ; -----------------------------------------------------------------------------
   870                              <1> ; \brief helper macro to shorten code, and call the win32api function wsprintfW
   871                              <1> ; -----------------------------------------------------------------------------
   872                              <1> %macro call_wsprintfW 0
   873                              <1>     CALL_IAT wsprintfW
   874                              <1> %endmacro
   875                              <1> 
   876                              <1> %macro call_WriteConsoleA 0
   877                              <1> %if DOS_SHELL == 1
   878                              <1>     EMIT_ERROR ERROR_Win32API
   879                              <1> %else
   880                              <1>     CALL_IAT WriteConsoleA
   881                              <1> %endif
   882                              <1> %endmacro
   883                              <1> 
   884                              <1> ; -----------------------------------------------------------------------------
   885                              <1> ; \brief Write - display text on the Windows Console.
   886                              <1> ; \param 1 -> label -> on error
   887                              <1> ; \param 2 -> label -> text to display
   888                              <1> ; \param 3 -> label -> output handle; default is: STD_OUTPUT_HANDLE
   889                              <1> ; \see   AllocConsole
   890                              <1> ; \since 1.0
   891                              <1> ; -----------------------------------------------------------------------------
   892                              <1> %macro call_User_Write 2-3
   893                              <1> %if DOS_SHELL == 1
   894                              <1>     EMIT_ERROR ERROR_Win32API
   895                              <1> %else
   896                              <1> %if %0 == 2
   897                              <1>     call_GetStdHandle %%ok, %1, STD_OUTPUT_HANDLE
   898                              <1> %else
   899                              <1>     call_GetStdHandle %%ok, %1, %3
   900                              <1> %endif
   901                              <1> %%ok:
   902                              <1>     ; --- WriteConsoleA(hOut, fmtHello, hello_len, NULL, NULL) ---
   903                              <1>     mov     rcx, r12                       ; 1. Arg: HANDLE hConsoleOutput
   904                              <1>     mov     rdx, IMAGE_BASE
   905                              <1>     add     rdx, RVA_DATA(%2)              ; 2. Arg: LPCVOID lpBuffer
   906                              <1>     mov     r8d, %2_length                 ; 3. Arg: DWORD nNumberOfCharsToWrite
   907                              <1>     xor     r9d, r9d                       ; lpNumberOfCharsWritten = NULL
   908                              <1>     AddShadow 32 + 8
   909                              <1>     mov     qword [rsp+32], 0              ; 5. Arg: LPVOID lpReserved = NULL
   910                              <1>     call_WriteConsoleA
   911                              <1>     DelShadow 32 + 8
   912                              <1> %endif
   913                              <1> %endmacro
   914                              <1> 
   915                              <1> ; -----------------------------------------------------------------------------
   916                              <1> ; \brief read a string line in console window ...
   917                              <1> ; -----------------------------------------------------------------------------
   918                              <1> %macro call_User_ReadLn 1
   919                              <1>     call user_Console_ReadLn
   920                              <1> %endmacro
   921                              <1> 
   922                              <1> ; -----------------------------------------------------------------------------
   923                              <1> %macro DefWindowProcW 0
   924                              <1>     mov     rax, IMAGE_BASE + RVA_IDATA(IAT_win32_DefWindowProcW)
   925                              <1> %endmacro
   926                              <1> 
   927                              <1> %macro IAT_CreateWindowExW 0
   928                              <1> %if DOS_SHELL == 1
   929                              <1>     EMIT_ERROR ERROR_Win32API
   930                              <1> %else
   931                              <1>     mov     rax, IMAGE_BASE
   932                              <1>     add     rax, RVA_IDATA(IAT_win32_CreateWindowExW)
   933                              <1>     call    [rax]
   934                              <1> %endif
   935                              <1> %endmacro
   936                              <1> ; -----------------------------------------------------------------------------
   937                              <1> 
   938                              <1> ; -----------------------------------------------------------------------------
   939                              <1> ; \brief  DispatchMessageW
   940                              <1> ; \since  1.0
   941                              <1> ; -----------------------------------------------------------------------------
   942                              <1> %macro DispatchMessageW 0
   943                              <1> %if DOS_SHELL == 1
   944                              <1>     EMIT_ERROR ERROR_Win32API
   945                              <1> %else
   946                              <1>     mov     rcx, rsi
   947                              <1>     CALL_IAT DispatchMessageW
   948                              <1> %endif
   949                              <1> %endmacro
   950                              <1> 
   951                              <1> ; -----------------------------------------------------------------------------
   952                              <1> ; \brief  ExitProcess terminate the given application thread.
   953                              <1> ; \since  1.0
   954                              <1> ; \param  exitcode -> integer
   955                              <1> ; \return exitcode -> rax
   956                              <1> ; -----------------------------------------------------------------------------
   957                              <1> %macro ExitProcess 0-1 0
   958                              <1> %if DOS_SHELL == 1
   959                              <1>     EMIT_ERROR ERROR_Win32API
   960                              <1> %else
   961                              <1>     nop
   962                              <1>     ;AddShadow (32 + 16)           ; Shadow Space + 16 B Align
   963                              <1>     mov     ecx,%1
   964                              <1>     CALL_IAT ExitProcess
   965                              <1>     ; no return
   966                              <1>     ;DelShadow (32 + 16)
   967                              <1> %endif
   968                              <1> %endmacro
   969                              <1> 
   970                              <1> ; -----------------------------------------------------------------------------
   971                              <1> ; \brief  GetLastError catches the last error that was occured during win32api
   972                              <1> ;         function call.
   973                              <1> ; \since  1.0
   974                              <1> ; \param  nothing
   975                              <1> ; \return ?
   976                              <1> ; -----------------------------------------------------------------------------
   977                              <1> %macro GETLASTERROR 2
   978                              <1>     test    eax, eax
   979                              <1>     %1      %2
   980                              <1> %endmacro
   981                              <1> 
   982                              <1> %macro GetLastError 0
   983                              <1> %if DOS_SHELL == 1
   984                              <1>     EMIT_ERROR ERROR_Win32API
   985                              <1> %else
   986                              <1>     CALL_IAT GetLastError
   987                              <1> %endif
   988                              <1> %endmacro
   989                              <1> 
   990                              <1> ; -----------------------------------------------------------------------------
   991                              <1> ; \brief  GetMessageW
   992                              <1> ; -----------------------------------------------------------------------------
   993                              <1> %macro GetMessageW 0
   994                              <1> %if DOS_SHELL == 1
   995                              <1>     EMIT_ERROR ERROR_Win32API
   996                              <1> %else
   997                              <1>     mov  rcx, rsi
   998                              <1>     Zero edx
   999                              <1>     Zero r8d
  1000                              <1>     Zero r9d
  1001                              <1>     CALL_IAT GetMessageW
  1002                              <1> %endif
  1003                              <1> %endmacro
  1004                              <1> 
  1005                              <1> ; -----------------------------------------------------------------------------
  1006                              <1> ; \brief  LoadCursorW
  1007                              <1> ; \since  1.0
  1008                              <1> ; \param  id - integer: resource id
  1009                              <1> ; -----------------------------------------------------------------------------
  1010                              <1> %macro LoadCursorW 1
  1011                              <1> %if DOS_SHELL == 1
  1012                              <1>     EMIT_ERROR ERROR_Win32API
  1013                              <1> %else
  1014                              <1>     Zero ecx
  1015                              <1>     mov  edx, %1
  1016                              <1>     CALL_IAT LoadCursorW
  1017                              <1> %endif
  1018                              <1> %endmacro
  1019                              <1> 
  1020                              <1> ; -----------------------------------------------------------------------------
  1021                              <1> ; \brief  MESSAGE is a style shortner for better read expierences ...
  1022                              <1> ; -----------------------------------------------------------------------------
  1023                              <1> %macro MESSAGE 2
  1024                              <1>     cmp     edx, %1
  1025                              <1>     je      .%2
  1026                              <1> %endmacro
  1027                              <1> 
  1028                              <1> ; -----------------------------------------------------------------------------
  1029                              <1> ; \brief ShowMessageW display a wide string message on the desktop screen per
  1030                              <1> ;        the wn32api.
  1031                              <1> ; \since 1.0
  1032                              <1> ; \see   ShowMessageA
  1033                              <1> ;
  1034                              <1> ; \param text_str  -> landet in rdx
  1035                              <1> ; \param title_str -> landet in r8
  1036                              <1> ;
  1037                              <1> ; \param mb_flags  -> optional ( r9d ), default: 0 (MB_OK)
  1038                              <1> ; -----------------------------------------------------------------------------
  1039                              <1> %macro ShowMessageW 2-3
  1040                              <1> %if DOS_SHELL == 1
  1041                              <1>     EMIT_ERROR ERROR_Win32API
  1042                              <1> %else
  1043                              <1>     Zero    ecx             ; hWnd = NULL
  1044                              <1>     mov     rdx, PTR64(%1)  ; lpText
  1045                              <1>     mov     r8,  PTR64(%2)  ; lpCaption    
  1046                              <1> %if %0 == 2                 ; %0 = argument count
  1047                              <1>     xor     r9d, r9d        ; uType = MB_OK
  1048                              <1> %else
  1049                              <1>     mov     r9d, %3         ; uType = argument exists
  1050                              <1> %endif
  1051                              <1>     CALL_IAT MessageBoxW
  1052                              <1> %endif
  1053                              <1> %endmacro
  1054                              <1> 
  1055                              <1> ; -----------------------------------------------------------------------------
  1056                              <1> ; \brief ShowMessageA display a ansi string message on the desktop screen per
  1057                              <1> ;        the wn32api.
  1058                              <1> ; \since 1.0
  1059                              <1> ; \see   ShowMessageW
  1060                              <1> ;
  1061                              <1> ; \param text_str  -> landet in rdx
  1062                              <1> ; \param title_str -> landet in r8
  1063                              <1> ;
  1064                              <1> ; \param mb_flags  -> optional ( r9d ), default: 0 (MB_OK)
  1065                              <1> ; -----------------------------------------------------------------------------
  1066                              <1> %macro ShowMessageA 2-3
  1067                              <1> %if DOS_SHELL == 1
  1068                              <1>     EMIT_ERROR ERROR_Win32API
  1069                              <1> %else
  1070                              <1>     Zero    ecx
  1071                              <1>     mov     rdx, IMAGE_BASE + RVA_DATA(_cA_%1)  ; "MessageBoxW failed"
  1072                              <1>     mov     r8,  IMAGE_BASE + RVA_DATA(_cA_%2)  ; "User32"
  1073                              <1> %if %0 == 2                                     ; %0 = argument count
  1074                              <1>     xor     r9d, r9d                            ; uType = MB_OK
  1075                              <1> %else
  1076                              <1>     mov     r9d, %3                             ; uType = argument exists
  1077                              <1> %endif
  1078                              <1>     CALL_IAT MessageBoxA
  1079                              <1> %endif
  1080                              <1> %endmacro
  1081                              <1> 
  1082                              <1> ; -----------------------------------------------------------------------------
  1083                              <1> ; \brief  ShowWindow shows the window witht the hwnd id in r13.
  1084                              <1> ; \since  1.0
  1085                              <1> ; \param  hwnd -> HWND handle window
  1086                              <1> ; \param  (optional) flag -> integer: default = SW_SHOWDEFAULT
  1087                              <1> ; -----------------------------------------------------------------------------
  1088                              <1> %macro ShowWindow 1-2
  1089                              <1> %if DOS_SHELL == 1
  1090                              <1>     EMIT_ERROR ERROR_Win32API
  1091                              <1> %else
  1092                              <1>     nop
  1093                              <1>     ;AddShadow (32 + 16)           ; Shadow Space + 16 B Align
  1094                              <1>     mov     rcx, %1
  1095                              <1> %if %0 == 2
  1096                              <1>     mov     edx, %2
  1097                              <1> %else
  1098                              <1>     mov     edx, SW_SHOWDEFAULT
  1099                              <1> %endif
  1100                              <1>     CALL_IAT ShowWindow
  1101                              <1>     ;DelShadow (32 + 16)
  1102                              <1> %endif
  1103                              <1> %endmacro
  1104                              <1> 
  1105                              <1> ; -----------------------------------------------------------------------------
  1106                              <1> ; \brief display a message box on top of the Windows 11 desktop.
  1107                              <1> ; \param text   -> str
  1108                              <1> ; \param title  -> str
  1109                              <1> ; \param button -> int
  1110                              <1> ; -----------------------------------------------------------------------------
  1111                              <1> %macro call_ShowMessageW 5
  1112                              <1>     ShowMessageW %3, %4, %5
  1113                              <1>     CHECK_NZ %1, %2
  1114                              <1> %endmacro
  1115                              <1> 
  1116                              <1> ; -----------------------------------------------------------------------------
  1117                              <1> ; \brief  TranslateMessage
  1118                              <1> ; \since  1.0
  1119                              <1> ; -----------------------------------------------------------------------------
  1120                              <1> %macro TranslateMessage 0
  1121                              <1> %if DOS_SHELL == 1
  1122                              <1>     EMIT_ERROR ERROR_Win32API
  1123                              <1> %else
  1124                              <1>     mov     rcx, rsi
  1125                              <1>     CALL_IAT TranslateMessage
  1126                              <1> %endif
  1127                              <1> %endmacro
  1128                              <1> 
  1129                              <1> ; -----------------------------------------------------------------------------
  1130                              <1> ; \brief  UpdateWindow refresh the window properties and draw.
  1131                              <1> ; \since  1.0
  1132                              <1> ;
  1133                              <1> ; \see    Invalidate
  1134                              <1> ; \see    Repaint
  1135                              <1> ;
  1136                              <1> ; \param  hwnd -> HWND handle of window to update
  1137                              <1> ; -----------------------------------------------------------------------------
  1138                              <1> %macro UpdateWindow 1
  1139                              <1> %if DOS_SHELL == 1
  1140                              <1>     EMIT_ERROR ERROR_Win32API
  1141                              <1> %else
  1142                              <1>     mov     rcx, %1
  1143                              <1>     CALL_IAT UpdateWindow
  1144                              <1> %endif
  1145                              <1> %endmacro
  1146                              <1> 
  1147                              <1> ; -----------------------------------------------------------------------------
  1148                              <1> ; \brief set the length of a given ASCII string to register ...
  1149                              <1> ; -----------------------------------------------------------------------------
  1150                              <1> %macro SETLEN 2
  1151                              <1>     mov      %1, %2_length
  1152                              <1> %endmacro
  1153                              <1> 
  1154                              <1> ; -----------------------------------------------------------------------------
  1155                              <1> ; \brief write ASCII text on the text Windows console ...
  1156                              <1> ; -----------------------------------------------------------------------------
  1157                              <1> %macro WRITE_CON_A 1-2
  1158                              <1> %if DOS_SHELL == 1
  1159                              <1>     %if %0 == 2
  1160                              <1>         PUTS_COLOR %1, %2
  1161                              <1>     %else
  1162                              <1>         PUTS_COLOR %1, 0x07
  1163                              <1>     %endif
  1164                              <1> %else
  1165                              <1>     ; prepare
  1166                              <1>     xor      eax, eax
  1167                              <1>     mov      rcx, PTR64(_cA_%1)
  1168                              <1>     call     GET_STR_LEN
  1169                              <1>     mov      r14, rax
  1170                              <1>     GET_CON_O_HANDLE r12
  1171                              <1>     mov      rcx, r12
  1172                              <1>     mov      rdx, PTR64(_cA_%1)
  1173                              <1>     mov      r8 , r14
  1174                              <1>     xor      r9d, r9d
  1175                              <1>     mov      qword [rsp+32], 0
  1176                              <1>     CALL_IAT WriteConsoleA
  1177                              <1> %endif
  1178                              <1> %endmacro
  1179                              <1> 
  1180                              <1> ; -----------------------------------------------------------------------------
  1181                              <1> ; \brief read utf-8 text on the text Windows console ...
  1182                              <1> ; \param dst -> buffer for the "readln" text
  1183                              <1> ; -----------------------------------------------------------------------------
  1184                              <1> %macro READL_CON_A 0-1
  1185                              <1> %if DOS_SHELL == 1
  1186                              <1>     %if  %0 == 1
  1187                              <1>         mov  dx, PTR16(_cA_%1)
  1188                              <1>         call DOSReadLn
  1189                              <1>     %else
  1190                              <1>         mov  dx, PTR16(_cA_dos_buffer)
  1191                              <1>         call DOSReadLn
  1192                              <1>     %endif
  1193                              <1> %else
  1194                              <1>     ; prepare
  1195                              <1>     GET_CON_I_HANDLE  r13
  1196                              <1>     ; ReadConsoleA(hIn, inbuf, maxChars, &read, NULL)
  1197                              <1>     mov      rcx, r13
  1198                              <1>     mov      rdx, PTR64(_cA_%1)
  1199                              <1>     mov      r8d, 127           ; maxChars (Reserviere 1 Byte für NUL)
  1200                              <1>     mov      r9 , PTR64(written)
  1201                              <1>     xor      rax, rax           ; lpReserved = NULL (über Shadow Space)
  1202                              <1>     mov      [rsp+32], rax
  1203                              <1>     CALL_IAT ReadConsoleA
  1204                              <1> %endif
  1205                              <1> %endmacro
  1206                              <1> 
  1207                              <1> ; -----------------------------------------------------------------------------
  1208                              <1> ; \brief integer to string
  1209                              <1> ;
  1210                              <1> ; \param number -> register (number to convert)
  1211                              <1> ; \param buffer -> destination buffer
  1212                              <1> ; -----------------------------------------------------------------------------
  1213                              <1> %macro INT2STR 2
  1214                              <1>     mov     edx, %2                             ; number to convert
  1215                              <1>     mov     rcx, IMAGE_BASE + RVA_DATA(_cA_%1)  ; destination buffer
  1216                              <1>     call    u32_to_dec                          ; buffer -> "12345",0 ; RAX = 5
  1217                              <1> %endmacro
  1218                              <1> 
  1219                              <1> ; -----------------------------------------------------------------------------
  1220                              <1> ; \brief concatenate two strings (%2, %3) to a given string destionation (%1).
  1221                              <1> ; \param dst  -> string buffer
  1222                              <1> ; \param src1 -> string 0-terminated
  1223                              <1> ; \param src2 -> string 0-terminated
  1224                              <1> ; -----------------------------------------------------------------------------
  1225                              <1> %macro STRCPY_ANSI 3
  1226                              <1>     mov     rcx, IMAGE_BASE + RVA_DATA(_cA_%1)
  1227                              <1>     mov     rdx, IMAGE_BASE + RVA_DATA(_cA_%2)
  1228                              <1>     mov     r8 , IMAGE_BASE + RVA_DATA(_cA_%3)
  1229                              <1>     call    concat_ansi
  1230                              <1> %endmacro
  1231                              <1> %macro STRCAT_ANSI 2-*
  1232                              <1>     %xdefine __DSTSYM (_cA_%1 + 4)
  1233                              <1> 
  1234                              <1>     %rotate 1                     ; ab hier ist %1 der erste src
  1235                              <1>     %rep %0-1
  1236                              <1>         ; --- Ende von dst finden: RDI zeigt nach REPNZ SCASB auf Byte NACH '\0'
  1237                              <1>         mov     rdi, IMAGE_BASE
  1238                              <1>         add     rdi, RVA_DATA(__DSTSYM)
  1239                              <1>         xor     eax, eax          ; AL = 0
  1240                              <1>         mov     rcx, -1
  1241                              <1>         repne   scasb
  1242                              <1>         lea     rcx, [rdi - 1]    ; RCX -> Position des '\0' (Schreibposition)
  1243                              <1> 
  1244                              <1>         ; einen Source anhängen: (s1 = aktueller, s2 = leer)
  1245                              <1>         mov     rdx, PTR64(_cA_%1)
  1246                              <1>         mov     r8 , PTR64(_cA_empty)
  1247                              <1>         call    concat_ansi
  1248                              <1> 
  1249                              <1>         %rotate 1                 ; nächster src
  1250                              <1>     %endrep
  1251                              <1> %endmacro
  1252                              <1> 
  1253                              <1> ; -----------------------------------------------------------------------------
  1254                              <1> ; \brief get the output handle of allocated/open console ...
  1255                              <1> ; \param register to store output handle
  1256                              <1> ; -----------------------------------------------------------------------------
  1257                              <1> %macro GET_CON_O_HANDLE 1
  1258                              <1> %if DOS_SHELL == 1
  1259                              <1>     EMIT_ERROR ERROR_Win32API
  1260                              <1> %else
  1261                              <1>     mov      ecx, STD_OUTPUT_HANDLE
  1262                              <1>     CALL_IAT GetStdHandle
  1263                              <1>     mov      %1, rax         ; hOut
  1264                              <1> %endif
  1265                              <1> %endmacro
  1266                              <1> ; -----------------------------------------------------------------------------
  1267                              <1> ; \brief get the input handle of allocated/open console ...
  1268                              <1> ; \param register to store input handle
  1269                              <1> ; -----------------------------------------------------------------------------
  1270                              <1> %macro GET_CON_I_HANDLE 1
  1271                              <1> %if DOS_SHELL == 1
  1272                              <1>     EMIT_ERROR ERROR_Win32API
  1273                              <1> %else
  1274                              <1>     mov      ecx, STD_INPUT_HANDLE
  1275                              <1>     CALL_IAT GetStdHandle
  1276                              <1>     mov      %1, rax         ; hIn
  1277                              <1> %endif
  1278                              <1> %endmacro
  1279                              <1> 
  1280                              <1> %macro SCREEN_CLEAR 0
  1281                              <1> %if DOS_SHELL == 1
  1282                              <1>     call dos_screen_clear
  1283                              <1> %else
  1284                              <1>     GET_CON_O_HANDLE r12
  1285                              <1>     STRCPY_ANSI buffer_B, consoleColor_3, empty
  1286                              <1>     WRITE_CON_A buffer_B
  1287                              <1> %endif
  1288                              <1> %endmacro
  1289                              <1> 
  1290                              <1> ; -----------------------------------------------------------------------------
  1291                              <1> ; \brief set the cursor position in dos console ...
  1292                              <1> ; \param xpos - <imm>
  1293                              <1> ; \param ypos - <imm>
  1294                              <1> ; -----------------------------------------------------------------------------
  1295                              <1> %macro SET_CURSOR 2
  1296                              <1> %if %0 == 0
  1297                              <1>     EMIT_ERROR 2 argument missing
  1298                              <1> %endif
  1299                              <1> %if DOS_SHELL == 1
  1300                              <1>     mov  dl, %1         ; column
  1301                              <1>     mov  dh, %2         ; row
  1302                              <1>     call dos_set_cursor
  1303                              <1> %else
  1304                              <1> %endif
  1305                              <1> %endmacro
  1306                              <1> 
  1307                              <1> ; -----------------------------------------------------------------------------
  1308                              <1> ; \brief get the cursor position in dos console ...
  1309                              <1> ; -----------------------------------------------------------------------------
  1310                              <1> %macro GET_CURSOR 0
  1311                              <1> %if DOS_SHELL == 1
  1312                              <1>     call dos_get_cursor
  1313                              <1> %else
  1314                              <1>     EMIT_ERROR 'todo: windows'
  1315                              <1> %endif
  1316                              <1> %endmacro
  1317                              <1> 
  1318                              <1> ; -----------------------------------------------------------------------------
  1319                              <1> ; \brief set the color for console window text
  1320                              <1> ; \param 1. background -> int 0..255
  1321                              <1> ; \param 2. foreground -> int 0..255
  1322                              <1> ;
  1323                              <1> ; \desc  color values > 127 == blink chars
  1324                              <1> ; -----------------------------------------------------------------------------
  1325                              <1> %macro SET_COLOR_TO 2
  1326                              <1> %if %0 == 2
  1327                              <1>     STRCPY_ANSI buffer_B, consoleColor_1, empty
  1328                              <1>     STRCAT_ANSI buffer_B,                                     console_color_%1, buffer_semi,                console_color_%2, consoleColor_2
  1331                              <1>     WRITE_CON_A buffer_B
  1332                              <1> %endif
  1333                              <1> %endmacro
  1334                              <1> 
  1335                              <1> ; -----------------------------------------------------------------------------
  1336                              <1> ; \brief 
  1337                              <1> ; -----------------------------------------------------------------------------
  1338                              <1> %macro ARG_CURSOR 2
  1339                              <1> %if DOS_SHELL == 1
  1340                              <1>     GET_ARG  %1             ; save command line argument 1
  1341                              <1>     mov  bl, %2             ; color
  1342                              <1>     call PutStrColor        ; DOS screen
  1343                              <1> %endif
  1344                              <1> %endmacro
  1345                              <1> 
  1346                              <1> ; -----------------------------------------------------------------------------
  1347                              <1> ; \brief macro to put a colored string to the DOS console ...
  1348                              <1> ; -----------------------------------------------------------------------------
  1349                              <1> %macro PUTS_COLOR 2
  1350                              <1> %if DOS_SHELL == 1
  1351                              <1>     ;GET_CURSOR              ; move cursor to col:row
  1352                              <1>     %ifstr %1
  1353                              <1>         section .data
  1354                              <1>         %%msg: db %1, 0
  1355                              <1>         section .text
  1356                              <1>         xor  bx, bx
  1357                              <1>         mov  bl, %2                 ; color
  1358                              <1>         mov  si, PTR16(%%msg)       ; text 0-terminated
  1359                              <1>         call PutStrColor            ; DOS screen
  1360                              <1>     %elifidni %1, SI            ; text is already in SI
  1361                              <1>         section .text
  1362                              <1>         mov  bl, %2
  1363                              <1>         call PutStrColor        ; DOS screen
  1364                              <1>     %elifidni %1, DI            ; text is already in DI
  1365                              <1>         section .text
  1366                              <1>         mov  bl, %2             ; color
  1367                              <1>         call PutStrColor        ; DOS screen
  1368                              <1>     %else
  1369                              <1>         %assign __count 0
  1370                              <1>         %assign __varg  0
  1371                              <1>         %assign __stop  0
  1372                              <1>         %rep MAX_ARGV
  1373                              <1>             %if __stop == 0
  1374                              <1>                 %assign __count (__count + 1)
  1375                              <1>                 %ifidni %1, ARGV_%+__count
  1376                              <1>                     %assign __varg __count
  1377                              <1>                     %assign __stop 1
  1378                              <1>                 %endif
  1379                              <1>             %endif
  1380                              <1>         %endrep
  1381                              <1>         %if __varg > 0
  1382                              <1>             section .text
  1383                              <1>             mov  si, PTR16(_cA_cmd_buf)
  1384                              <1>             mov  bl, __varg
  1385                              <1>             call getCommandLine_Arg
  1386                              <1>             call PutStrColor        ; DOS screen
  1387                              <1>         %else
  1388                              <1>             section .text
  1389                              <1>             mov  bl, %2             ; color
  1390                              <1>             mov  ax, PTR16(_cA_%1)  ; text 0-terminated
  1391                              <1>             mov  si, ax
  1392                              <1>             call PutStrColor        ; DOS screen
  1393                              <1>         %endif
  1394                              <1>         %undef __varg
  1395                              <1>     %endif
  1396                              <1> %else
  1397                              <1>     EMIT_ERROR 'this macro is only for DOS programming.'
  1398                              <1> %endif
  1399                              <1> %endmacro
  1400                              <1> 
  1401                              <1> ; -----------------------------------------------------------------------------
  1402                              <1> ; \brief  get the length of given label string
  1403                              <1> ; \param  1. label name/addr
  1404                              <1> ; \return CX = length of string
  1405                              <1> ; -----------------------------------------------------------------------------
  1406                              <1> %macro STRLEN 1
  1407                              <1> %if %0 == 1
  1408                              <1>     mov  si, PTR16(_cA_%1)
  1409                              <1>     call DOSStrLen
  1410                              <1>     mov  ax, cx             ; AX = length
  1411                              <1>     add  cx, 1              ; CX = length + 1
  1412                              <1> %else
  1413                              <1>     EMIT_ERROR 'exactly one argument expected.'
  1414                              <1> %endif
  1415                              <1> %endmacro
  1416                              <1> 
  1417                              <1> ; -----------------------------------------------------------------------------
  1418                              <1> ; \brief  helper macro save code resources.
  1419                              <1> ; \desc   return to DOS with exit code
  1420                              <1> ; \param  1. exit code value (0..255).
  1421                              <1> ; \return nothing
  1422                              <1> ; -----------------------------------------------------------------------------
  1423                              <1> %macro DOS_Exit 1
  1424                              <1> %if DOS_SHELL == 1
  1425                              <1>     %ifidni   %1, ax
  1426                              <1>         EMIT_ERROR 'AX not allowed here.'
  1427                              <1>     %elifidni %1, bx
  1428                              <1>         mov ax, 0x4C00
  1429                              <1>         or  ax, bx
  1430                              <1>         SysCall
  1431                              <1>     %elifidni %1, CX
  1432                              <1>         mov ax, 0x4C00
  1433                              <1>         or  ax, cx
  1434                              <1>         SysCall
  1435                              <1>     %elifidni %1, dx
  1436                              <1>         mov ax, 0x4C00
  1437                              <1>         or  ax, dx
  1438                              <1>         SysCall
  1439                              <1>     %elifnum  %1
  1440                              <1>         mov  ax, 0x4C00 | %1
  1441                              <1>         SysCall
  1442                              <1>     %else
  1443                              <1>         EMIT_ERROR 'BX, CX, DX or <NUM> expected.'
  1444                              <1>     %endif
  1445                              <1> %endif
  1446                              <1> %endmacro
  1447                              <1> 
  1448                              <1> ; -----------------------------------------------------------------------------
  1449                              <1> ; \brief  print a CRLF on DOS console
  1450                              <1> ; \param  nothing
  1451                              <1> ; \return nothing
  1452                              <1> ; -----------------------------------------------------------------------------
  1453                              <1> %macro DOS_crlf 0
  1454                              <1>     call DOSrncrlf
  1455                              <1> %endmacro
  1456                              <1> 
  1457                              <1> ; -----------------------------------------------------------------------------
  1458                              <1> ; \brief write a string in DX to DOS console without "lf", and no "cr" ...
  1459                              <1> ; \param 1. DX - src label
  1460                              <1> ; \see   DOS_WriteLn
  1461                              <1> ; -----------------------------------------------------------------------------
  1462                              <1> %macro DOS_Write 1
  1463                              <1>     lea  dx, [PTR16(_cA_%1)]
  1464                              <1>     call DOS_ConsoleWrite
  1465                              <1> %endmacro
  1466                              <1> 
  1467                              <1> ; -----------------------------------------------------------------------------
  1468                              <1> ; \brief write a string in DX to DOS console with "lf", and "cr" ...
  1469                              <1> ; \param 1. DX - src label
  1470                              <1> ; \see   DOS_Write
  1471                              <1> ; -----------------------------------------------------------------------------
  1472                              <1> %macro DOS_WriteLn 1
  1473                              <1>     DOS_Write %1
  1474                              <1>     DOS_crlf
  1475                              <1> %endmacro
  1476                              <1> 
  1477                              <1> ; -----------------------------------------------------------------------------
  1478                              <1> ; \brief allocate memory for/in the DOS console ...
  1479                              <1> ; \param 1. count paragraphs
  1480                              <1> ; \note  calculate with: 4096 / 16 = 256 (4096 is a example !)
  1481                              <1> ; -----------------------------------------------------------------------------
  1482                              <1> %macro DOS_AllocMem 1
  1483                              <1> %if DOS_SHELL == 1
  1484                              <1>     mov  ax, 4800h      ; AH = 48h -> Allocate Memory Block
  1485                              <1>     mov  bx, %1         ; Paragraph-Anzahl
  1486                              <1>     SysCall
  1487                              <1>     
  1488                              <1>     sbb  ax, ax
  1489                              <1>     cmp  ax, 0
  1490                              <1>     je   %%.successful
  1491                              <1>     
  1492                              <1>     cmp  ax, 0xFF
  1493                              <1>     je   %%.fail        ; CF = 1 -> error, AX = error code
  1494                              <1>     
  1495                              <1>     jmp  %%.fail
  1496                              <1>     
  1497                              <1>     %%.successful:
  1498                              <1>     ; AX = Segment des Blocks
  1499                              <1>     mov  es, ax
  1500                              <1>     xor  di, di
  1501                              <1>     
  1502                              <1>     ; Block mit 0x00 füllen
  1503                              <1>     mov  cx, 4096
  1504                              <1>     mov  al, 0x00
  1505                              <1>     rep  stosb          ; write to ES:DI
  1506                              <1>     
  1507                              <1>     ; demo read access: AL = ES:[1234]
  1508                              <1>     ;mov  di, 1234
  1509                              <1>     ;mov  al, [es:di]
  1510                              <1>     
  1511                              <1>     jmp   %%.next
  1512                              <1>     
  1513                              <1>     %%.fail:
  1514                              <1>     DOS_WriteLn msg_alloc_error
  1515                              <1>     DOS_Exit    1
  1516                              <1>     
  1517                              <1>     %%.next:
  1518                              <1> %endif
  1519                              <1> %endmacro
  1520                              <1> 
  1521                              <1> %macro DOS_FreeMem 0
  1522                              <1> %if DOS_SHELL == 1
  1523                              <1>     mov es, ax
  1524                              <1>     mov ah, 0x49
  1525                              <1>     SysCall
  1526                              <1> %else
  1527                              <1>     EMIT_ERROR 'todo: windows'
  1528                              <1> %endif
  1529                              <1> %endmacro
  1530                              <1> 
  1531                              <1> ; -----------------------------------------------------------------------------
  1532                              <1> ; \brief COMPARE <reg>, <imm>, <label>
  1533                              <1> ; \param 1. <reg>
  1534                              <1> ; \param 2. <imm>
  1535                              <1> ; \param 3. <label>
  1536                              <1> ; \note  example: COMPARE al, 0x0a, printed
  1537                              <1> ;        result:  cmp <reg>, <imm>  /  je <label>
  1538                              <1> ; -----------------------------------------------------------------------------
  1539                              <1> %macro COMPARE 3
  1540                              <1>     cmp %1, %2
  1541                              <1>     je  %3
  1542                              <1> %endmacro
  1543                              <1> 
  1544                              <1> ; -----------------------------------------------------------------------------
  1545                              <1> ; \brief  get the n-th command line, success: jump to %2 ...
  1546                              <1> ; \param  1. <imm>
  1547                              <1> ; \return SI = text (=argument)
  1548                              <1> ; \note   example: GET_ARG 2
  1549                              <1> ;         result:  <text> in SI
  1550                              <1> ; -----------------------------------------------------------------------------
  1551                              <1> %macro GET_ARG 1-2
  1552                              <1> %if DOS_SHELL == 1
  1553                              <1>     lea  si, [PTR16(_cA_cmd_buf)]
  1554                              <1>     mov  bl, %1
  1555                              <1>     call getCommandLine_Arg
  1556                              <1>     %if %0 == 2
  1557                              <1>         jnc  %2
  1558                              <1>     %endif
  1559                              <1> %else
  1560                              <1>     EMIT_ERROR 'todo: windows'
  1561                              <1> %endif
  1562                              <1> %endmacro
  1563                              <1> 
  1564                              <1> ; -----------------------------------------------------------------------------
  1565                              <1> ; \brief save the n-th command line argument to the <label>
  1566                              <1> ; \param 1. <imm> -> n-th argument number
  1567                              <1> ; \param 2. <label>
  1568                              <1> ; \note  example: SET_ARG <imm>, <label>
  1569                              <1> ; -----------------------------------------------------------------------------
  1570                              <1> %macro SET_ARG 1-2
  1571                              <1> %if DOS_SHELL == 1
  1572                              <1>     %if %0 == 1
  1573                              <1>         GET_ARG  %1
  1574                              <1>         STR_COPY _cA_cmd_arg_%1
  1575                              <1>     %else
  1576                              <1>         GET_ARG  %1
  1577                              <1>         STR_COPY _cA_%2
  1578                              <1>     %endif
  1579                              <1> %else
  1580                              <1>     EMIT_ERROR 'todo: windows'
  1581                              <1> %endif
  1582                              <1> %endmacro
  1583                              <1> 
  1584                              <1> ; -----------------------------------------------------------------------------
  1585                              <1> ; \brief copy a string from source index SI to DI <label>
  1586                              <1> ; \param 1. <label>
  1587                              <1> ; \note  example: STR_COPY <label>
  1588                              <1> ; -----------------------------------------------------------------------------
  1589                              <1> %macro STR_COPY 1
  1590                              <1> %if DOS_SHELL == 1
  1591                              <1>     lea  di, [%1]       ; ES wird in string_copy gesetzt
  1592                              <1>     call string_copy    ; kommt zurück mit SI = Zielstart
  1593                              <1> %else
  1594                              <1>     EMIT_ERROR 'todo: windows'
  1595                              <1> %endif
  1596                              <1> %endmacro
  1597                              <1> 
  1598                              <1> ; -----------------------------------------------------------------------------
  1599                              <1> ; \brief short'ner to get the command line arguments given by the user input.
  1600                              <1> ; \brief initialize a console application ...
  1601                              <1> ; \param nothing
  1602                              <1> ; -----------------------------------------------------------------------------
  1603                              <1> %macro INIT_COMMAND_LINE 0
  1604                              <1> %if DOS_SHELL == 1
  1605                              <1>     call dos_get_command_line
  1606                              <1> %else
  1607                              <1>     EMIT_ERROR 'todo: windows'
  1608                              <1> %endif
  1609                              <1> %endmacro
  1610                              <1> 
  1611                              <1> ; -----------------------------------------------------------------------------
  1612                              <1> ; \brief call the DOS console initialize routine ...
  1613                              <1> ; -----------------------------------------------------------------------------
  1614                              <1> %macro INIT_CONSOLE 0
  1615                              <1> %if DOS_SHELL == 1
  1616                              <1>     call dos_init_console
  1617                              <1>     SCREEN_CLEAR
  1618                              <1> %else
  1619                              <1>     call init_app
  1620                              <1>     call init_console
  1621                              <1> %endif
  1622                              <1> %endmacro
  1623                              <1> 
  1624                              <1> ; -----------------------------------------------------------------------------
  1625                              <1> ; \brief generischer Handler für einen Fehlercode ...
  1626                              <1> ; -----------------------------------------------------------------------------
  1627                              <1> %macro DEF_ERROR 2
  1628                              <1> _h%1:
  1629                              <1>     PUTS_COLOR %2, ATTR_DOS_ERROR
  1630                              <1>     mov   cx, %1
  1631                              <1>     jmp   _open_exit
  1632                              <1> %endmacro
  1633                              <1> 
  1634                              <1> ; -----------------------------------------------------------------------------
  1635                              <1> ; \brief DOS seek to <origin> in file <handle> ...
  1636                              <1> ; \param 1. <file handle>
  1637                              <1> ; \param 2. <origin> 0 - begin of file, 1 - current position, 2 - end of file
  1638                              <1> ; -----------------------------------------------------------------------------
  1639                              <1> %macro DOS_Seek 2
  1640                              <1> %if DOS_SHELL == 1
  1641                              <1>     mov  bx, [PTR16(_cA_%1)]
  1642                              <1>     xor  cx, cx
  1643                              <1>     xor  dx, dx
  1644                              <1>     mov  ah, 0x42               ; move to ...
  1645                              <1>     mov  al, %2
  1646                              <1>     SysCall
  1647                              <1> %else
  1648                              <1>     EMIT_ERROR 'todo: windows'
  1649                              <1> %endif
  1650                              <1> %endmacro
  1651                              <1> 
  1652                              <1> ; -----------------------------------------------------------------------------
  1653                              <1> ; \brief DOS open existing <file name>
  1654                              <1> ; \param 1. <file name>
  1655                              <1> ; \param 2. <open mode> - DOS_READ_ONLY, DOW_WRITE_ONLY, DOS_READWRITE
  1656                              <1> ; -----------------------------------------------------------------------------
  1657                              <1> %macro DOS_Open 2
  1658                              <1> %if DOS_SHELL == 1
  1659                              <1>     mov  dx, PTR16(_cA_%1)
  1660                              <1>     mov  ah, 0x3D               ; open existing file
  1661                              <1>     mov  al, %2                 ; read-only
  1662                              <1>     SysCall
  1663                              <1> %else
  1664                              <1>     EMIT_ERROR 'todo: windows'
  1665                              <1> %endif
  1666                              <1> %endmacro
  1667                              <1> 
  1668                              <1> %macro DOS_Close 2
  1669                              <1> %if DOS_SHELL == 1
  1670                              <1>     mov  bx, [PTR16(_cA_%1)]
  1671                              <1>     or   bx, bx
  1672                              <1>     jz   %2
  1673                              <1>     mov  ah, 3Eh
  1674                              <1>     SysCall
  1675                              <1> %else
  1676                              <1>     EMIT_ERROR 'todo: windows'
  1677                              <1> %endif
  1678                              <1> %endmacro
  1679                              <1> 
  1680                              <1> ; -----------------------------------------------------------------------------
  1681                              <1> ; ERR_HANDLER <err1>[, <err2>, ...]
  1682                              <1> ; erzeugt für jedes Argument:
  1683                              <1> ; _cA_errn<arg>:
  1684                              <1> ;     PUTS_COLOR open_error_<arg>, ATTR_DOS_ERROR
  1685                              <1> ;     mov cx, <arg>
  1686                              <1> ;     jmp _open_exit
  1687                              <1> ; -----------------------------------------------------------------------------
  1688                              <1> ; Hilfsmakro: Nibble (0..15) -> Hex-Zeichen 0..F
  1689                              <1> %macro _HEXDIG 2
  1690                              <1>   %if %1 < 10
  1691                              <1>     %define %2 %1
  1692                              <1>   %elif %1 = 10
  1693                              <1>     %define %2 A
  1694                              <1>   %elif %1 = 11
  1695                              <1>     %define %2 B
  1696                              <1>   %elif %1 = 12
  1697                              <1>     %define %2 C
  1698                              <1>   %elif %1 = 13
  1699                              <1>     %define %2 D
  1700                              <1>   %elif %1 = 14
  1701                              <1>     %define %2 E
  1702                              <1>   %elif %1 = 15
  1703                              <1>     %define %2 F
  1704                              <1>   %else
  1705                              <1>     EMIT_ERROR "_HEXDIG: Nibble ausserhalb 0..15"
  1706                              <1>   %endif
  1707                              <1> %endmacro
  1708                              <1> ; -----------------------------------------------------------------------------
  1709                              <1> ; expr -> zwei Hex-Zeichen OUT_H/OUT_L (ohne 0x/h), 8-bit
  1710                              <1> ; -----------------------------------------------------------------------------
  1711                              <1> %macro _HEX2 3
  1712                              <1>   %assign __v %1
  1713                              <1>   %assign __v __v & 0FFh
  1714                              <1>   %assign __hi (__v >> 4) & 0Fh
  1715                              <1>   %assign __lo  __v       & 0Fh
  1716                              <1>   _HEXDIG __hi, %2
  1717                              <1>   _HEXDIG __lo, %3
  1718                              <1>   %undef __v
  1719                              <1>   %undef __hi
  1720                              <1>   %undef __lo
  1721                              <1> %endmacro
  1722                              <1> ; -----------------------------------------------------------------------------
  1723                              <1> ; ERR_HANDLER <err1>[, <err2>, ...]
  1724                              <1> ; Baut Labels / Namen mit zwei Hex-Ziffern (00..FF), ohne 0x/h.
  1725                              <1> ; -----------------------------------------------------------------------------
  1726                              <1> %macro ERR_HANDLER 1-*
  1727                              <1> %rep %0
  1728                              <1>     ; Ausdruck auswerten (dezimal/hex ok) und auf 8 Bit begrenzen
  1729                              <1>     %assign __v %1
  1730                              <1>     %assign __v __v & 0FFh
  1731                              <1> 
  1732                              <1>     ; zwei Hex-Ziffern bilden
  1733                              <1>     %assign __hi (__v >> 4) & 0Fh
  1734                              <1>     %assign __lo  __v       & 0Fh
  1735                              <1>     _HEXDIG __hi, __H
  1736                              <1>     _HEXDIG __lo, __L
  1737                              <1> 
  1738                              <1> _cA_errh%+__H%+__L:
  1739                              <1>     PUTS_COLOR open_error_%+__H%+__L, ATTR_DOS_ERROR
  1740                              <1>     mov cx, %1
  1741                              <1>     jmp _open_exit
  1742                              <1>     
  1743                              <1>     ; Aufräumen der temporären Namen dieser Iteration
  1744                              <1>     %undef __H
  1745                              <1>     %undef __L
  1746                              <1>     %undef __hi
  1747                              <1>     %undef __lo
  1748                              <1>     %undef __v
  1749                              <1>     
  1750                              <1>     %rotate 1
  1751                              <1> %endrep
  1752                              <1> %endmacro
  1753                              <1> ; -----------------------------------------------------------------------------
  1754                              <1> ; Für jeden Code: Label _cA_errhXX + Body
  1755                              <1> ;
  1756                              <1> ; ---------- Tabelle (Datenbereich) ----------
  1757                              <1> ; ERZEUGT: 
  1758                              <1> ;   _cA_error_dispatch:
  1759                              <1> ;       dw <code>, _cA_errhXX
  1760                              <1> ;       ...
  1761                              <1> ;       dw 00h, _cA_errhnd
  1762                              <1> ; -----------------------------------------------------------------------------
  1763                              <1> %macro ERR_ITEMS 1-*
  1764                              <1> _cA_error_dispatch:
  1765                              <1>   %rep %0
  1766                              <1>     _HEX2 %1, __H, __L
  1767                              <1>     dw %1, _cA_errh%+__H%+__L
  1768                              <1>     %undef __H
  1769                              <1>     %undef __L
  1770                              <1>     %rotate 1
  1771                              <1>   %endrep
  1772                              <1>   dw 00h, _cA_errhnd
  1773                              <1> %endmacro
  1774                              <1> 
  1775                              <1> ; -----------------------------------------------------------------------------
  1776                              <1> ; \brief check a character at the given position in given label string...
  1777                              <1> ; CMP_CHR <label>, <num-position>, <char to check>, <jump label if equal>
  1778                              <1> ; CMP_CHR argvn, 2, '3', is_three
  1779                              <1> ; -----------------------------------------------------------------------------
  1780                              <1> %macro CMP_CHR 4
  1781                              <1>     %ifstr %1
  1782                              <1>         section .data
  1783                              <1>         %%msg: db %1, 0
  1784                              <1>         section .text
  1785                              <1>         lea si, [PTR16(%%msg)]       ; text 0-terminated
  1786                              <1>     %else
  1787                              <1>     section .text
  1788                              <1>         %assign __count 0
  1789                              <1>         %assign __varg  0
  1790                              <1>         %assign __stop  0
  1791                              <1>         %rep MAX_ARGV
  1792                              <1>             %if __stop == 0
  1793                              <1>                 %assign __count (__count + 1)
  1794                              <1>                 %ifidni %1, ARGV_%+__count
  1795                              <1>                     %assign __varg __count
  1796                              <1>                     %assign __stop 1
  1797                              <1>                 %endif
  1798                              <1>             %endif
  1799                              <1>         %endrep
  1800                              <1>         %if __varg > 0
  1801                              <1>             mov  si, PTR16(_cA_cmd_buf)
  1802                              <1>             mov  bl, __varg
  1803                              <1>             call getCommandLine_Arg
  1804                              <1>         %else
  1805                              <1>             lea si, [PTR16(_cA_%1)]
  1806                              <1>         %endif
  1807                              <1>         %undef __stop
  1808                              <1>         %undef __varg
  1809                              <1>     %endif
  1810                              <1>         xor  cl, cl
  1811                              <1>         push si
  1812                              <1>     %%loop:
  1813                              <1>         lodsb
  1814                              <1>         inc cl
  1815                              <1>         cmp cl, %2
  1816                              <1>         je  %%next
  1817                              <1>         jmp %%loop
  1818                              <1>     %%next:
  1819                              <1>         pop si
  1820                              <1>         cmp al, %3
  1821                              <1>         je  %4
  1822                              <1> %endmacro
  1823                              <1> 
  1824                              <1> %macro SAVE 1
  1825                              <1>     %if __pre_stop == 0
  1826                              <1>         push %1
  1827                              <1>     %endif
  1828                              <1> %endmacro
  1829                              <1> %macro RESTORE 1
  1830                              <1>     %if __pre_stop == 0
  1831                              <1>         pop  %1
  1832                              <1>     %endif
  1833                              <1> %endmacro
  1834                              <1> 
  1835                              <1> ; -----------------------------------------------------------------------------
  1836                              <1> ; \brief LEA.w introduce a 16-Bit (word) LEA - load effective address.
  1837                              <1> ; \note  With this directive, you dont need anymore to give the IMNAGE BASE to
  1838                              <1> ;        the addressing mode. It use the %macro  PTR16(<label>).
  1839                              <1> ; \note  This macro is case-insensitive
  1840                              <1> ; \see   %macro PTR16
  1841                              <1> ; -----------------------------------------------------------------------------
  1842                              <1> %imacro lea.w 2
  1843                              <1> %if DOS_SHELL == 1      ; compilation for DOS 16-Bit ?
  1844                              <1>     %if __pre_stop == 0
  1845                              <1>         %undef __prefix     ; reset
  1846                              <1>         %undef __suffix     ; ...
  1847                              <1>         %ifidni %1, SI
  1848                              <1>             %define __prefix si
  1849                              <1>         %elifidni %1, DI
  1850                              <1>             %define __prefix di
  1851                              <1>         %else
  1852                              <1>             EMIT_ERROR 'invalide prefix for LEA.W'
  1853                              <1>         %endif
  1854                              <1>         %ifndef __prefix
  1855                              <1>             %assign __pre_stop 1
  1856                              <1>         %endif
  1857                              <1>         %if __pre_stop == 0
  1858                              <1>             %xdefine __s %str(%2)
  1859                              <1>             %xdefine __n %strlen(__s)
  1860                              <1>             %if __n >= 2
  1861                              <1>                 %xdefine __fst %substr(__s,0,1)
  1862                              <1>                 %xdefine __lst %substr(__s,__n,1)
  1863                              <1>                 %ifidn __fst, '['
  1864                              <1>                     %ifidn __lst, ']'
  1865                              <1>                         %xdefine __inner %substr(__s,2,__n-2)
  1866                              <1>                         %xdefine __tok   %tok(__inner)
  1867                              <1>                         %define __suffix [PTR16(__tok)]
  1868                              <1>                             lea __prefix, __suffix
  1869                              <1>                     %else
  1870                              <1>                         EMIT_ERROR 'closed bracket missing.'
  1871                              <1>                     %endif
  1872                              <1>                 %else
  1873                              <1>                     EMIT_ERROR 'missing brackets.'
  1874                              <1>                     ; todo
  1875                              <1>                 %endif
  1876                              <1>             %else
  1877                              <1>                 EMIT_ERROR 'directive too short.'
  1878                              <1>             %endif
  1879                              <1>         %endif
  1880                              <1>     %endif
  1881                              <1> %else
  1882                              <1>     EMIT_ERROR 'todo: windows'
  1883                              <1> %endif
  1884                              <1> %endmacro
  1885                              <1> 
  1886                              <1> ; -----------------------------------------------------------------------------
  1887                              <1> ; \brief MOV.w introduce a 16-Bit (word) MOV.
  1888                              <1> ; \note  With this directive, you dont need anymore to give the IMNAGE BASE to
  1889                              <1> ;        the addressing mode. It use the %macro  PTR16(<label>).
  1890                              <1> ; \note  This macro is case-insensitive
  1891                              <1> ; \see   %macro PTR16
  1892                              <1> ; -----------------------------------------------------------------------------
  1893                              <1> %imacro mov.w 2
  1894                              <1> %if DOS_SHELL == 1
  1895                              <1>     %if __pre_stop == 0
  1896                              <1>         %ifidni %1, BL
  1897                              <1>             %ifid %2
  1898                              <1>                 mov bl, PTR16(_cA_%2)
  1899                              <1>             %endif
  1900                              <1>         %endif
  1901                              <1>     %endif
  1902                              <1> %else
  1903                              <1>     %if __pre_stop == 0
  1904                              <1>         EMIT_ERROR 'todo: windows'
  1905                              <1>     %endif
  1906                              <1> %endif
  1907                              <1> %endmacro
  1908                              <1> 
  1909                              <1> ; -----------------------------------------------------------------------------
  1910                              <1> ; \brief STR_CMP - compare 2 string's ...
  1911                              <1> ; \note  Examples:
  1912                              <1> ;            STR_CMP ARGV_1, ARGV_2, is_version_2
  1913                              <1> ;            STR_CMP ARGV_1, 'abcd', is_version_3
  1914                              <1> ;            STR_CMP ARGV_2, '1234', is_version_4
  1915                              <1> ;            STR_CMP "abcd", "abcd", is_version_5
  1916                              <1> ; -----------------------------------------------------------------------------
  1917                              <1> %macro STR_STR_HELPER 1
  1918                              <1>     %if __pre_stop == 0
  1919                              <1>         section .text
  1920                              <1>         call string_compare
  1921                              <1>         cmp  al, 0
  1922                              <1>         jne  %%jum4
  1923                              <1>         call %1
  1924                              <1>         %%jum4:
  1925                              <1>     %endif
  1926                              <1> %endmacro
  1927                              <1> %macro STR_ARG_HELPER 1-2
  1928                              <1>     %if __pre_stop == 0
  1929                              <1>         section  .text
  1930                              <1>         SAVE si
  1931                              <1>         %if %0 == 2
  1932                              <1>             lea.w si, [_cA_%1]
  1933                              <1>             mov  bl, %2
  1934                              <1>         %elif %0 == 1
  1935                              <1>             lea.w si, [_cA_cmd_buf]
  1936                              <1>             mov  bl, %1
  1937                              <1>         %else
  1938                              <1>             EMIT_ERROR 'this macro excepted 2 arguments.'
  1939                              <1>             %assign __pre_stop 1
  1940                              <1>         %endif
  1941                              <1>         call getCommandLine_Arg
  1942                              <1>         mov  di, si
  1943                              <1>         RESTORE  si
  1944                              <1>     %endif
  1945                              <1> %endmacro
  1946                              <1> %macro STR_CMP 3
  1947                              <1>     %if __pre_stop == 0
  1948                              <1>         %ifnum %1                           ; argument 1 is a number ?
  1949                              <1>             EMIT_ERROR 'numbers can not be handled as string.'
  1950                              <1>             %assign __pre_stop 1
  1951                              <1>         %elifstr %1                         ; argument 1 is a string ?
  1952                              <1>             section .data
  1953                              <1>             %%part1: db %1, 0
  1954                              <1>             section .text
  1955                              <1>             lea.w si, [%%part1]
  1956                              <1>             %ifid %2
  1957                              <1>                 GET_VARGS %2, __vargs
  1958                              <1>                 %if __vargs > 0
  1959                              <1>                     STR_ARG_HELPER __vargs
  1960                              <1>                     STR_STR_HELPER %3
  1961                              <1>                 %endif
  1962                              <1>             %elifstr %2                     ; argument 2 is a string ?
  1963                              <1>                 section .data
  1964                              <1>                 %%part2: db %1, 0
  1965                              <1>                 section .text
  1966                              <1>                 LEA.w  DI, [%%part2]        ; dst
  1967                              <1>                 STR_STR_HELPER %3
  1968                              <1>             %elifnum %2                     ; argument 2 is a number ?
  1969                              <1>                 EMIT_ERROR 'numbers can not be handled as string.'
  1970                              <1>                 %assign __pre_stop 1
  1971                              <1>             %else
  1972                              <1>                 EMIT_ERROR 'todo'
  1973                              <1>                 %assign __pre_stop 1
  1974                              <1>             %endif
  1975                              <1>         %elifid %1
  1976                              <1>             %assign __varg1 0
  1977                              <1>             %assign __varg2 0
  1978                              <1>             GET_VARGS %1, _varg1
  1979                              <1>             %ifid %2
  1980                              <1>                 GET_VARGS %2, _varg2
  1981                              <1>                 %if __varg1 > 0
  1982                              <1>                     %if __varg2 > 0
  1983                              <1>                         STR_ARG_HELPER __varg1
  1984                              <1>                         STR_ARG_HELPER __varg2
  1985                              <1>                         STR_STR_HELPER %3
  1986                              <1>                     %else
  1987                              <1>                         LEA.w DI, [_cA_%2]
  1988                              <1>                     %endif
  1989                              <1>                 %else
  1990                              <1>                     LEA.w SI, [_cA_%1]
  1991                              <1>                 %endif
  1992                              <1>             %elifstr %2                     ; argument 2 is a string ?
  1993                              <1>                 section .data
  1994                              <1>                 %%part3: db %2, 0
  1995                              <1>                 section .text
  1996                              <1>                 LEA.w si, [%%part3]
  1997                              <1>                 STR_ARG_HELPER __varg1
  1998                              <1>                 STR_STR_HELPER %3
  1999                              <1>             %elifnum %2                     ; argument 2 is a number ?
  2000                              <1>                 EMIT_ERROR 'numbers can not be handled as string.'
  2001                              <1>             %else
  2002                              <1>                 EMIT_ERROR 'todo'
  2003                              <1>             %endif
  2004                              <1>         %endif
  2005                              <1>         %undef __stop
  2006                              <1>         %undef __varg
  2007                              <1>     %endif
  2008                              <1> %endmacro
    13                                  
    14                                  ; -----------------------------------------------------------------------------
    15                                  ; DOS and PE-Header
    16                                  ; -----------------------------------------------------------------------------
    17                                  %include 'doshdr.inc'
     1                              <1> ;---------------------------------------------------
     2                              <1> ; \file  doshdr.asm
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ;---------------------------------------------------
     8                              <1> ; DOS-Header
     9                              <1> ;---------------------------------------------------
    10                              <1> org 0
    11                              <1> bits 16
    12                              <1> section .text
    13                              <1> ; ---- Header-Layout-Marker
    14                              <1> dos_start:
    15 00000000 4D5A                <1>     db 'M','Z'                          ; e_magic
    16 00000002 5F01                <1>     dw ( stub_end - $$) % 512           ; e_cblp
    17 00000004 0900                <1>     dw ((stub_end - $$) + 511) / 512    ; e_cp
    18 00000006 0000                <1>     dw 0                                ; e_crlc (keine Relocs)
    19 00000008 0400                <1>     dw ((stub_entry  - $$) +  15) / 16  ; e_cparhdr (Headergröße in Paragraphen)
    20 0000000A 0000                <1>     dw 0                                ; e_minalloc
    21 0000000C 0010                <1>     dw 0x1000                           ; e_maxalloc (so viel wie möglich)
    22 0000000E 0000                <1>     dw 0                                ; e_ss
    23 00000010 FEFE                <1>     dw 0xFEFE                           ; e_sp (kleiner Stack)
    24 00000012 5104                <1>     dw 1105                             ; e_csum
    25 00000014 0000                <1>     dw 0                                ; e_ip  (Code startet bei 0 im Image)
    26 00000016 0000                <1>     dw 0                                ; e_cs
    27 00000018 4000                <1>     dw mz_reloc - $$                    ; e_lfarlc (Reloc-Tabelle: leer)
    28 0000001A BC02                <1>     dw 700                              ; e_ovno
    29                              <1>     ; ----
    30 0000001C 8C07                <1>     dw 1932
    31 0000001E 9D07                <1>     dw 1949
    32 00000020 A407                <1>     dw 1956
    33 00000022 C507                <1>     dw 1989
    34                              <1>     ;times    4  dw 0                   ; e_res[4]
    35                              <1>     ; ----
    36                              <1>     
    37 00000024 6A1C5720            <1>     dw    7274, 8279                    ; e_oemid, e_oeminfo
    38                              <1>     
    39                              <1>     ; ----
    40 00000028 00C0                <1>     dw 49152
    41 0000002A DE7B                <1>     dw 31710
    42 0000002C 4402                <1>     dw 580
    43 0000002E 3403                <1>     dw 820
    44 00000030 3103                <1>     dw 817
    45 00000032 4203                <1>     dw 834
    46 00000034 D9C0                <1>     dw 49369
    47 00000036 BA08                <1>     dw 2234
    48 00000038 4601                <1>     dw 326
    49 0000003A FEFE                <1>     dw 0xFEFE
    50                              <1>     ;times    10  dw 0                  ; e_res2[10]
    51                              <1>     ; ----
    52                              <1>     
    53 0000003C [60110000]          <1>     dd pe_header                        ; e_lfanew -> Offset des PE-Headers
    54                              <1>     
    55                              <1> end_dos_header equ ($ - dos_start)
    56                              <1> 
    57                              <1> ; Reloc-Tabelle (leer), aber im Headerbereich!
    58                              <1> mz_reloc:                               ; == 0x40
    59                              <1> 
    60                              <1> ;---------------------------------------------------
    61                              <1> ; DOS 16 bit stub
    62                              <1> ;---------------------------------------------------
    63                              <1> align 16                                ; <-- sicherstellen, dass mz_image auf Absatzgrenze startet
    64                              <1> mz_image:
    65                              <1> 
    66                              <1> ; ---- 16-bit Stub-Entry bei e_cs:e_ip = 0:0 (ab mz_image)
    67                              <1> stub_entry:
    68 00000040 <bin 111Fh>         <1> incbin 'kernel.bin'
    69                              <1> 
    70                              <1> ;---------------------------------------------------
    71                              <1> ; Windows 3.1 16 bit stub
    72                              <1> ;---------------------------------------------------
    73                              <1> ;align 16
    74                              <1> ;%include 'win16NEhdr.inc'
    75                              <1> 
    76                              <1> stub_end:
    18                                  %include 'winhdr.inc'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  winhdr.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> ; PE-Header (PE32+) + Optional Header + Section Table
     9                              <1> ; -----------------------------------------------------------------------------
    10                              <1> %define DOS_SHELL 0
    11                              <1> bits 64
    12                              <1> org 0
    13 0000115F 90                  <1> align 8
    14                              <1> pe_header:
    15 00001160 50450000            <1>     db 'P','E',0,0                 ; "PE\0\0"
    16                              <1> 
    17                              <1>     ; COFF
    18 00001164 6486                <1>     dw IMAGE_FILE_MACHINE_AMD64    ; AMD64
    19 00001166 0400                <1>     dw 4                           ; Sections: .text, .idata, .data, .bss
    20 00001168 000000000000000000- <1>     dd 0,0,0
    20 00001171 000000              <1>
    21 00001174 F000                <1>     dw 0x00F0                      ; SizeOfOptionalHeader (PE32+)
    22 00001176 2300                <1>     dw 0x0023                      ; EXECUTABLE|LAA  (Relocs stripped)
    23                              <1> 
    24                              <1> %include 'precalc.asm'
     1                              <2> ; -----------------------------------------------------------------------------
     2                              <2> ; \file  precalcasm
     3                              <2> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <2> ;        all rights reserved.
     5                              <2> ;
     6                              <2> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <2> ; -----------------------------------------------------------------------------
     8                              <2> ; pre-calculatuins
     9                              <2> ; -----------------------------------------------------------------------------
    10                              <2> %define ALIGN_UP(x,a)  (((x) + (a) - 1) / (a) * (a))
    11                              <2> 
    12                              <2> ; ---- Header/erste Section ----
    13                              <2> %define SIZEOF_HEADERS ALIGN_UP(headers_end - $$, FILEALIGN)
    14                              <2> 
    15                              <2> %define TEXT_VA        ALIGN_UP(headers_end - $$, SECTALIGN)
    16                              <2> %define TEXT_RAW_PTR   SIZEOF_HEADERS
    17                              <2> %define TEXT_VSIZE     (text_end - text_start)
    18                              <2> %define TEXT_RAW_SIZE  ALIGN_UP(TEXT_VSIZE, FILEALIGN)
    19                              <2> %define TEXT_VSIZE_AL  ALIGN_UP(TEXT_VSIZE, SECTALIGN)
    20                              <2> 
    21                              <2> ; ---- .idata ----
    22                              <2> %define IDATA_VA       ALIGN_UP(TEXT_VA + TEXT_VSIZE_AL, SECTALIGN)
    23                              <2> %define IDATA_VSIZE    (idata_end - idata_start)
    24                              <2> %define IDATA_VSIZE_AL ALIGN_UP(IDATA_VSIZE, SECTALIGN)
    25                              <2> 
    26                              <2> %define IDATA_RAW_PTR  ALIGN_UP(TEXT_RAW_PTR + TEXT_RAW_SIZE, FILEALIGN)
    27                              <2> %define IDATA_RAW_SIZE ALIGN_UP(IDATA_VSIZE, FILEALIGN)
    28                              <2> 
    29                              <2> ; ---- .data ----
    30                              <2> %define DATA_VA        ALIGN_UP(IDATA_VA + IDATA_VSIZE_AL, SECTALIGN)
    31                              <2> %define DATA_VSIZE     (data_end - data_start)
    32                              <2> %define DATA_VSIZE_AL  ALIGN_UP(DATA_VSIZE, SECTALIGN)
    33                              <2> 
    34                              <2> %define DATA_RAW_PTR   ALIGN_UP(IDATA_RAW_PTR + IDATA_RAW_SIZE, FILEALIGN)
    35                              <2> %define DATA_RAW_SIZE  ALIGN_UP(DATA_VSIZE, FILEALIGN)
    36                              <2> 
    37                              <2> ; ---- .bss (keine Raw-Daten!) ----
    38                              <2> %define BSS_VA         ALIGN_UP(DATA_VA + DATA_VSIZE_AL, SECTALIGN)
    39                              <2> %define BSS_VSIZE      (bss_end - bss_start)
    40                              <2> %define BSS_VSIZE_AL   ALIGN_UP(BSS_VSIZE, SECTALIGN)
    41                              <2> 
    42                              <2> %define BSS_RAW_PTR    0
    43                              <2> %define BSS_RAW_SIZE   0
    44                              <2> 
    45                              <2> ; ---- Image-Größe ----
    46                              <2> %define SIZEOF_IMAGE   ALIGN_UP(BSS_VA + BSS_VSIZE_AL, SECTALIGN)
    47                              <2> 
    48                              <2> ; ---- RVA-Helfer ----
    49                              <2> %define RVA_TEXT(L)   (TEXT_VA  + ((L) - text_start))
    50                              <2> %define RVA_IDATA(L)  (IDATA_VA + ((L) - idata_start))
    51                              <2> %define RVA_DATA(L)   (DATA_VA  + ((L) - data_start))
    52                              <2> %define RVA_BSS(L)    (BSS_VA   + ((L) - bss_start))
    25                              <1> 
    26                              <1> ; --------- Optional Header (PE32+)
    27 00001178 0B02                <1>     dw 0x020B                      ; Magic
    28 0000117A 0000                <1>     db 0,0                         ; LinkerVersion
    29 0000117C 000E0000            <1>     dd TEXT_RAW_SIZE               ; SizeOfCode
    30 00001180 000C0000            <1>     dd IDATA_RAW_SIZE + DATA_RAW_SIZE  ; SizeOfInitializedData
    31 00001184 05030000            <1>     dd BSS_VSIZE                   ; SizeOfUninitializedData (nur .bss, virtuell)
    32 00001188 00200000            <1>     dd RVA_TEXT(text_start)        ; EntryPoint
    33 0000118C 00200000            <1>     dd TEXT_VA                     ; BaseOfCode
    34 00001190 0000004001000000    <1>     dq IMAGE_BASE                  ; ImageBase
    35 00001198 00100000            <1>     dd SECTALIGN                   ; SectionAlignment
    36 0000119C 00020000            <1>     dd FILEALIGN                   ; FileAlignment
    37 000011A0 06000000            <1>     dw 6,0                         ; OS Version
    38 000011A4 9D07A407            <1>     dw 1949,1956                   ; Image Version
    39 000011A8 06000000            <1>     dw 6,0                         ; Subsystem Version
    40 000011AC 00000000            <1>     dd 0
    41 000011B0 00600000            <1>     dd SIZEOF_IMAGE                ; SizeOfImage
    42 000011B4 00140000            <1>     dd SIZEOF_HEADERS              ; SizeOfHeaders
    43 000011B8 00000000            <1>     dd 0                           ; Checksum
    44 000011BC 0200                <1>     dw 2                           ; Subsystem = Windows GUI
    45 000011BE 0001                <1>     dw IMAGE_DLLCHARACTERISTICS_NX_COMPAT ; DllCharacteristics: NXCompat (no ASLR)
    46 000011C0 000010000000000000- <1>     dq 0x100000, 0x1000            ; Stack Reserve/Commit
    46 000011C9 10000000000000      <1>
    47 000011D0 000010000000000000- <1>     dq 0x100000, 0x1000            ; Heap  Reserve/Commit
    47 000011D9 10000000000000      <1>
    48 000011E0 00000000            <1>     dd 0
    49 000011E4 10000000            <1>     dd 16
    50                              <1> 
    51                              <1>     ; Data Directories
    52 000011E8 0000000000000000    <1>     dd 0,0                         ; 0 Export
    53 000011F0 0030000050000000    <1>     dd RVA_IDATA(import_dir), (import_dir_end - import_dir) ; 1 Import
    54 000011F8 0000000000000000    <1>     dd 0,0                         ; 2 Resource
    55 00001200 0000000000000000    <1>     dd 0,0                         ; 3 Exception
    56 00001208 0000000000000000    <1>     dd 0,0                         ; 4 Security
    57 00001210 0000000000000000    <1>     dd 0,0                         ; 5 Base Reloc
    58 00001218 0000000000000000    <1>     dd 0,0                         ; 6 Debug
    59 00001220 0000000000000000    <1>     dd 0,0                         ; 7 Architecture
    60 00001228 0000000000000000    <1>     dd 0,0                         ; 8 Global Ptr
    61 00001230 0000000000000000    <1>     dd 0,0                         ; 9 TLS
    62 00001238 0000000000000000    <1>     dd 0,0                         ; 10 Load Config
    63 00001240 0000000000000000    <1>     dd 0,0                         ; 11 Bound Import
    64 00001248 8032000030020000    <1>     dd RVA_IDATA(iat_start), (iat_end - iat_start)          ; 12 IAT
    65 00001250 0000000000000000    <1>     dd 0,0                         ; 13 Delay Import
    66 00001258 0000000000000000    <1>     dd 0,0                         ; 14 COM
    67 00001260 0000000000000000    <1>     dd 0,0                         ; 15 Reserved
    68                              <1> 
    69                              <1>     ; Section .text
    70 00001268 2E74657874000000    <1>     db '.text',0,0,0
    71 00001270 890C0000            <1>     dd TEXT_VSIZE
    72 00001274 00200000            <1>     dd TEXT_VA
    73 00001278 000E0000            <1>     dd TEXT_RAW_SIZE
    74 0000127C 00140000            <1>     dd TEXT_RAW_PTR
    75 00001280 0000000000000000    <1>     dd 0,0
    76 00001288 00000000            <1>     dw 0,0
    77 0000128C 20000060            <1>     dd 0x60000020                  ; CODE|EXECUTE|READ
    78                              <1> 
    79                              <1>     ; Section .idata
    80 00001290 2E69646174610000    <1>     db '.idata',0,0
    81 00001298 60090000            <1>     dd IDATA_VSIZE
    82 0000129C 00300000            <1>     dd IDATA_VA
    83 000012A0 000A0000            <1>     dd IDATA_RAW_SIZE
    84 000012A4 00220000            <1>     dd IDATA_RAW_PTR
    85 000012A8 0000000000000000    <1>     dd 0,0
    86 000012B0 00000000            <1>     dw 0,0
    87 000012B4 400000C0            <1>     dd 0xC0000040                  ; INIT_DATA|READ|WRITE
    88                              <1> 
    89                              <1>     ; --- Section .data
    90 000012B8 2E64617461000000    <1>     db '.data',0,0,0
    91 000012C0 9B010000            <1>     dd DATA_VSIZE
    92 000012C4 00400000            <1>     dd DATA_VA
    93 000012C8 00020000            <1>     dd DATA_RAW_SIZE
    94 000012CC 002C0000            <1>     dd DATA_RAW_PTR
    95 000012D0 0000000000000000    <1>     dd 0,0
    96 000012D8 00000000            <1>     dw 0,0
    97 000012DC 400000C0            <1>     dd 0xC0000040      ; READ | WRITE | INIT_DATA
    98                              <1>     
    99                              <1>     ; --- Section .bss
   100 000012E0 2E62737300000000    <1>     db '.bss',0,0,0,0
   101 000012E8 05030000            <1>     dd BSS_VSIZE
   102 000012EC 00500000            <1>     dd BSS_VA
   103 000012F0 0000000000000000    <1>     dd 0,0
   104 000012F8 0000000000000000    <1>     dd 0,0
   105 00001300 00000000            <1>     dw 0,0
   106 00001304 800000C0            <1>     dd 0xC0000080      ; READ | WRITE | UNINITIALIZED_DATA
   107                              <1> 
   108                              <1> headers_end:
   109                              <1> 
   110                              <1> ; Auf Dateialignment auffüllen
   111 00001308 00<rep F8h>         <1> times (SIZEOF_HEADERS - ($ - $$)) db 0
    19                                  
    20                                  ; -----------------------------------------------------------------------------
    21                                  ; .text (Code)
    22                                  ; -----------------------------------------------------------------------------
    23                                  section .text
    24                                  text_start:
    25                                  
    26                                  %include 'code64.asm'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  code64.asm
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> bits 64
     9                              <1> 
    10                              <1> _start:
    11                              <1> ;   mov rbp, rsp
    12                              <1> ;    and rsp,-16
    13                              <1> 
    14 00001400 4883EC28            <1>     sub rsp, 40
    15 00001404 E830030000          <1>     call PASCALMAIN
    16                              <1> 
    17 00001409 B93E000000          <1>     mov rcx, 62
    18                              <1>     CALL_IAT ExitProcess
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 0000140E 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001412 48B890320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 0000141B 00                  <2>
   293 0000141C FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 0000141E 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    19 00001422 C3                  <1>     ret
    20                              <1> 
    21                              <1>     ; hInstance holen
    22 00001423 31C9                <1>     xor     ecx, ecx
    23                              <1>     CALL_IAT GetModuleHandleW         ; rcx = NULL
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001425 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001429 48B8E0320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001432 00                  <2>
   293 00001433 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001435 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    24 00001439 4989C6              <1>     mov     r14, rax                  ; HINSTANCE in callee-saved Reg
    25                              <1> 
    26                              <1>     ; ----- WNDCLASSEXW auf dem Stack füllen -----
    27                              <1>     ; Layout (Win64, 80 Bytes):
    28                              <1>     ;  0 cbSize         (4) 
    29                              <1>     ;  4 style          (4)  1
    30                              <1>     ;  8 lpfnWndProc    (8)  2
    31                              <1>     ; 16 cbClsExtra     (4)
    32                              <1>     ; 20 cbWndExtra     (4)  3
    33                              <1>     ; 24 hInstance      (8)  4
    34                              <1>     ; 32 hIcon          (8)  5
    35                              <1>     ; 40 hCursor        (8)  6
    36                              <1>     ; 48 hbrBackground  (8)  7
    37                              <1>     ; 56 lpszMenuName   (8)  8 
    38                              <1>     ; 64 lpszClassName  (8)  9
    39                              <1>     ; 72 hIconSm        (8) 10
    40                              <1>     AddShadow (8 * 10)                  ; size of WNDCLASSEXW
   155                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <2>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <2> %else
   158                              <2>  %if __pre_stop == 0
   159                              <2>  %if %0 == 1
   160 0000143C 4883EC50            <2>  sub rsp, %1
   161                              <2>  %else
   162                              <2>  sub rsp, SW_SHADOW
   163                              <2>  %endif
   164                              <2>  %endif
   165                              <2> %endif
    41 00001440 4889E7              <1>     mov     rdi, rsp                    ; rdi = &wc
    42                              <1> 
    43                              <1>     ; Zero init
    44 00001443 FC                  <1>     cld                                 ; (sicherstellen, dass DF=0 ist)
    45 00001444 31C0                <1>     xor     eax, eax                    ; rax = 0
    46 00001446 B90A000000          <1>     mov     ecx, 10                     ; 10 qwords
    47 0000144B F348AB              <1>     rep     stosq
    48                              <1> 
    49 0000144E C70750000000        <1>     mov     dword [rdi + 0], 80                           ; cbSize
    50 00001454 C7470403000000      <1>     mov     dword [rdi + 4], CS_HREDRAW | CS_VREDRAW      ; style
    51                              <1> 
    52                              <1>     ; lpfnWndProc = &WndProc (absolute VA)
    53 0000145B 48B800000040010000- <1>     mov     rax, IMAGE_BASE
    53 00001464 00                  <1>
    54 00001465 48057F220000        <1>     add     rax, RVA_TEXT(WndProc)
    55 0000146B 48894708            <1>     mov     [rdi + 8], rax
    56                              <1> 
    57                              <1>     ; hInstance
    58 0000146F 4C897718            <1>     mov     [rdi + 24], r14
    59                              <1> 
    60                              <1>     ; hIcon = NULL
    61                              <1>     ;mov     qword [rdi + 32], 0
    62                              <1> 
    63                              <1>     ; hCursor = LoadCursorW(NULL, IDC_ARROW)
    64                              <1>     ; --- Aufruf: Systemcursor laden
    65                              <1>     ; (hInstance   = NULL,
    66                              <1>     ; lpCursorName = MAKEINTRESOURCEW(IDC_ARROW)) ---
    67 00001473 31C9                <1>     xor     ecx, ecx
    68 00001475 BA007F0000          <1>     mov     edx, IDC_ARROW
    69 0000147A 4883EC20            <1>     sub     rsp, 32
    70                              <1>     ;call_LoadCursorW
    71 0000147E 48B800000040010000- <1>     mov     rax, IMAGE_BASE
    71 00001487 00                  <1>
    72 00001488 480508340000        <1>     add     rax, RVA_IDATA(IAT_win32_LoadCursorW)
    73 0000148E FF10                <1>     call    [rax]
    74 00001490 4883C420            <1>     add     rsp, 32
    75 00001494 48894728            <1>     mov     [rdi + 40], rax
    76                              <1> 
    77                              <1>     ; hbrBackground = (HBRUSH)(COLOR_WINDOW+1)
    78 00001498 48C7473006000000    <1>     mov     qword [rdi + 48], COLOR_WINDOW + 1
    79                              <1> 
    80                              <1>     ; lpszMenuName = NULL
    81 000014A0 48C7473800000000    <1>     mov     qword [rdi + 56], 0
    82                              <1> 
    83                              <1>     ; lpszClassName = &winclassW (UTF-16)
    84                              <1>     GETEXT  rax, winclassW
   523                              <2> %if __pre_stop == 0
   524 000014A8 48B800000040010000- <2>  mov %1, IMAGE_BASE
   524 000014B1 00                  <2>
   525 000014B2 4805B8400000        <2>  add %1, RVA_DATA(_cW_%2)
   526                              <2> %endif
    85 000014B8 48894740            <1>     mov     [rdi + 64], rax
    86                              <1> 
    87                              <1>     ; hIconSm = NULL
    88                              <1>     ;mov     qword [rdi + 72], 0
    89                              <1> 
    90                              <1>     ; RegisterClassExW(&wc)
    91 000014BC 4889F9              <1>     mov     rcx, rdi
    92 000014BF 4883EC20            <1>     sub     rsp, 32
    93                              <1>     ;CALL_IAT RegisterClassExW
    94 000014C3 48B800000040010000- <1>     mov     rax, IMAGE_BASE
    94 000014CC 00                  <1>
    95 000014CD 480530340000        <1>     add     rax, RVA_IDATA(IAT_win32_RegisterClassExW)
    96 000014D3 FF10                <1>     call    [rax]
    97 000014D5 4883C420            <1>     add     rsp, 32
    98 000014D9 85C0                <1>     test    eax, eax
    99 000014DB 0F8445010000        <1>     jz      .reg_fail
   100                              <1> 
   101                              <1>     .class_ok:
   102                              <1>     ;ShowMessageW ClassOkW,capW
   103                              <1>     ; ------------------------------------------------------------------------
   104                              <1>     ; CreateWindowExW(
   105                              <1>     ;   0, class, title, WS_OVERLAPPEDWINDOW,
   106                              <1>     ;   CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,
   107                              <1>     ;   NULL, NULL, hInstance, NULL)
   108                              <1>     ; ------------------------------------------------------------------------
   109                              <1>     ;AddShadow 32 + 8*8                                 ; 32 Shadow + 8 Args
   110 000014E1 31C9                <1>     xor     ecx, ecx                                    ;  1. dwExStyle = 0
   111                              <1>     GETEXT  rdx, winclassW                              ;  2. lpClassName
   523                              <2> %if __pre_stop == 0
   524 000014E3 48BA00000040010000- <2>  mov %1, IMAGE_BASE
   524 000014EC 00                  <2>
   525 000014ED 4881C2B8400000      <2>  add %1, RVA_DATA(_cW_%2)
   526                              <2> %endif
   112                              <1>     GETEXT  r8 , titleW                                 ;  3. lpWindowName
   523                              <2> %if __pre_stop == 0
   524 000014F4 49B800000040010000- <2>  mov %1, IMAGE_BASE
   524 000014FD 00                  <2>
   525 000014FE 4981C07E400000      <2>  add %1, RVA_DATA(_cW_%2)
   526                              <2> %endif
   113 00001505 41B90000CF00        <1>     mov     r9d, WS_OVERLAPPEDWINDOW                    ;  4. dwStyle
   114                              <1> 
   115                              <1>     ; 5.–12. Parameter auf den Stack (in der Reihenfolge!)
   116                              <1>     ;AddShadow 32 + 8*8
   117 0000150B 4883EC60            <1>     sub     rsp, 32 + 8*8
   118 0000150F C744242064000000    <1>     mov     dword [rsp+32], 100 ;CW_USEDEFAULT             ;  5. X
   119 00001517 C744242864000000    <1>     mov     dword [rsp+40], 100 ; CW_USEDEFAULT             ;  6. Y
   120 0000151F C744243049010000    <1>     mov     dword [rsp+48], 329 ;CW_USEDEFAULT             ;  7. nWidth
   121 00001527 C7442438C8000000    <1>     mov     dword [rsp+56], 200 ;CW_USEDEFAULT             ;  8, nHeight
   122 0000152F 48C744244000000000  <1>     mov     qword [rsp+64], 0                         ;  9. hWndParent
   123 00001538 48C744244800000000  <1>     mov     qword [rsp+72], 0                         ; 10. hMenu
   124 00001541 4C89742450          <1>     mov     [rsp+80], r14                             ; 11. hInstance
   125 00001546 48C744245800000000  <1>     mov     qword [rsp+88], 0                         ; 12. lpParam
   126                              <1>     
   127 0000154F 48B800000040010000- <1>     mov     rax, IMAGE_BASE
   127 00001558 00                  <1>
   128 00001559 480598330000        <1>     add     rax, RVA_IDATA(IAT_win32_CreateWindowExW)
   129 0000155F FF10                <1>     call    [rax]
   130                              <1>     
   131 00001561 4883C460            <1>     add     rsp, 32 + 8*8
   132                              <1>     
   133 00001565 4885C0              <1>     test    rax, rax
   134 00001568 0F84D8000000        <1>     jz      .cw_fail                  ; <--- here jump
   135                              <1>     
   136 0000156E 4889C6              <1>     mov    rsi, rax
   137                              <1>     
   138                              <1>     ; Show / Update
   139 00001571 4889F1              <1>     mov     rcx, rsi
   140 00001574 BA05000000          <1>     mov     edx, 5                            ; SW_SHOW
   141 00001579 4883EC20            <1>     sub     rsp, 32
   142 0000157D 48B800000040010000- <1>     mov     rax, IMAGE_BASE
   142 00001586 00                  <1>
   143 00001587 480550340000        <1>     add     rax, RVA_IDATA(IAT_win32_ShowWindow)
   144 0000158D FF10                <1>     call    [rax]
   145 0000158F 4883C420            <1>     add     rsp, 32
   146                              <1> 
   147 00001593 4889F1              <1>     mov     rcx, rsi
   148 00001596 4883EC20            <1>     sub     rsp, 32
   149 0000159A 48B800000040010000- <1>     mov     rax, IMAGE_BASE
   149 000015A3 00                  <1>
   150 000015A4 480568340000        <1>     add     rax, RVA_IDATA(IAT_win32_UpdateWindow)
   151 000015AA FF10                <1>     call    [rax]
   152 000015AC 4883C420            <1>     add     rsp, 32
   153                              <1> 
   154                              <1>     ; --- Message loop (MSG=48B) ---
   155 000015B0 4883EC30            <1>     sub     rsp, 48
   156 000015B4 4889E3              <1>     mov     rbx, rsp
   157                              <1>     .msg:
   158 000015B7 4889D9              <1>         mov     rcx, rbx
   159 000015BA 31D2                <1>         xor     edx, edx
   160 000015BC 4531C0              <1>         xor     r8d, r8d
   161 000015BF 4531C9              <1>         xor     r9d, r9d
   162 000015C2 4883EC20            <1>         sub     rsp, 32
   163 000015C6 48B800000040010000- <1>         mov     rax, IMAGE_BASE
   163 000015CF 00                  <1>
   164 000015D0 4805D8330000        <1>         add     rax, RVA_IDATA(IAT_win32_GetMessageW)
   165 000015D6 FF10                <1>         call    [rax]
   166 000015D8 4883C420            <1>         add     rsp, 32
   167 000015DC 85C0                <1>         test    eax, eax
   168 000015DE 743C                <1>         jz      .quit
   169                              <1> 
   170 000015E0 4889D9              <1>         mov     rcx, rbx
   171 000015E3 4883EC20            <1>         sub     rsp, 32
   172 000015E7 48B800000040010000- <1>         mov     rax, IMAGE_BASE
   172 000015F0 00                  <1>
   173 000015F1 480560340000        <1>         add     rax, RVA_IDATA(IAT_win32_TranslateMessage)
   174 000015F7 FF10                <1>         call    [rax]
   175 000015F9 4883C420            <1>         add     rsp, 32
   176                              <1> 
   177 000015FD 4889D9              <1>         mov     rcx, rbx
   178 00001600 4883EC20            <1>         sub     rsp, 32
   179 00001604 48B800000040010000- <1>         mov     rax, IMAGE_BASE
   179 0000160D 00                  <1>
   180 0000160E 4805A8330000        <1>         add     rax, RVA_IDATA(IAT_win32_DispatchMessageW)
   181 00001614 FF10                <1>         call    [rax]
   182 00001616 4883C420            <1>         add     rsp, 32
   183 0000161A EB9B                <1>         jmp     .msg
   184                              <1>     .quit:
   185 0000161C 4883C430            <1>     add     rsp, 48
   186                              <1> 
   187                              <1>     ; Aufräumen WNDCLASSEXW-Reserve
   188 00001620 4883C450            <1>     add     rsp, 80
   189 00001624 EB40                <1>     jmp     .ok
   190                              <1> 
   191                              <1>     .reg_fail:
   192                              <1>         ; GetLastError + anzeigen (du hast die Routine schon)
   193 00001626 4883EC20            <1>         sub     rsp,32
   194 0000162A 48B800000040010000- <1>         mov     rax, IMAGE_BASE
   194 00001633 00                  <1>
   195 00001634 4805D8320000        <1>         add     rax, RVA_IDATA(IAT_win32_GetLastError)
   196 0000163A FF10                <1>         call    [rax]
   197 0000163C 4883C420            <1>         add     rsp,32
   198                              <1>         ; eax -> deine Fehleranzeige
   199 00001640 4883C450            <1>         add     rsp, 80
   200 00001644 EB20                <1>         jmp     .done
   201                              <1>         
   202                              <1>     .cw_fail:
   203 00001646 4883EC20            <1>         sub     rsp,32
   204 0000164A 48B800000040010000- <1>         mov     rax, IMAGE_BASE
   204 00001653 00                  <1>
   205 00001654 4805D8320000        <1>         add     rax, RVA_IDATA(IAT_win32_GetLastError)
   206 0000165A FF10                <1>         call    [rax]
   207 0000165C 4883C420            <1>         add     rsp,32
   208                              <1>         ; eax -> deine Fehleranzeige
   209 00001660 4883C450            <1>         add     rsp, 80
   210 00001664 EB00                <1>         jmp     .done
   211                              <1>         
   212                              <1>     .ok:
   213                              <1>     .done:
   214                              <1>     
   215                              <1>     call_ExitProcess 2
   769                              <2> %if DOS_SHELL == 1
   770                              <2>  EMIT_ERROR ERROR_Win32API
   771                              <2> %else
   772                              <2>  %if %0 == 1
   773 00001666 B802000000          <2>  mov rax, %1
   774                              <2>  %else
   775                              <2>  mov rax, 0
   776                              <2>  %endif
   777                              <2>  CALL_IAT ExitProcess
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 0000166B 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 0000166F 48B890320040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001678 00                  <3>
   293 00001679 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 0000167B 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   778                              <2> %endif
    27                                  %include 'winproc.asm'
     1                              <1> bits 64
     2                              <1> 
     3                              <1> WndProc:
     4                              <1>     AddShadow
   155                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <2>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <2> %else
   158                              <2>  %if __pre_stop == 0
   159                              <2>  %if %0 == 1
   160                              <2>  sub rsp, %1
   161                              <2>  %else
   162 0000167F 4883EC20            <2>  sub rsp, SW_SHADOW
   163                              <2>  %endif
   164                              <2>  %endif
   165                              <2> %endif
     5                              <1>     MESSAGE WM_CLOSE,wm_close
  1024 00001683 83FA10              <2>  cmp edx, %1
  1025 00001686 0F8490000000        <2>  je .%2
     6                              <1>     MESSAGE WM_ERASEBKGND,wm_erasebkgnd
  1024 0000168C 83FA14              <2>  cmp edx, %1
  1025 0000168F 7410                <2>  je .%2
     7                              <1>     DefWindowProcW
   924 00001691 48B8A0330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_DefWindowProcW)
   924 0000169A 00                  <2>
     8                              <1>     DelShadow
   172                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <2>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <2> %else
   175                              <2>  %if __pre_stop == 0
   176                              <2>  %if %0 == 1
   177                              <2>  add rsp, %1
   178                              <2>  %else
   179 0000169B 4883C420            <2>  add rsp, SW_SHADOW
   180                              <2>  %endif
   181                              <2>  %endif
   182                              <2> %endif
     9 0000169F FF20                <1>     jmp [rax]
    10                              <1> .wm_erasebkgnd:
    11                              <1>     AddShadow 48
   155                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <2>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <2> %else
   158                              <2>  %if __pre_stop == 0
   159                              <2>  %if %0 == 1
   160 000016A1 4883EC30            <2>  sub rsp, %1
   161                              <2>  %else
   162                              <2>  sub rsp, SW_SHADOW
   163                              <2>  %endif
   164                              <2>  %endif
   165                              <2> %endif
    12 000016A5 48894C2420          <1>     mov [rsp+32],rcx
    13 000016AA 4C89442428          <1>     mov [rsp+40],r8
    14 000016AF 488D542410          <1>     lea rdx,[rsp+16]
    15 000016B4 488B4C2420          <1>     mov rcx,[rsp+32]
    16                              <1>     CALL_IAT GetClientRect
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 000016B9 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 000016BD 48B8D0330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000016C6 00                  <2>
   293 000016C7 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 000016C9 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    17 000016CD 488B4C2420          <1>     mov rcx,[rsp+32]
    18 000016D2 48C7C2F6FFFFFF      <1>     mov rdx,GCLP_HBRBACKGROUND
    19                              <1>     CALL_IAT GetClassLongPtrW
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 000016D9 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 000016DD 48B8C8330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000016E6 00                  <2>
   293 000016E7 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 000016E9 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    20 000016ED 488B4C2428          <1>     mov rcx,[rsp+40]
    21 000016F2 488D542410          <1>     lea rdx,[rsp+16]
    22 000016F7 4989C0              <1>     mov r8,rax
    23                              <1>     CALL_IAT FillRect
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 000016FA 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 000016FE 48B8C0330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001707 00                  <2>
   293 00001708 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 0000170A 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    24                              <1>     Return 1
   673                              <2> %if %0 == 1
   674 0000170E B801000000          <2>  mov eax, %1
   675                              <2> %else
   676                              <2>  ret
   677                              <2> %endif
    25                              <1>     DelShadow 48
   172                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <2>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <2> %else
   175                              <2>  %if __pre_stop == 0
   176                              <2>  %if %0 == 1
   177 00001713 4883C430            <2>  add rsp, %1
   178                              <2>  %else
   179                              <2>  add rsp, SW_SHADOW
   180                              <2>  %endif
   181                              <2>  %endif
   182                              <2> %endif
    26                              <1>     DelShadow
   172                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <2>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <2> %else
   175                              <2>  %if __pre_stop == 0
   176                              <2>  %if %0 == 1
   177                              <2>  add rsp, %1
   178                              <2>  %else
   179 00001717 4883C420            <2>  add rsp, SW_SHADOW
   180                              <2>  %endif
   181                              <2>  %endif
   182                              <2> %endif
    27 0000171B C3                  <1>     ret
    28                              <1> .wm_close:
    29                              <1>     Zero ecx
   303                              <2>  %if __pre_stop == 0
   304 0000171C 31C9                <2>  xor %1, %1
   305                              <2>  %endif
    30                              <1>     CALL_IAT PostQuitMessage
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 0000171E 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001722 48B858340040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 0000172B 00                  <2>
   293 0000172C FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 0000172E 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    31                              <1>     DelShadow
   172                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <2>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <2> %else
   175                              <2>  %if __pre_stop == 0
   176                              <2>  %if %0 == 1
   177                              <2>  add rsp, %1
   178                              <2>  %else
   179 00001732 4883C420            <2>  add rsp, SW_SHADOW
   180                              <2>  %endif
   181                              <2>  %endif
   182                              <2> %endif
    32                              <1>     Zero eax
   303                              <2>  %if __pre_stop == 0
   304 00001736 31C0                <2>  xor %1, %1
   305                              <2>  %endif
    33 00001738 C3                  <1>     ret
    28                                  %include 'text64.asm'
     1                              <1> PASCALMAIN:
     2                              <1> ; -------------------------------------------------------------------
     3                              <1> ; 64 Bytes reservieren:
     4                              <1> ;  - 32 B Shadow Space (Pflicht als Caller vor jedem call)
     5                              <1> ;  - 32 B "lokal" (hier ungenutzt, dient auch dem Alignment)
     6                              <1> ; Nach push rbp ist rsp 16-Byte aligned; 64 hlt das Alignment.
     7                              <1> ; -------------------------------------------------------------------
     8                              <1>     FUNC_ENTER
   723                              <2> %if %0 == 1
   724                              <2>  AddShadow %1
   725                              <2> %else
   726                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001739 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   727                              <2> %endif
   728 0000173D 55                  <2>  push rbp
   729 0000173E 4889E5              <2>  mov rbp, rsp
     9                              <1> 
    10                              <1>     INIT_CONSOLE
  1615                              <2> %if DOS_SHELL == 1
  1616                              <2>  call dos_init_console
  1617                              <2>  SCREEN_CLEAR
  1618                              <2> %else
  1619 00001741 E83B040000          <2>  call init_app
  1620 00001746 E85D040000          <2>  call init_console
  1621                              <2> %endif
    11                              <1>         
    12                              <1>     ; text + prompt ausgeben
    13                              <1>     WRITE_CON_A cap2A
  1158                              <2> %if DOS_SHELL == 1
  1159                              <2>  %if %0 == 2
  1160                              <2>  PUTS_COLOR %1, %2
  1161                              <2>  %else
  1162                              <2>  PUTS_COLOR %1, 0x07
  1163                              <2>  %endif
  1164                              <2> %else
  1165                              <2> 
  1166 0000174B 31C0                <2>  xor eax, eax
  1167 0000174D 48B900400040010000- <2>  mov rcx, PTR64(_cA_%1)
  1167 00001756 00                  <2>
  1168 00001757 E894070000          <2>  call GET_STR_LEN
  1169 0000175C 4989C6              <2>  mov r14, rax
  1170                              <2>  GET_CON_O_HANDLE r12
  1258                              <3> %if DOS_SHELL == 1
  1259                              <3>  EMIT_ERROR ERROR_Win32API
  1260                              <3> %else
  1261 0000175F B9F5FFFFFF          <3>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001764 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001768 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001771 00                  <4>
   293 00001772 FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001774 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1263 00001778 4989C4              <3>  mov %1, rax
  1264                              <3> %endif
  1171 0000177B 4C89E1              <2>  mov rcx, r12
  1172 0000177E 48BA00400040010000- <2>  mov rdx, PTR64(_cA_%1)
  1172 00001787 00                  <2>
  1173 00001788 4D89F0              <2>  mov r8 , r14
  1174 0000178B 4531C9              <2>  xor r9d, r9d
  1175 0000178E 48C744242000000000  <2>  mov qword [rsp+32], 0
  1176                              <2>  CALL_IAT WriteConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001797 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 0000179B 48B878330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000017A4 00                  <3>
   293 000017A5 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 000017A7 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1177                              <2> %endif
    14                              <1>     WRITE_CON_A prompt
  1158                              <2> %if DOS_SHELL == 1
  1159                              <2>  %if %0 == 2
  1160                              <2>  PUTS_COLOR %1, %2
  1161                              <2>  %else
  1162                              <2>  PUTS_COLOR %1, 0x07
  1163                              <2>  %endif
  1164                              <2> %else
  1165                              <2> 
  1166 000017AB 31C0                <2>  xor eax, eax
  1167 000017AD 48B9D2400040010000- <2>  mov rcx, PTR64(_cA_%1)
  1167 000017B6 00                  <2>
  1168 000017B7 E834070000          <2>  call GET_STR_LEN
  1169 000017BC 4989C6              <2>  mov r14, rax
  1170                              <2>  GET_CON_O_HANDLE r12
  1258                              <3> %if DOS_SHELL == 1
  1259                              <3>  EMIT_ERROR ERROR_Win32API
  1260                              <3> %else
  1261 000017BF B9F5FFFFFF          <3>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 000017C4 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 000017C8 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000017D1 00                  <4>
   293 000017D2 FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 000017D4 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1263 000017D8 4989C4              <3>  mov %1, rax
  1264                              <3> %endif
  1171 000017DB 4C89E1              <2>  mov rcx, r12
  1172 000017DE 48BAD2400040010000- <2>  mov rdx, PTR64(_cA_%1)
  1172 000017E7 00                  <2>
  1173 000017E8 4D89F0              <2>  mov r8 , r14
  1174 000017EB 4531C9              <2>  xor r9d, r9d
  1175 000017EE 48C744242000000000  <2>  mov qword [rsp+32], 0
  1176                              <2>  CALL_IAT WriteConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 000017F7 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 000017FB 48B878330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001804 00                  <3>
   293 00001805 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001807 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1177                              <2> %endif
    15                              <1>     READL_CON_A dst
  1185                              <2> %if DOS_SHELL == 1
  1186                              <2>  %if %0 == 1
  1187                              <2>  mov dx, PTR16(_cA_%1)
  1188                              <2>  call DOSReadLn
  1189                              <2>  %else
  1190                              <2>  mov dx, PTR16(_cA_dos_buffer)
  1191                              <2>  call DOSReadLn
  1192                              <2>  %endif
  1193                              <2> %else
  1194                              <2> 
  1195                              <2>  GET_CON_I_HANDLE r13
  1271                              <3> %if DOS_SHELL == 1
  1272                              <3>  EMIT_ERROR ERROR_Win32API
  1273                              <3> %else
  1274 0000180B B9F6FFFFFF          <3>  mov ecx, STD_INPUT_HANDLE
  1275                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001810 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001814 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 0000181D 00                  <4>
   293 0000181E FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001820 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1276 00001824 4989C5              <3>  mov %1, rax
  1277                              <3> %endif
  1196                              <2> 
  1197 00001827 4C89E9              <2>  mov rcx, r13
  1198 0000182A 48BA-               <2>  mov rdx, PTR64(_cA_%1)
  1198 0000182C (1816004001000000)  <2>
  1199 00001834 41B87F000000        <2>  mov r8d, 127
  1200 0000183A 49B9-               <2>  mov r9 , PTR64(written)
  1200 0000183C (FD16004001000000)  <2>
  1201 00001844 4831C0              <2>  xor rax, rax
  1202 00001847 4889442420          <2>  mov [rsp+32], rax
  1203                              <2>  CALL_IAT ReadConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 0000184C 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001850 48B808330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001859 00                  <3>
   293 0000185A FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 0000185C 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1204                              <2> %endif
    16                              <1>     
    17                              <1>     SET_COLOR_TO ATTR_BG_BLACK, ATTR_FG_LIGHT_YELLOW
  1326                              <2> %if %0 == 2
  1327                              <2>  STRCPY_ANSI buffer_B, consoleColor_1, empty
  1226 00001860 48B9-               <3>  mov rcx, IMAGE_BASE + RVA_DATA(_cA_%1)
  1226 00001862 (1815004001000000)  <3>
  1227 0000186A 48BAE2400040010000- <3>  mov rdx, IMAGE_BASE + RVA_DATA(_cA_%2)
  1227 00001873 00                  <3>
  1228 00001874 49B8-               <3>  mov r8 , IMAGE_BASE + RVA_DATA(_cA_%3)
  1228 00001876 (A016004001000000)  <3>
  1229 0000187E E842060000          <3>  call concat_ansi
  1328                              <2>  STRCAT_ANSI buffer_B, console_color_%1, buffer_semi, console_color_%2, consoleColor_2
  1232                              <3>  %xdefine __DSTSYM (_cA_%1 + 4)
  1233                              <3> 
  1234                              <3>  %rotate 1
  1235                              <3>  %rep %0-1
  1236                              <3> 
  1237                              <3>  mov rdi, IMAGE_BASE
  1238                              <3>  add rdi, RVA_DATA(__DSTSYM)
  1239                              <3>  xor eax, eax
  1240                              <3>  mov rcx, -1
  1241                              <3>  repne scasb
  1242                              <3>  lea rcx, [rdi - 1]
  1243                              <3> 
  1244                              <3> 
  1245                              <3>  mov rdx, PTR64(_cA_%1)
  1246                              <3>  mov r8 , PTR64(_cA_empty)
  1247                              <3>  call concat_ansi
  1248                              <3> 
  1249                              <3>  %rotate 1
  1250                              <3>  %endrep
  1236                              <4> 
  1237 00001883 48BF00000040010000- <4>  mov rdi, IMAGE_BASE
  1237 0000188C 00                  <4>
  1238 0000188D 4881C7(1C150000)    <4>  add rdi, RVA_DATA(__DSTSYM)
  1239 00001894 31C0                <4>  xor eax, eax
  1240 00001896 48C7C1FFFFFFFF      <4>  mov rcx, -1
  1241 0000189D F2AE                <4>  repne scasb
  1242 0000189F 488D4FFF            <4>  lea rcx, [rdi - 1]
  1243                              <4> 
  1244                              <4> 
  1245 000018A3 48BA26410040010000- <4>  mov rdx, PTR64(_cA_%1)
  1245 000018AC 00                  <4>
  1246 000018AD 49B8-               <4>  mov r8 , PTR64(_cA_empty)
  1246 000018AF (A016004001000000)  <4>
  1247 000018B7 E809060000          <4>  call concat_ansi
  1248                              <4> 
  1249                              <4>  %rotate 1
  1236                              <4> 
  1237 000018BC 48BF00000040010000- <4>  mov rdi, IMAGE_BASE
  1237 000018C5 00                  <4>
  1238 000018C6 4881C7(1C150000)    <4>  add rdi, RVA_DATA(__DSTSYM)
  1239 000018CD 31C0                <4>  xor eax, eax
  1240 000018CF 48C7C1FFFFFFFF      <4>  mov rcx, -1
  1241 000018D6 F2AE                <4>  repne scasb
  1242 000018D8 488D4FFF            <4>  lea rcx, [rdi - 1]
  1243                              <4> 
  1244                              <4> 
  1245 000018DC 48BAF4400040010000- <4>  mov rdx, PTR64(_cA_%1)
  1245 000018E5 00                  <4>
  1246 000018E6 49B8-               <4>  mov r8 , PTR64(_cA_empty)
  1246 000018E8 (A016004001000000)  <4>
  1247 000018F0 E8D0050000          <4>  call concat_ansi
  1248                              <4> 
  1249                              <4>  %rotate 1
  1236                              <4> 
  1237 000018F5 48BF00000040010000- <4>  mov rdi, IMAGE_BASE
  1237 000018FE 00                  <4>
  1238 000018FF 4881C7(1C150000)    <4>  add rdi, RVA_DATA(__DSTSYM)
  1239 00001906 31C0                <4>  xor eax, eax
  1240 00001908 48C7C1FFFFFFFF      <4>  mov rcx, -1
  1241 0000190F F2AE                <4>  repne scasb
  1242 00001911 488D4FFF            <4>  lea rcx, [rdi - 1]
  1243                              <4> 
  1244                              <4> 
  1245 00001915 48BA17410040010000- <4>  mov rdx, PTR64(_cA_%1)
  1245 0000191E 00                  <4>
  1246 0000191F 49B8-               <4>  mov r8 , PTR64(_cA_empty)
  1246 00001921 (A016004001000000)  <4>
  1247 00001929 E897050000          <4>  call concat_ansi
  1248                              <4> 
  1249                              <4>  %rotate 1
  1236                              <4> 
  1237 0000192E 48BF00000040010000- <4>  mov rdi, IMAGE_BASE
  1237 00001937 00                  <4>
  1238 00001938 4881C7(1C150000)    <4>  add rdi, RVA_DATA(__DSTSYM)
  1239 0000193F 31C0                <4>  xor eax, eax
  1240 00001941 48C7C1FFFFFFFF      <4>  mov rcx, -1
  1241 00001948 F2AE                <4>  repne scasb
  1242 0000194A 488D4FFF            <4>  lea rcx, [rdi - 1]
  1243                              <4> 
  1244                              <4> 
  1245 0000194E 48BAE7400040010000- <4>  mov rdx, PTR64(_cA_%1)
  1245 00001957 00                  <4>
  1246 00001958 49B8-               <4>  mov r8 , PTR64(_cA_empty)
  1246 0000195A (A016004001000000)  <4>
  1247 00001962 E85E050000          <4>  call concat_ansi
  1248                              <4> 
  1249                              <4>  %rotate 1
  1331                              <2>  WRITE_CON_A buffer_B
  1158                              <3> %if DOS_SHELL == 1
  1159                              <3>  %if %0 == 2
  1160                              <3>  PUTS_COLOR %1, %2
  1161                              <3>  %else
  1162                              <3>  PUTS_COLOR %1, 0x07
  1163                              <3>  %endif
  1164                              <3> %else
  1165                              <3> 
  1166 00001967 31C0                <3>  xor eax, eax
  1167 00001969 48B9-               <3>  mov rcx, PTR64(_cA_%1)
  1167 0000196B (1815004001000000)  <3>
  1168 00001973 E878050000          <3>  call GET_STR_LEN
  1169 00001978 4989C6              <3>  mov r14, rax
  1170                              <3>  GET_CON_O_HANDLE r12
  1258                              <4> %if DOS_SHELL == 1
  1259                              <4>  EMIT_ERROR ERROR_Win32API
  1260                              <4> %else
  1261 0000197B B9F5FFFFFF          <4>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <4>  CALL_IAT GetStdHandle
   287                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <5>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <5> %else
   290                              <5>  %if __pre_stop == 0
   291                              <5>  AddShadow
   155                              <6> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <6>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <6> %else
   158                              <6>  %if __pre_stop == 0
   159                              <6>  %if %0 == 1
   160                              <6>  sub rsp, %1
   161                              <6>  %else
   162 00001980 4883EC20            <6>  sub rsp, SW_SHADOW
   163                              <6>  %endif
   164                              <6>  %endif
   165                              <6> %endif
   292 00001984 48B8F0320040010000- <5>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 0000198D 00                  <5>
   293 0000198E FF10                <5>  call [rax]
   294                              <5>  DelShadow
   172                              <6> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <6>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <6> %else
   175                              <6>  %if __pre_stop == 0
   176                              <6>  %if %0 == 1
   177                              <6>  add rsp, %1
   178                              <6>  %else
   179 00001990 4883C420            <6>  add rsp, SW_SHADOW
   180                              <6>  %endif
   181                              <6>  %endif
   182                              <6> %endif
   295                              <5>  %endif
   296                              <5> %endif
  1263 00001994 4989C4              <4>  mov %1, rax
  1264                              <4> %endif
  1171 00001997 4C89E1              <3>  mov rcx, r12
  1172 0000199A 48BA-               <3>  mov rdx, PTR64(_cA_%1)
  1172 0000199C (1815004001000000)  <3>
  1173 000019A4 4D89F0              <3>  mov r8 , r14
  1174 000019A7 4531C9              <3>  xor r9d, r9d
  1175 000019AA 48C744242000000000  <3>  mov qword [rsp+32], 0
  1176                              <3>  CALL_IAT WriteConsoleA
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 000019B3 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 000019B7 48B878330040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000019C0 00                  <4>
   293 000019C1 FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 000019C3 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1177                              <3> %endif
  1332                              <2> %endif
    18                              <1>     SCREEN_CLEAR
  1281                              <2> %if DOS_SHELL == 1
  1282                              <2>  call dos_screen_clear
  1283                              <2> %else
  1284                              <2>  GET_CON_O_HANDLE r12
  1258                              <3> %if DOS_SHELL == 1
  1259                              <3>  EMIT_ERROR ERROR_Win32API
  1260                              <3> %else
  1261 000019C7 B9F5FFFFFF          <3>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 000019CC 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 000019D0 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 000019D9 00                  <4>
   293 000019DA FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 000019DC 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1263 000019E0 4989C4              <3>  mov %1, rax
  1264                              <3> %endif
  1285                              <2>  STRCPY_ANSI buffer_B, consoleColor_3, empty
  1226 000019E3 48B9-               <3>  mov rcx, IMAGE_BASE + RVA_DATA(_cA_%1)
  1226 000019E5 (1815004001000000)  <3>
  1227 000019ED 48BAE9400040010000- <3>  mov rdx, IMAGE_BASE + RVA_DATA(_cA_%2)
  1227 000019F6 00                  <3>
  1228 000019F7 49B8-               <3>  mov r8 , IMAGE_BASE + RVA_DATA(_cA_%3)
  1228 000019F9 (A016004001000000)  <3>
  1229 00001A01 E8BF040000          <3>  call concat_ansi
  1286                              <2>  WRITE_CON_A buffer_B
  1158                              <3> %if DOS_SHELL == 1
  1159                              <3>  %if %0 == 2
  1160                              <3>  PUTS_COLOR %1, %2
  1161                              <3>  %else
  1162                              <3>  PUTS_COLOR %1, 0x07
  1163                              <3>  %endif
  1164                              <3> %else
  1165                              <3> 
  1166 00001A06 31C0                <3>  xor eax, eax
  1167 00001A08 48B9-               <3>  mov rcx, PTR64(_cA_%1)
  1167 00001A0A (1815004001000000)  <3>
  1168 00001A12 E8D9040000          <3>  call GET_STR_LEN
  1169 00001A17 4989C6              <3>  mov r14, rax
  1170                              <3>  GET_CON_O_HANDLE r12
  1258                              <4> %if DOS_SHELL == 1
  1259                              <4>  EMIT_ERROR ERROR_Win32API
  1260                              <4> %else
  1261 00001A1A B9F5FFFFFF          <4>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <4>  CALL_IAT GetStdHandle
   287                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <5>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <5> %else
   290                              <5>  %if __pre_stop == 0
   291                              <5>  AddShadow
   155                              <6> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <6>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <6> %else
   158                              <6>  %if __pre_stop == 0
   159                              <6>  %if %0 == 1
   160                              <6>  sub rsp, %1
   161                              <6>  %else
   162 00001A1F 4883EC20            <6>  sub rsp, SW_SHADOW
   163                              <6>  %endif
   164                              <6>  %endif
   165                              <6> %endif
   292 00001A23 48B8F0320040010000- <5>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001A2C 00                  <5>
   293 00001A2D FF10                <5>  call [rax]
   294                              <5>  DelShadow
   172                              <6> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <6>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <6> %else
   175                              <6>  %if __pre_stop == 0
   176                              <6>  %if %0 == 1
   177                              <6>  add rsp, %1
   178                              <6>  %else
   179 00001A2F 4883C420            <6>  add rsp, SW_SHADOW
   180                              <6>  %endif
   181                              <6>  %endif
   182                              <6> %endif
   295                              <5>  %endif
   296                              <5> %endif
  1263 00001A33 4989C4              <4>  mov %1, rax
  1264                              <4> %endif
  1171 00001A36 4C89E1              <3>  mov rcx, r12
  1172 00001A39 48BA-               <3>  mov rdx, PTR64(_cA_%1)
  1172 00001A3B (1815004001000000)  <3>
  1173 00001A43 4D89F0              <3>  mov r8 , r14
  1174 00001A46 4531C9              <3>  xor r9d, r9d
  1175 00001A49 48C744242000000000  <3>  mov qword [rsp+32], 0
  1176                              <3>  CALL_IAT WriteConsoleA
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001A52 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001A56 48B878330040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001A5F 00                  <4>
   293 00001A60 FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001A62 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1177                              <3> %endif
  1287                              <2> %endif
    19                              <1> 
    20                              <1>     WRITE_CON_A  dst
  1158                              <2> %if DOS_SHELL == 1
  1159                              <2>  %if %0 == 2
  1160                              <2>  PUTS_COLOR %1, %2
  1161                              <2>  %else
  1162                              <2>  PUTS_COLOR %1, 0x07
  1163                              <2>  %endif
  1164                              <2> %else
  1165                              <2> 
  1166 00001A66 31C0                <2>  xor eax, eax
  1167 00001A68 48B9-               <2>  mov rcx, PTR64(_cA_%1)
  1167 00001A6A (1816004001000000)  <2>
  1168 00001A72 E879040000          <2>  call GET_STR_LEN
  1169 00001A77 4989C6              <2>  mov r14, rax
  1170                              <2>  GET_CON_O_HANDLE r12
  1258                              <3> %if DOS_SHELL == 1
  1259                              <3>  EMIT_ERROR ERROR_Win32API
  1260                              <3> %else
  1261 00001A7A B9F5FFFFFF          <3>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001A7F 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001A83 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001A8C 00                  <4>
   293 00001A8D FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001A8F 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1263 00001A93 4989C4              <3>  mov %1, rax
  1264                              <3> %endif
  1171 00001A96 4C89E1              <2>  mov rcx, r12
  1172 00001A99 48BA-               <2>  mov rdx, PTR64(_cA_%1)
  1172 00001A9B (1816004001000000)  <2>
  1173 00001AA3 4D89F0              <2>  mov r8 , r14
  1174 00001AA6 4531C9              <2>  xor r9d, r9d
  1175 00001AA9 48C744242000000000  <2>  mov qword [rsp+32], 0
  1176                              <2>  CALL_IAT WriteConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001AB2 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001AB6 48B878330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001ABF 00                  <3>
   293 00001AC0 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001AC2 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1177                              <2> %endif
    21                              <1>     WRITE_CON_A  prompt
  1158                              <2> %if DOS_SHELL == 1
  1159                              <2>  %if %0 == 2
  1160                              <2>  PUTS_COLOR %1, %2
  1161                              <2>  %else
  1162                              <2>  PUTS_COLOR %1, 0x07
  1163                              <2>  %endif
  1164                              <2> %else
  1165                              <2> 
  1166 00001AC6 31C0                <2>  xor eax, eax
  1167 00001AC8 48B9D2400040010000- <2>  mov rcx, PTR64(_cA_%1)
  1167 00001AD1 00                  <2>
  1168 00001AD2 E819040000          <2>  call GET_STR_LEN
  1169 00001AD7 4989C6              <2>  mov r14, rax
  1170                              <2>  GET_CON_O_HANDLE r12
  1258                              <3> %if DOS_SHELL == 1
  1259                              <3>  EMIT_ERROR ERROR_Win32API
  1260                              <3> %else
  1261 00001ADA B9F5FFFFFF          <3>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001ADF 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001AE3 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001AEC 00                  <4>
   293 00001AED FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001AEF 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1263 00001AF3 4989C4              <3>  mov %1, rax
  1264                              <3> %endif
  1171 00001AF6 4C89E1              <2>  mov rcx, r12
  1172 00001AF9 48BAD2400040010000- <2>  mov rdx, PTR64(_cA_%1)
  1172 00001B02 00                  <2>
  1173 00001B03 4D89F0              <2>  mov r8 , r14
  1174 00001B06 4531C9              <2>  xor r9d, r9d
  1175 00001B09 48C744242000000000  <2>  mov qword [rsp+32], 0
  1176                              <2>  CALL_IAT WriteConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001B12 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001B16 48B878330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001B1F 00                  <3>
   293 00001B20 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001B22 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1177                              <2> %endif
    22                              <1>     
    23                              <1>     READL_CON_A  dst
  1185                              <2> %if DOS_SHELL == 1
  1186                              <2>  %if %0 == 1
  1187                              <2>  mov dx, PTR16(_cA_%1)
  1188                              <2>  call DOSReadLn
  1189                              <2>  %else
  1190                              <2>  mov dx, PTR16(_cA_dos_buffer)
  1191                              <2>  call DOSReadLn
  1192                              <2>  %endif
  1193                              <2> %else
  1194                              <2> 
  1195                              <2>  GET_CON_I_HANDLE r13
  1271                              <3> %if DOS_SHELL == 1
  1272                              <3>  EMIT_ERROR ERROR_Win32API
  1273                              <3> %else
  1274 00001B26 B9F6FFFFFF          <3>  mov ecx, STD_INPUT_HANDLE
  1275                              <3>  CALL_IAT GetStdHandle
   287                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <4>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <4> %else
   290                              <4>  %if __pre_stop == 0
   291                              <4>  AddShadow
   155                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <5>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <5> %else
   158                              <5>  %if __pre_stop == 0
   159                              <5>  %if %0 == 1
   160                              <5>  sub rsp, %1
   161                              <5>  %else
   162 00001B2B 4883EC20            <5>  sub rsp, SW_SHADOW
   163                              <5>  %endif
   164                              <5>  %endif
   165                              <5> %endif
   292 00001B2F 48B8F0320040010000- <4>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001B38 00                  <4>
   293 00001B39 FF10                <4>  call [rax]
   294                              <4>  DelShadow
   172                              <5> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <5>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <5> %else
   175                              <5>  %if __pre_stop == 0
   176                              <5>  %if %0 == 1
   177                              <5>  add rsp, %1
   178                              <5>  %else
   179 00001B3B 4883C420            <5>  add rsp, SW_SHADOW
   180                              <5>  %endif
   181                              <5>  %endif
   182                              <5> %endif
   295                              <4>  %endif
   296                              <4> %endif
  1276 00001B3F 4989C5              <3>  mov %1, rax
  1277                              <3> %endif
  1196                              <2> 
  1197 00001B42 4C89E9              <2>  mov rcx, r13
  1198 00001B45 48BA-               <2>  mov rdx, PTR64(_cA_%1)
  1198 00001B47 (1816004001000000)  <2>
  1199 00001B4F 41B87F000000        <2>  mov r8d, 127
  1200 00001B55 49B9-               <2>  mov r9 , PTR64(written)
  1200 00001B57 (FD16004001000000)  <2>
  1201 00001B5F 4831C0              <2>  xor rax, rax
  1202 00001B62 4889442420          <2>  mov [rsp+32], rax
  1203                              <2>  CALL_IAT ReadConsoleA
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001B67 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001B6B 48B808330040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001B74 00                  <3>
   293 00001B75 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001B77 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1204                              <2> %endif
    24                              <1>     
    25                              <1>     .exit:
    26                              <1>     FUNC_LEAVE
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   739                              <2> %else
   740                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001B7B 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   741                              <2> %endif
   742 00001B7F 5D                  <2>  pop rbp
   743 00001B80 C3                  <2>  ret
    29                                  %include 'stdlib.inc'
     1                              <1> ;---------------------------------------------------
     2                              <1> ; \file  stdlib.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ;---------------------------------------------------
     8                              <1> 
     9                              <1> ; -------------------------------------------------------------------
    10                              <1> ; \brief initialize the application ...
    11                              <1> ; -------------------------------------------------------------------
    12                              <1> ; --- Prolog ---
    13                              <1> init_app:
    14                              <1>     FUNC_ENTER
   723                              <2> %if %0 == 1
   724                              <2>  AddShadow %1
   725                              <2> %else
   726                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001B81 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   727                              <2> %endif
   728 00001B85 55                  <2>  push rbp
   729 00001B86 4889E5              <2>  mov rbp, rsp
    15                              <1>     
    16 00001B89 B9FCFFFFFF          <1>     mov      ecx, DPI_AWARENESS_CONTEXT_PER_MONITOR_AWARE_V2
    17                              <1>     CALL_IAT SetProcessDpiAwarenessContext
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001B8E 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001B92 48B838340040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001B9B 00                  <2>
   293 00001B9C FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001B9E 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    18                              <1>     
    19                              <1>     FUNC_LEAVE
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   739                              <2> %else
   740                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001BA2 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   741                              <2> %endif
   742 00001BA6 5D                  <2>  pop rbp
   743 00001BA7 C3                  <2>  ret
    20                              <1> 
    21                              <1> ; -------------------------------------------------------------------
    22                              <1> ; \brief init_console - initialize a text console under the Windows
    23                              <1> ;        gui desktop.
    24                              <1> ; \param nothing
    25                              <1> ; -------------------------------------------------------------------
    26                              <1> ; --- Prolog ---
    27                              <1> init_console:
    28                              <1>     FUNC_ENTER
   723                              <2> %if %0 == 1
   724                              <2>  AddShadow %1
   725                              <2> %else
   726                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001BA8 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   727                              <2> %endif
   728 00001BAC 55                  <2>  push rbp
   729 00001BAD 4889E5              <2>  mov rbp, rsp
    29                              <1> 
    30                              <1>     ; --- Konsole öffnen ---
    31                              <1>     CALL_IAT AllocConsole
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001BB0 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001BB4 48B888320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001BBD 00                  <2>
   293 00001BBE FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001BC0 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    32                              <1>     GET_CON_O_HANDLE r12
  1258                              <2> %if DOS_SHELL == 1
  1259                              <2>  EMIT_ERROR ERROR_Win32API
  1260                              <2> %else
  1261 00001BC4 B9F5FFFFFF          <2>  mov ecx, STD_OUTPUT_HANDLE
  1262                              <2>  CALL_IAT GetStdHandle
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001BC9 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001BCD 48B8F0320040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001BD6 00                  <3>
   293 00001BD7 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001BD9 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1263 00001BDD 4989C4              <2>  mov %1, rax
  1264                              <2> %endif
    33                              <1> 
    34 00001BE0 4C89E1              <1>     mov      rcx, r12
    35 00001BE3 488D15(9C020000)    <1>     lea      rdx, [rel mode_out]
    36                              <1>     CALL_IAT GetConsoleMode              ; mode_out
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001BEA 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001BEE 48B8B0320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001BF7 00                  <2>
   293 00001BF8 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001BFA 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    37                              <1>     
    38 00001BFE 8B05(9C020000)      <1>     mov     eax, [rel mode_out]          ; Wert laden (NICHT die Adresse!)
    39 00001C04 83C804              <1>     or      eax, ENABLE_VIRTUAL_TERMINAL_PROCESSING
    40 00001C07 83C808              <1>     or      eax, DISABLE_NEWLINE_AUTO_RETURN     ; optional
    41 00001C0A 89C2                <1>     mov     edx, eax                     ; SetConsoleMode(hOut, newMode)
    42 00001C0C 4C89E1              <1>     mov     rcx, r12
    43                              <1>     CALL_IAT SetConsoleMode
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001C0F 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001C13 48B840330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001C1C 00                  <2>
   293 00001C1D FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001C1F 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    44                              <1> 
    45                              <1>     ; --- INPUT: VT-Input optional aktivieren ---
    46                              <1>     ; hIn besorgen (falls nicht schon vorhanden)
    47                              <1>     GET_CON_I_HANDLE r13                 ; r13 = hIn   (oder mov ecx, STD_INPUT_HANDLE / GetStdHandle)
  1271                              <2> %if DOS_SHELL == 1
  1272                              <2>  EMIT_ERROR ERROR_Win32API
  1273                              <2> %else
  1274 00001C23 B9F6FFFFFF          <2>  mov ecx, STD_INPUT_HANDLE
  1275                              <2>  CALL_IAT GetStdHandle
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001C28 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001C2C 48B8F0320040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001C35 00                  <3>
   293 00001C36 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001C38 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
  1276 00001C3C 4989C5              <2>  mov %1, rax
  1277                              <2> %endif
    48                              <1> 
    49 00001C3F 4C89E9              <1>     mov     rcx, r13
    50 00001C42 488D15(98020000)    <1>     lea     rdx, [rel mode_in]
    51                              <1>     CALL_IAT GetConsoleMode
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001C49 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001C4D 48B8B0320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001C56 00                  <2>
   293 00001C57 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001C59 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    52                              <1>     
    53                              <1>     ; RCX=hOut, RDX=packed COORD
    54 00001C5D 4C89E1              <1>     mov      rcx, r12
    55 00001C60 BA50001900          <1>     mov      edx, (25 << 16) | 80
    56                              <1>     CALL_IAT SetConsoleScreenBufferSize
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001C65 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001C69 48B850330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001C72 00                  <2>
   293 00001C73 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001C75 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    57                              <1>     
    58                              <1>     ; RCX=hOut, RDX=TRUE, R8=&Rect
    59 00001C79 4C89E1              <1>     mov      rcx, r12
    60 00001C7C BA01000000          <1>     mov      edx, 1
    61 00001C81 49B800000040010000- <1>     mov      r8,  IMAGE_BASE
    61 00001C8A 00                  <1>
    62 00001C8B 4981C05E410000      <1>     add      r8,  RVA_DATA(Rect80x25)
    63                              <1>     CALL_IAT SetConsoleWindowInfo
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001C92 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001C96 48B860330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001C9F 00                  <2>
   293 00001CA0 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001CA2 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    64                              <1>     
    65                              <1>     ; old mode holen
    66 00001CA6 488B0D(E1020000)    <1>     mov  rcx, [hIn]
    67 00001CAD 488D15(F5020000)    <1>     lea  rdx, [rel tmpConsoleMode]
    68                              <1>     CALL_IAT GetConsoleMode
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001CB4 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001CB8 48B8B0320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001CC1 00                  <2>
   293 00001CC2 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001CC4 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    69 00001CC8 8B05(F5020000)      <1>     mov  eax, [rel tmpConsoleMode]
    70                              <1> 
    71 00001CCE 0D8D000000          <1>     or   eax, ENABLE_PROCESSED_INPUT             |               ENABLE_EXTENDED_FLAGS              |               ENABLE_VIRTUAL_TERMINAL_PROCESSING |               DISABLE_NEWLINE_AUTO_RETURN
    75 00001CD3 83E0B9              <1>     and  eax, ~(ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT | ENABLE_QUICK_EDIT_MODE)
    76                              <1> 
    77 00001CD6 89C2                <1>     mov  edx, eax
    78 00001CD8 488B0D(E1020000)    <1>     mov  rcx, [hIn]
    79                              <1>     CALL_IAT SetConsoleMode
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001CDF 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001CE3 48B840330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001CEC 00                  <2>
   293 00001CED FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001CEF 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    80                              <1> 
    81                              <1>     CALL_IAT GetConsoleWindow
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001CF3 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001CF7 48B8C0320040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001D00 00                  <2>
   293 00001D01 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001D03 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    82 00001D07 4889C3              <1>     mov      rbx, rax                   ; rbx = hwnd
    83 00001D0A 4885C0              <1>     test     rax, rax
    84 00001D0D 745A                <1>     jz       .done                      ; no console available
    85                              <1>     ; HMENU m = GetSystemMenu(h, FALSE);
    86 00001D0F 4889D9              <1>     mov      rcx, rbx                   ; hWnd
    87 00001D12 31D2                <1>     xor      edx, edx                   ; FALSE
    88                              <1>     CALL_IAT GetSystemMenu
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001D14 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001D18 48B8F0330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001D21 00                  <2>
   293 00001D22 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001D24 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    89 00001D28 4885C0              <1>     test     rax, rax
    90 00001D2B 743C                <1>     jz       .done
    91 00001D2D 4889C7              <1>     mov      rdi, rax                   ; rdi = HMENU
    92                              <1>     ; EnableMenuItem(m, SC_CLOSE, MF_BYCOMMAND | MF_GRAYED);
    93 00001D30 4889F9              <1>     mov      rcx, rdi                   ; HMENU
    94 00001D33 BA60F00000          <1>     mov      edx, SC_CLOSE              ; uIDEnableItem
    95 00001D38 41B801000000        <1>     mov      r8d, MF_BYCOMMAND | MF_GRAYED
    96                              <1>     CALL_IAT EnableMenuItem
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001D3E 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001D42 48B8B8330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001D4B 00                  <2>
   293 00001D4C FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001D4E 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
    97                              <1>     ; Neuzeichnen der Titelleiste/Buttons
    98 00001D52 4889D9              <1>     mov      rcx, rbx
    99                              <1>     CALL_IAT DrawMenuBar
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001D55 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001D59 48B8B0330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001D62 00                  <2>
   293 00001D63 FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001D65 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
   100                              <1>     .after_menu:
   101                              <1>     .done:
   102                              <1>     
   103                              <1>     ; default color for the console:
   104 00001D69 66B82800            <1>     mov ax, ATTR_BG_BLACK
   105 00001D6D 668905FB0F0000      <1>     mov [_cA_console_bg], ax
   106                              <1>     ;
   107 00001D74 66B85D00            <1>     mov ax, ATTR_FG_LIGHT_YELLOW
   108 00001D78 668905F20F0000      <1>     mov [_cA_console_fg], ax
   109                              <1>     
   110                              <1> ; --- Epilog ---
   111                              <1>     FUNC_LEAVE
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   739                              <2> %else
   740                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001D7F 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   741                              <2> %endif
   742 00001D83 5D                  <2>  pop rbp
   743 00001D84 C3                  <2>  ret
   112                              <1> 
   113                              <1> ; -------------------------------------------------------------------
   114                              <1> ; UTF-8 -> UTF-16
   115                              <1> ; -------------------------------------------------------------------
   116                              <1> ascii_to_utf8:
   117                              <1>     ;FUNC_ENTER
   118 00001D85 53                  <1>     push    rbx
   119                              <1>     
   120                              <1>     ; Eingaben sichern
   121 00001D86 4989CA              <1>     mov     r10, rcx        ; save src (UTF-8)
   122 00001D89 4989D3              <1>     mov     r11, rdx        ; save dst (LPWSTR)
   123                              <1>     
   124                              <1>     ; MultiByteToWideChar(CodePage=65001, Flags=0, src, -1, dst, cch)
   125 00001D8C B9E9FD0000          <1>     mov     ecx, 65001      ; CodePage = CP_UTF8
   126 00001D91 31D2                <1>     xor     edx, edx        ; dwFlags = 0           (Achtung: edx nullt rdx!)
   127 00001D93 4D89D0              <1>     mov     r8,  r10        ; lpMultiByteStr = saved src
   128 00001D96 41B9FFFFFFFF        <1>     mov     r9d, -1         ; cbMultiByte = -1 (NUL-terminiert)
   129                              <1>     
   130 00001D9C 4883EC28            <1>     sub     rsp, 40               ; shadow space
   131 00001DA0 4C895C2418          <1>     mov     [rsp+24], r11         ; lpWideCharStr
   132 00001DA5 C744242000010000    <1>     mov     dword [rsp+32], 256   ; cchWideChar
   133                              <1>     
   134                              <1>     CALL_IAT MultiByteToWideChar
   287                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <2> %else
   290                              <2>  %if __pre_stop == 0
   291                              <2>  AddShadow
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160                              <3>  sub rsp, %1
   161                              <3>  %else
   162 00001DAD 4883EC20            <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   292 00001DB1 48B868330040010000- <2>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001DBA 00                  <2>
   293 00001DBB FF10                <2>  call [rax]
   294                              <2>  DelShadow
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177                              <3>  add rsp, %1
   178                              <3>  %else
   179 00001DBD 4883C420            <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   295                              <2>  %endif
   296                              <2> %endif
   135                              <1>     
   136 00001DC1 4883C428            <1>     add     rsp, 40
   137 00001DC5 5B                  <1>     pop     rbx
   138 00001DC6 C3                  <1>     ret
   139                              <1>     ;FUNC_LEAVE
   140                              <1>     
   141                              <1> ; -------------------------------------------------------------------
   142                              <1> ; \brief routine to handle win32api GetLastError ...
   143                              <1> ; -------------------------------------------------------------------
   144                              <1> HandleLastError:
   145                              <1>     ; --- Prolog ---
   146                              <1>     FUNC_ENTER 64
   723                              <2> %if %0 == 1
   724                              <2>  AddShadow %1
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160 00001DC7 4883EC40            <3>  sub rsp, %1
   161                              <3>  %else
   162                              <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   725                              <2> %else
   726                              <2>  AddShadow
   727                              <2> %endif
   728 00001DCB 55                  <2>  push rbp
   729 00001DCC 4889E5              <2>  mov rbp, rsp
   147                              <1>     
   148                              <1>     ; FormatMessageW(FM_FLAGS, NULL, err, LANGID_DEFAULT, (LPWSTR)&pMsg, 0, NULL)
   149 00001DCF B900130000          <1>     mov     ecx, FM_FLAGS                       ; rcx = dwFlags
   150 00001DD4 31D2                <1>     xor     edx, edx                            ; rdx = lpSource = NULL
   151 00001DD6 4189C0              <1>     mov     r8d, eax                            ; 3th dwMessageId
   152 00001DD9 41B900040000        <1>     mov     r9d, LANGID_DEFAULT                 ; 4th dwLanguageId
   153                              <1>     
   154                              <1>     AddShadow (32 + (3 * 8) + 8)                ; 32 shadow + 3 stack-args (5th,6th,7th) + 8 padding
   155                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <2>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <2> %else
   158                              <2>  %if __pre_stop == 0
   159                              <2>  %if %0 == 1
   160 00001DDF 4883EC40            <2>  sub rsp, %1
   161                              <2>  %else
   162                              <2>  sub rsp, SW_SHADOW
   163                              <2>  %endif
   164                              <2>  %endif
   165                              <2> %endif
   155 00001DE3 48B800000040010000- <1>     mov     rax, IMAGE_BASE
   155 00001DEC 00                  <1>
   156 00001DED 480566410000        <1>     add     rax, RVA_DATA(pMsg)                 ; rax = &pmsg
   157 00001DF3 4889442420          <1>     mov     [rsp+32], rax                       ; 5th: lpBuffer (as LPWSTR*) because of ALLOCATE_BUFFER
   158 00001DF8 C744242800000000    <1>     mov     dword [rsp+40], 0                   ; 6th: nSize = 0 (Min-Größe)
   159 00001E00 48C744243000000000  <1>     mov     qword [rsp+48], 0                   ; 7th: Arguments = NULL
   160                              <1> 
   161                              <1>     ;AddShadow
   162                              <1>     call_FormatMessageW
   785                              <2>  CALL_IAT FormatMessageW
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001E09 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001E0D 48B898320040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001E16 00                  <3>
   293 00001E17 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001E19 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   163                              <1>     DelShadow (32 + (3 * 8) + 8)
   172                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <2>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <2> %else
   175                              <2>  %if __pre_stop == 0
   176                              <2>  %if %0 == 1
   177 00001E1D 4883C440            <2>  add rsp, %1
   178                              <2>  %else
   179                              <2>  add rsp, SW_SHADOW
   180                              <2>  %endif
   181                              <2>  %endif
   182                              <2> %endif
   164 00001E21 85C0                <1>     test    eax, eax
   165 00001E23 7468                <1>     jz      .no_text                                    ; 0 = Fehler (kein Text verfügbar)
   166                              <1> 
   167                              <1>     ; MessageBoxW(NULL, pMsg, titleW, MB_ICONERROR)
   168 00001E25 31C9                <1>     xor     ecx, ecx
   169 00001E27 48BA00000040010000- <1>     mov     rdx, IMAGE_BASE
   169 00001E30 00                  <1>
   170 00001E31 4881C266410000      <1>     add     rdx, RVA_DATA(pMsg)                 ; lpText = pMsg (LPWSTR)
   171                              <1>     GETEXT  r8 , ErrTitleW
   523                              <2> %if __pre_stop == 0
   524 00001E38 49B800000040010000- <2>  mov %1, IMAGE_BASE
   524 00001E41 00                  <2>
   525 00001E42 4981C040400000      <2>  add %1, RVA_DATA(_cW_%2)
   526                              <2> %endif
   172 00001E49 41B910000000        <1>     mov     r9d, MB_ICONERROR
   173                              <1>     call_MessageBoxW
   866                              <2>  CALL_IAT MessageBoxW
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001E4F 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001E53 48B818340040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001E5C 00                  <3>
   293 00001E5D FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001E5F 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   174                              <1> 
   175                              <1>     ; LocalFree(pMsg)
   176 00001E63 48B900000040010000- <1>     mov     rcx, IMAGE_BASE
   176 00001E6C 00                  <1>
   177 00001E6D 4881C166410000      <1>     add     rcx, RVA_DATA(pMsg)
   178 00001E74 488B09              <1>     mov     rcx, [rcx]
   179                              <1>     call_LocalFree
   855                              <2> %if DOS_SHELL == 1
   856                              <2>  EMIT_ERROR ERROR_Win32API
   857                              <2> %else
   858                              <2>  CALL_IAT MessageBoxW
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001E77 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001E7B 48B818340040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001E84 00                  <3>
   293 00001E85 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001E87 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   859                              <2> %endif
   180                              <1> 
   181 00001E8B EB05                <1>     jmp     .done
   182                              <1>     
   183                              <1> .no_text:
   184 00001E8D E86D000000          <1>     call HandleLastErrorHexCode
   185                              <1> .done:
   186                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001E92 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001E96 5D                  <2>  pop rbp
   743 00001E97 C3                  <2>  ret
   187                              <1> 
   188                              <1> ; -------------------------------------------------------------------
   189                              <1> ; rcx = BYTE buffer[20]
   190                              <1> ; edx = DWORD number
   191                              <1> ; return:
   192                              <1> ; rax = BYTE * start
   193                              <1> ; -------------------------------------------------------------------
   194                              <1> u32_to_dec:
   195 00001E98 89D0                <1> 	mov     eax, edx        ; number
   196 00001E9A 4C8D4114            <1> 	lea     r8, [rcx + 20]  ; end of buffer
   197 00001E9E 49FFC8              <1> 	dec     r8
   198 00001EA1 41C60000            <1> 	mov     byte [r8], 0    ; null terminate
   199                              <1>     .loop:
   200 00001EA5 B90A000000          <1>     mov     rcx, 10
   201 00001EAA BA00000000          <1>     mov     rdx, 0
   202 00001EAF 48F7F1              <1>     div     rcx
   203 00001EB2 80C230              <1>     add     dl, '0'         ; convert remainder to ascii
   204 00001EB5 49FFC8              <1>     dec     r8
   205 00001EB8 418810              <1>     mov     byte [r8], dl
   206 00001EBB 4883F800            <1>     cmp     rax, 0
   207 00001EBF 77E4                <1>     ja      .loop
   208 00001EC1 4C89C0              <1>     mov     rax, r8         ; pointer to start of number
   209 00001EC4 C3                  <1>     ret
   210                              <1>     
   211                              <1> ; -------------------------------------------------------------------
   212                              <1> ; \brief  concatenate two ANSI string's to a single one string dest-
   213                              <1> ;         ination. The dst buffer must be big enough !
   214                              <1> ;
   215                              <1> ; \desc   int concat_ansi(char *dst, const char *s1, const char *s2)
   216                              <1> ;
   217                              <1> ; \param  RCX -> string buffer = dst
   218                              <1> ;
   219                              <1> ; \param  RDX -> string = src1
   220                              <1> ; \param  R8  -> string = src2
   221                              <1> ;
   222                              <1> ; \return RAX -> bool   = 1 if 0x00 found, else 0
   223                              <1> ; -------------------------------------------------------------------
   224                              <1> concat_ansi:
   225                              <1>     ; -----------------------------------------
   226                              <1>     ; iterate over first string
   227                              <1>     ; -----------------------------------------
   228                              <1>     .loop_s1:
   229 00001EC5 8A02                <1>     mov     al, [rdx]   ; get character on current src1 position
   230 00001EC7 84C0                <1>     test    al, al      ; 0x00 found ?
   231 00001EC9 740A                <1>     jz      .loop_s2    ; yes, then exit .loop
   232                              <1>     
   233 00001ECB 8801                <1>     mov     [rcx], al   ; move al character to dst buffer
   234 00001ECD 48FFC2              <1>     inc     rdx         ; increment position of src1 buffer
   235 00001ED0 48FFC1              <1>     inc     rcx         ; ... of dst buffer
   236 00001ED3 EBF0                <1>     jmp     .loop_s1    ; next character
   237                              <1>     
   238                              <1>     ; -----------------------------------------
   239                              <1>     ; iterate over second string
   240                              <1>     ; -----------------------------------------
   241                              <1>     .loop_s2:
   242 00001ED5 418A00              <1>     mov     al, [r8]    ; get character on current src2 position
   243 00001ED8 84C0                <1>     test    al, al      ; 0x00 found ?
   244 00001EDA 740A                <1>     jz      .finish     ; yes, then exit .loop
   245                              <1>     
   246 00001EDC 8801                <1>     mov     [rcx], al   ; move al character to dst buffer
   247 00001EDE 49FFC0              <1>     inc     r8          ; increment position of src2 buffer
   248 00001EE1 48FFC1              <1>     inc     rcx         ; ... of dst buffer
   249 00001EE4 EBEF                <1>     jmp     .loop_s2    ; next char
   250                              <1>     
   251                              <1>     .finish:
   252 00001EE6 31C0                <1>     xor     eax, eax    ; AL = 0
   253 00001EE8 8801                <1>     mov     [rcx], al   ; null-terminator
   254 00001EEA B801000000          <1>     mov     eax, 1      ; return true, found end
   255 00001EEF C3                  <1>     ret
   256                              <1>     
   257                              <1> GET_STR_LEN:
   258 00001EF0 31C0                <1>     xor     eax, eax            ; RAX = 0 (counter)
   259                              <1>     .loop:
   260 00001EF2 8A1401              <1>     mov     dl, byte [rcx+rax]  ; get character on current src1 position
   261 00001EF5 84D2                <1>     test    dl, dl              ; 0x00 found ?
   262 00001EF7 7405                <1>     jz      .loop_end           ; yes, then exit .loop
   263 00001EF9 48FFC0              <1>     inc     rax                 ; ... of dst buffer
   264 00001EFC EBF4                <1>     jmp     .loop               ; next character
   265                              <1>     .loop_end:
   266 00001EFE C3                  <1>     ret
   267                              <1> 
   268                              <1> HandleLastErrorHexCode:
   269                              <1>     ; --- Prolog ---
   270                              <1>     FUNC_ENTER 64
   723                              <2> %if %0 == 1
   724                              <2>  AddShadow %1
   155                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <3>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <3> %else
   158                              <3>  %if __pre_stop == 0
   159                              <3>  %if %0 == 1
   160 00001EFF 4883EC40            <3>  sub rsp, %1
   161                              <3>  %else
   162                              <3>  sub rsp, SW_SHADOW
   163                              <3>  %endif
   164                              <3>  %endif
   165                              <3> %endif
   725                              <2> %else
   726                              <2>  AddShadow
   727                              <2> %endif
   728 00001F03 55                  <2>  push rbp
   729 00001F04 4889E5              <2>  mov rbp, rsp
   271                              <1>     
   272                              <1>     ; -----------------------------------------------------------
   273                              <1>     ; write: work around for: mov [rel last_error], eax
   274                              <1>     ;
   275                              <1>     ; 1. load abs Virtual Address into register
   276                              <1>     ; 2. access through this register
   277                              <1>     ; -----------------------------------------------------------
   278 00001F07 48BA-               <1>     mov   rdx, IMAGE_BASE + RVA_DATA(last_error)
   278 00001F09 (F916004001000000)  <1>
   279 00001F11 8902                <1>     mov   dword [rdx], eax
   280                              <1>     
   281                              <1> ;    mov   rcx, IMAGE_BASE + RVA_DATA(_cW_wbuf)
   282                              <1> ;    mov   rdx, IMAGE_BASE + RVA_DATA(_cW_fmtW)
   283                              <1>     
   284                              <1>     ; wsprintfW(wbuf, fmtW, err, err)
   285                              <1>     ; (variadisch: AL = 0, Shadow Space 32B)
   286 00001F13 4189C8              <1>     mov     r8d, ecx                     ; 1. varg
   287 00001F16 4189D1              <1>     mov     r9d, edx                     ; 2. varg
   288 00001F19 31C0                <1>     xor     eax, eax                     ; AL=0 (keine XMM-Args)
   289                              <1>     
   290                              <1>     call_wsprintfW
   873                              <2>  CALL_IAT wsprintfW
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001F1B 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001F1F 48B870340040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001F28 00                  <3>
   293 00001F29 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001F2B 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   291                              <1>         
   292                              <1>     ; MessageBoxW(NULL, wbuf, titleW, MB_ICONERROR)
   293 00001F2F 31C9                <1>     xor     ecx, ecx
   294                              <1> ;    mov     rdx, IMAGE_BASE + RVA_DATA(_cW_wbuf)
   295                              <1> ;    mov     r8,  IMAGE_BASE + RVA_DATA(_cW_ErrTitleW)
   296 00001F31 41B910000000        <1>     mov     r9d, 0x10                    ; MB_ICONERROR
   297                              <1>     
   298                              <1>     call_MessageBoxW
   866                              <2>  CALL_IAT MessageBoxW
   287                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   288                              <3>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   289                              <3> %else
   290                              <3>  %if __pre_stop == 0
   291                              <3>  AddShadow
   155                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   156                              <4>  EMIT_ERROR 'AddShadow is only used for Windows 10+ 64-Bit development.'
   157                              <4> %else
   158                              <4>  %if __pre_stop == 0
   159                              <4>  %if %0 == 1
   160                              <4>  sub rsp, %1
   161                              <4>  %else
   162 00001F37 4883EC20            <4>  sub rsp, SW_SHADOW
   163                              <4>  %endif
   164                              <4>  %endif
   165                              <4> %endif
   292 00001F3B 48B818340040010000- <3>  mov rax, IMAGE_BASE + RVA_IDATA(IAT_win32_%1)
   292 00001F44 00                  <3>
   293 00001F45 FF10                <3>  call [rax]
   294                              <3>  DelShadow
   172                              <4> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <4>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <4> %else
   175                              <4>  %if __pre_stop == 0
   176                              <4>  %if %0 == 1
   177                              <4>  add rsp, %1
   178                              <4>  %else
   179 00001F47 4883C420            <4>  add rsp, SW_SHADOW
   180                              <4>  %endif
   181                              <4>  %endif
   182                              <4> %endif
   295                              <3>  %endif
   296                              <3> %endif
   299                              <1> 
   300                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001F4B 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001F4F 5D                  <2>  pop rbp
   743 00001F50 C3                  <2>  ret
   301                              <1> 
   302                              <1> ; -------------------------------------------------------------------
   303                              <1> ; int utf8_to_cp1252_char(const uint8_t* src, uint8_t* dst)
   304                              <1> ; RCX = src (UTF-8), RDX = dst (CP1252)
   305                              <1> ; Rückgabe:
   306                              <1> ;   RAX = Anzahl gelesener UTF-8-Bytes (1..2), 0 bei NUL
   307                              <1> ;   AL  = geschriebenes CP1252-Byte
   308                              <1> ;   CF  = 1, wenn unmappbar -> '?' geschrieben
   309                              <1> ; Hinweis: mapped werden ASCII und: äöüÄÖÜß
   310                              <1> ; -------------------------------------------------------------------
   311                              <1> utf8_to_cp1252_char:
   312                              <1>     ;FUNC_ENTER 64
   313 00001F51 53                  <1>     push    rbx
   314                              <1> 
   315 00001F52 8A19                <1>     mov     bl, [rcx]
   316 00001F54 84DB                <1>     test    bl, bl
   317 00001F56 0F84ED000000        <1>     jz      .nul               ; Stringende
   318                              <1> 
   319                              <1>     ; ASCII (00..7F) 1:1
   320 00001F5C 80FB7F              <1>     cmp     bl, 0x7F
   321 00001F5F 7638                <1>     jbe     .ascii
   322                              <1> 
   323                              <1>     ; --- 2-Byte UTF-8, die mit C3 beginnen (äöüÄÖÜß) ---
   324 00001F61 80FBC3              <1>     cmp     bl, 0xC3
   325 00001F64 0F85BE000000        <1>     jne     .unmap
   326 00001F6A 8A7901              <1>     mov     bh, [rcx+1]        ; zweites Byte
   327                              <1>     ; Tabelle:
   328                              <1>     ; C3 84 -> Ä (C4)
   329                              <1>     ; C3 96 -> Ö (D6)
   330                              <1>     ; C3 9C -> Ü (DC)
   331                              <1>     ; C3 A4 -> ä (E4)
   332                              <1>     ; C3 B6 -> ö (F6)
   333                              <1>     ; C3 BC -> ü (FC)
   334                              <1>     ; C3 9F -> ß (DF)
   335                              <1> 
   336                              <1>     ; upper-case
   337 00001F6D 80FF84              <1>     cmp     bh, 0x84
   338 00001F70 7438                <1>     je      .emit_C4
   339 00001F72 80FF96              <1>     cmp     bh, 0x96
   340 00001F75 7445                <1>     je      .emit_D6
   341 00001F77 80FF9C              <1>     cmp     bh, 0x9C
   342 00001F7A 7452                <1>     je      .emit_DC
   343                              <1>     ; lower-case
   344 00001F7C 80FFA4              <1>     cmp     bh, 0xA4
   345 00001F7F 745F                <1>     je      .emit_E4
   346 00001F81 80FFB6              <1>     cmp     bh, 0xB6
   347 00001F84 746C                <1>     je      .emit_F6
   348 00001F86 80FFBC              <1>     cmp     bh, 0xBC
   349 00001F89 7479                <1>     je      .emit_FC
   350 00001F8B 80FF9F              <1>     cmp     bh, 0x9F
   351 00001F8E 0F8482000000        <1>     je      .emit_DF
   352                              <1> 
   353 00001F94 E98F000000          <1>     jmp     .unmap
   354                              <1> 
   355                              <1>     .ascii:
   356 00001F99 881A                <1>     mov     [rdx], bl
   357 00001F9B 88D8                <1>     mov     al, bl
   358 00001F9D B801000000          <1>     mov     rax, 1
   359 00001FA2 F8                  <1>     clc
   360 00001FA3 5B                  <1>     pop     rbx
   361                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FA4 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001FA8 5D                  <2>  pop rbp
   743 00001FA9 C3                  <2>  ret
   362                              <1> 
   363 00001FAA C602C4              <1>     .emit_C4:   mov byte [rdx], 0xC4  ; Ä
   364 00001FAD B0C4                <1>                 mov al, 0xC4
   365 00001FAF B802000000          <1>                 mov rax, 2
   366 00001FB4 F8                  <1>                 clc
   367 00001FB5 5B                  <1>                 pop rbx
   368                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FB6 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001FBA 5D                  <2>  pop rbp
   743 00001FBB C3                  <2>  ret
   369 00001FBC C602D6              <1>     .emit_D6:   mov byte [rdx], 0xD6  ; Ö
   370 00001FBF B0D6                <1>                 mov al, 0xD6
   371 00001FC1 B802000000          <1>                 mov rax, 2
   372 00001FC6 F8                  <1>                 clc
   373 00001FC7 5B                  <1>                 pop rbx
   374                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FC8 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001FCC 5D                  <2>  pop rbp
   743 00001FCD C3                  <2>  ret
   375 00001FCE C602DC              <1>     .emit_DC:   mov byte [rdx], 0xDC  ; Ü
   376 00001FD1 B0DC                <1>                 mov al, 0xDC
   377 00001FD3 B802000000          <1>                 mov rax, 2
   378 00001FD8 F8                  <1>                 clc
   379 00001FD9 5B                  <1>                 pop rbx
   380                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FDA 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001FDE 5D                  <2>  pop rbp
   743 00001FDF C3                  <2>  ret
   381 00001FE0 C602E4              <1>     .emit_E4:   mov byte [rdx], 0xE4  ; ä
   382 00001FE3 B0E4                <1>                 mov al, 0xE4
   383 00001FE5 B802000000          <1>                 mov rax, 2
   384 00001FEA F8                  <1>                 clc
   385 00001FEB 5B                  <1>                 pop rbx
   386                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FEC 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00001FF0 5D                  <2>  pop rbp
   743 00001FF1 C3                  <2>  ret
   387 00001FF2 C602F6              <1>     .emit_F6:   mov byte [rdx], 0xF6  ; ö
   388 00001FF5 B0F6                <1>                 mov al, 0xF6
   389 00001FF7 B802000000          <1>                 mov rax, 2
   390 00001FFC F8                  <1>                 clc
   391 00001FFD 5B                  <1>                 pop rbx
   392                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00001FFE 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002002 5D                  <2>  pop rbp
   743 00002003 C3                  <2>  ret
   393 00002004 C602FC              <1>     .emit_FC:   mov byte [rdx], 0xFC  ; ü
   394 00002007 B0FC                <1>                 mov al, 0xFC
   395 00002009 B802000000          <1>                 mov rax, 2
   396 0000200E F8                  <1>                 clc
   397 0000200F 5B                  <1>                 pop rbx
   398                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00002010 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002014 5D                  <2>  pop rbp
   743 00002015 C3                  <2>  ret
   399 00002016 C602DF              <1>     .emit_DF:   mov byte [rdx], 0xDF  ; ß
   400 00002019 B0DF                <1>                 mov al, 0xDF
   401 0000201B B802000000          <1>                 mov rax, 2
   402 00002020 F8                  <1>                 clc
   403 00002021 5B                  <1>                 pop rbx
   404                              <1>                 FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00002022 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002026 5D                  <2>  pop rbp
   743 00002027 C3                  <2>  ret
   405                              <1>     .unmap:
   406                              <1>     ; Unbekannt -> '?'
   407 00002028 C6023F              <1>     mov     byte [rdx], '?'
   408 0000202B B03F                <1>     mov     al, '?'
   409 0000202D F9                  <1>     stc
   410                              <1>     ; grob: falls Startbyte >= C2 und < E0, konsumieren wir 2 Bytes,
   411                              <1>     ; sonst 1 (damit der Aufrufer weiterkommt).
   412 0000202E B801000000          <1>     mov     rax, 1
   413 00002033 80FBC2              <1>     cmp     bl, 0xC2
   414 00002036 720A                <1>     jb      .ret_unmap
   415 00002038 80FBE0              <1>     cmp     bl, 0xE0
   416 0000203B 7305                <1>     jae     .ret_unmap
   417 0000203D B802000000          <1>     mov     rax, 2
   418                              <1>     .ret_unmap:
   419 00002042 5B                  <1>     pop     rbx
   420                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00002043 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002047 5D                  <2>  pop rbp
   743 00002048 C3                  <2>  ret
   421                              <1> 
   422                              <1>     .nul:
   423 00002049 31C0                <1>     xor     eax, eax            ; RAX=0, AL=0
   424 0000204B F8                  <1>     clc
   425                              <1>     .exit:
   426 0000204C 5B                  <1>     pop     rbx
   427                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 0000204D 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002051 5D                  <2>  pop rbp
   743 00002052 C3                  <2>  ret
   428                              <1> ; -------------------------------------------------------------------
   429                              <1> ; size_t utf8_to_cp1252(const uint8_t* src, uint8_t* dst)
   430                              <1> ; RCX=src, RDX=dst -> RAX = geschriebene Bytes, dst ist NUL-terminiert
   431                              <1> ; -------------------------------------------------------------------
   432                              <1> utf8_to_cp1252:
   433                              <1>     ;FUNC_ENTER 64
   434 00002053 56                  <1>     push    rsi
   435 00002054 57                  <1>     push    rdi
   436 00002055 4889CE              <1>     mov     rsi, rcx         ; s = src
   437 00002058 4889D7              <1>     mov     rdi, rdx         ; d = dst
   438 0000205B 4831C0              <1>     xor     rax, rax         ; count = 0
   439                              <1>     
   440                              <1>     .next:
   441 0000205E 0FB606              <1>     movzx   eax, byte [rsi]  ; RCX bleibt unverändert
   442 00002061 EB1A                <1>     jmp .done
   443 00002063 85C0                <1>     test    eax, eax
   444 00002065 7416                <1>     jz      .done
   445                              <1> 
   446                              <1>     ; pro Zeichen mappen
   447 00002067 4889F1              <1>     mov     rcx, rsi
   448 0000206A 4889FA              <1>     mov     rdx, rdi
   449 0000206D E8DFFEFFFF          <1>     call    utf8_to_cp1252_char
   450                              <1>     
   451                              <1>     ; RAX = konsumierte UTF-8-Bytes
   452 00002072 4801C6              <1>     add     rsi, rax
   453 00002075 48FFC7              <1>     inc     rdi
   454 00002078 48FFC0              <1>     inc     rax              ; count++
   455 0000207B EBE1                <1>     jmp     .next
   456                              <1>     .done:
   457                              <1>     ;push    rcx
   458                              <1>     ;ShowMessageW titleW,capW
   459                              <1>     ;pop     rcx
   460 0000207D C60700              <1>     mov     byte [rdi], 0
   461 00002080 5F                  <1>     pop     rdi
   462 00002081 5E                  <1>     pop     rsi
   463 00002082 C3                  <1>     ret
   464                              <1>     FUNC_LEAVE 64
   737                              <2> %if %0 == 1
   738                              <2>  DelShadow %1
   172                              <3> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   173                              <3>  EMIT_ERROR 'DelShadow is only used for Windows 10+ 64-Bit development.'
   174                              <3> %else
   175                              <3>  %if __pre_stop == 0
   176                              <3>  %if %0 == 1
   177 00002083 4883C440            <3>  add rsp, %1
   178                              <3>  %else
   179                              <3>  add rsp, SW_SHADOW
   180                              <3>  %endif
   181                              <3>  %endif
   182                              <3> %endif
   739                              <2> %else
   740                              <2>  DelShadow
   741                              <2> %endif
   742 00002087 5D                  <2>  pop rbp
   743 00002088 C3                  <2>  ret
    30                                  
    31                                  text_end:
    32                                  
    33                                  %include 'imports.inc'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  imports.inc
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a tiny MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> ; .idata (Imports)
     9                              <1> ; -----------------------------------------------------------------------------
    10 00002089 00<rep 177h>        <1>     times (IDATA_RAW_PTR - ($ - $$)) db 0
    11                              <1> idata_start:
    12                              <1> 
    13                              <1> ; -----------------------------------------------------------------------------
    14                              <1> ; Import Directory (KERNEL32 + USER32) + Terminator
    15                              <1> ; -----------------------------------------------------------------------------
    16                              <1> MAKE_IMPORT import_dir, kernel32, user32, msvcrt
   250                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   251                              <2>  EMIT_ERROR 'MAKE_IMPORT is only used for Windows 10+ 64-Bit development.'
   252                              <2> %else
   253                              <2>  %if __pre_stop == 0
   254                              <2>  %define __DIR %1
   255                              <2>  %1:
   256                              <2>  %assign __n %0-1
   257                              <2>  %rep __n
   258                              <2>  dd RVA_IDATA(INT_win32_%2)
   259                              <2>  dd 0,0
   260                              <2>  dd RVA_IDATA(dll_win32_%2)
   261                              <2>  dd RVA_IDATA(iat_win32_%2)
   262                              <2>  %rotate 1
   263                              <2>  %endrep
   258 00002200 50300000            <3>  dd RVA_IDATA(INT_win32_%2)
   259 00002204 0000000000000000    <3>  dd 0,0
   260 0000220C 3D390000            <3>  dd RVA_IDATA(dll_win32_%2)
   261 00002210 80320000            <3>  dd RVA_IDATA(iat_win32_%2)
   262                              <3>  %rotate 1
   258 00002214 68310000            <3>  dd RVA_IDATA(INT_win32_%2)
   259 00002218 0000000000000000    <3>  dd 0,0
   260 00002220 4A390000            <3>  dd RVA_IDATA(dll_win32_%2)
   261 00002224 98330000            <3>  dd RVA_IDATA(iat_win32_%2)
   262                              <3>  %rotate 1
   258 00002228 50320000            <3>  dd RVA_IDATA(INT_win32_%2)
   259 0000222C 0000000000000000    <3>  dd 0,0
   260 00002234 55390000            <3>  dd RVA_IDATA(dll_win32_%2)
   261 00002238 80340000            <3>  dd RVA_IDATA(iat_win32_%2)
   262                              <3>  %rotate 1
   264 0000223C 000000000000000000- <2>  dd 0,0,0,0,0
   264 00002245 000000000000000000- <2>
   264 0000224E 0000                <2>
   265                              <2>  __DIR %+ _end:
   266                              <2>  %undef __DIR
   267                              <2>  %endif
   268                              <2> %endif
    17                              <1> 
    18                              <1> ; -----------------------------------------------------------------------------
    19                              <1> ; INTs (OriginalFirstThunk)
    20                              <1> ; -----------------------------------------------------------------------------
    21                              <1> MAKE_INT INT_win32_kernel32, KERNEL32_FUNCS
   189                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   190                              <2>  EMIT_ERROR 'MAKE_INT is only used for Windows 10+ 64-Bit development.'
   191                              <2> %else
   192                              <2>  %if __pre_stop == 0
   193                              <2>  %1:
   194                              <2>  %assign __n %0-1
   195                              <2>  %rep __n
   196                              <2>  dq RVA_IDATA(HN_win32_%2)
   197                              <2>  %rotate 1
   198                              <2>  %endrep
   196 00002250 B034000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002258 BB34000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002260 CA34000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002268 D834000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002270 E934000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002278 0635000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002280 2435000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002288 3535000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002290 5235000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002298 6535000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022A0 7D35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022A8 9B35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022B0 AA35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022B8 BD35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022C0 CE35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022C8 DD35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022D0 EC35000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022D8 F835000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022E0 0736000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022E8 1B36000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022F0 2A36000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000022F8 3536000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002300 4536000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002308 5436000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002310 6F36000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002318 8036000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002320 9536000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002328 B236000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002330 CC36000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002338 E336000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002340 F936000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002348 0F37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002350 1F37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002358 2F37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   199 00002360 0000000000000000    <2>  dq 0
   200                              <2>  %endif
   201                              <2> %endif
    22                              <1> MAKE_INT INT_win32_user32, USER32_FUNCS
   189                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   190                              <2>  EMIT_ERROR 'MAKE_INT is only used for Windows 10+ 64-Bit development.'
   191                              <2> %else
   192                              <2>  %if __pre_stop == 0
   193                              <2>  %1:
   194                              <2>  %assign __n %0-1
   195                              <2>  %rep __n
   196                              <2>  dq RVA_IDATA(HN_win32_%2)
   197                              <2>  %rotate 1
   198                              <2>  %endrep
   196 00002368 3B37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002370 4D37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002378 5E37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002380 7137000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002388 7F37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002390 9037000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002398 9B37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023A0 AE37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023A8 BE37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023B0 CC37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023B8 DE37000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023C0 F137000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023C8 0138000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023D0 1538000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023D8 2538000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023E0 3338000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023E8 4138000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023F0 4F38000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 000023F8 6338000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002400 7038000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002408 8338000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002410 A338000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002418 B738000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002420 C638000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002428 D338000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002430 E538000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002438 F838000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002440 0739000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   199 00002448 0000000000000000    <2>  dq 0
   200                              <2>  %endif
   201                              <2> %endif
    23                              <1> MAKE_INT INT_win32_msvcrt, MSVCRT_FUNCS
   189                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   190                              <2>  EMIT_ERROR 'MAKE_INT is only used for Windows 10+ 64-Bit development.'
   191                              <2> %else
   192                              <2>  %if __pre_stop == 0
   193                              <2>  %1:
   194                              <2>  %assign __n %0-1
   195                              <2>  %rep __n
   196                              <2>  dq RVA_IDATA(HN_win32_%2)
   197                              <2>  %rotate 1
   198                              <2>  %endrep
   196 00002450 1339000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002458 1B39000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002460 2339000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002468 2D39000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   196 00002470 3639000000000000    <3>  dq RVA_IDATA(HN_win32_%2)
   197                              <3>  %rotate 1
   199 00002478 0000000000000000    <2>  dq 0
   200                              <2>  %endif
   201                              <2> %endif
    24                              <1> 
    25                              <1> ; -----------------------------------------------------------------------------
    26                              <1> ; IATs (FirstThunk)
    27                              <1> ; -----------------------------------------------------------------------------
    28                              <1> iat_start:
    29                              <1> MAKE_IAT kernel32, KERNEL32_FUNCS
   208                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   209                              <2>  EMIT_ERROR 'MAKE_IAT is only used for Windows 10+ 64-Bit development.'
   210                              <2> %else
   211                              <2>  %if __pre_stop == 0
   212                              <2>  iat_win32_%1:
   213                              <2>  %assign __n %0-1
   214                              <2>  %rep __n
   215                              <2>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <2>  %rotate 1
   217                              <2>  %endrep
   215 00002480 B034000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002488 BB34000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002490 CA34000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002498 D834000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024A0 E934000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024A8 0635000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024B0 2435000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024B8 3535000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024C0 5235000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024C8 6535000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024D0 7D35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024D8 9B35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024E0 AA35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024E8 BD35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024F0 CE35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000024F8 DD35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002500 EC35000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002508 F835000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002510 0736000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002518 1B36000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002520 2A36000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002528 3536000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002530 4536000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002538 5436000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002540 6F36000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002548 8036000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002550 9536000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002558 B236000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002560 CC36000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002568 E336000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002570 F936000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002578 0F37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002580 1F37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002588 2F37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   218 00002590 0000000000000000    <2>  dq 0
   219                              <2>  %endif
   220                              <2> %endif
    30                              <1> MAKE_IAT user32, USER32_FUNCS
   208                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   209                              <2>  EMIT_ERROR 'MAKE_IAT is only used for Windows 10+ 64-Bit development.'
   210                              <2> %else
   211                              <2>  %if __pre_stop == 0
   212                              <2>  iat_win32_%1:
   213                              <2>  %assign __n %0-1
   214                              <2>  %rep __n
   215                              <2>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <2>  %rotate 1
   217                              <2>  %endrep
   215 00002598 3B37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025A0 4D37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025A8 5E37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025B0 7137000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025B8 7F37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025C0 9037000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025C8 9B37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025D0 AE37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025D8 BE37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025E0 CC37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025E8 DE37000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025F0 F137000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000025F8 0138000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002600 1538000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002608 2538000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002610 3338000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002618 4138000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002620 4F38000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002628 6338000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002630 7038000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002638 8338000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002640 A338000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002648 B738000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002650 C638000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002658 D338000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002660 E538000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002668 F838000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002670 0739000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   218 00002678 0000000000000000    <2>  dq 0
   219                              <2>  %endif
   220                              <2> %endif
    31                              <1> MAKE_IAT msvcrt, MSVCRT_FUNCS
   208                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   209                              <2>  EMIT_ERROR 'MAKE_IAT is only used for Windows 10+ 64-Bit development.'
   210                              <2> %else
   211                              <2>  %if __pre_stop == 0
   212                              <2>  iat_win32_%1:
   213                              <2>  %assign __n %0-1
   214                              <2>  %rep __n
   215                              <2>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <2>  %rotate 1
   217                              <2>  %endrep
   215 00002680 1339000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002688 1B39000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002690 2339000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 00002698 2D39000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   215 000026A0 3639000000000000    <3>  IAT_win32_%2: dq RVA_IDATA(HN_win32_%2)
   216                              <3>  %rotate 1
   218 000026A8 0000000000000000    <2>  dq 0
   219                              <2>  %endif
   220                              <2> %endif
    32                              <1> iat_end:
    33                              <1> 
    34                              <1> ; -----------------------------------------------------------------------------
    35                              <1> ; hintnames (ASCII)
    36                              <1> ; -----------------------------------------------------------------------------
    37                              <1> HNSTR KERNEL32_FUNCS
   227                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   228                              <2>  EMIT_ERROR 'HNSTR is only used for Windows 10+ 64-Bit development.'
   229                              <2> %else
   230                              <2>  %if __pre_stop == 0
   231                              <2>  %assign __n %0
   232                              <2>  %rep __n
   233                              <2>  HN_win32_%1: dw 0
   234                              <2>  db %str(%1), 0
   235                              <2>  %rotate 1
   236                              <2>  %endrep
   233 000026B0 0000                <3>  HN_win32_%1: dw 0
   234 000026B2 6C7374726C656E4100  <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 000026BB 0000                <3>  HN_win32_%1: dw 0
   234 000026BD 416C6C6F63436F6E73- <3>  db %str(%1), 0
   234 000026C6 6F6C6500            <3>
   235                              <3>  %rotate 1
   233 000026CA 0000                <3>  HN_win32_%1: dw 0
   234 000026CC 4578697450726F6365- <3>  db %str(%1), 0
   234 000026D5 737300              <3>
   235                              <3>  %rotate 1
   233 000026D8 0000                <3>  HN_win32_%1: dw 0
   234 000026DA 466F726D61744D6573- <3>  db %str(%1), 0
   234 000026E3 736167655700        <3>
   235                              <3>  %rotate 1
   233 000026E9 0000                <3>  HN_win32_%1: dw 0
   234 000026EB 46696C6C436F6E736F- <3>  db %str(%1), 0
   234 000026F4 6C654F757470757441- <3>
   234 000026FD 747472696275746500  <3>
   235                              <3>  %rotate 1
   233 00002706 0000                <3>  HN_win32_%1: dw 0
   234 00002708 46696C6C436F6E736F- <3>  db %str(%1), 0
   234 00002711 6C654F757470757443- <3>
   234 0000271A 686172616374657257- <3>
   234 00002723 00                  <3>
   235                              <3>  %rotate 1
   233 00002724 0000                <3>  HN_win32_%1: dw 0
   234 00002726 476574436F6E736F6C- <3>  db %str(%1), 0
   234 0000272F 654D6F646500        <3>
   235                              <3>  %rotate 1
   233 00002735 0000                <3>  HN_win32_%1: dw 0
   234 00002737 476574436F6E736F6C- <3>  db %str(%1), 0
   234 00002740 6553637265656E4275- <3>
   234 00002749 66666572496E666F00  <3>
   235                              <3>  %rotate 1
   233 00002752 0000                <3>  HN_win32_%1: dw 0
   234 00002754 476574436F6E736F6C- <3>  db %str(%1), 0
   234 0000275D 6557696E646F7700    <3>
   235                              <3>  %rotate 1
   233 00002765 0000                <3>  HN_win32_%1: dw 0
   234 00002767 47657443757272656E- <3>  db %str(%1), 0
   234 00002770 74436F6E736F6C6546- <3>
   234 00002779 6F6E7400            <3>
   235                              <3>  %rotate 1
   233 0000277D 0000                <3>  HN_win32_%1: dw 0
   234 0000277F 4765744C6172676573- <3>  db %str(%1), 0
   234 00002788 74436F6E736F6C6557- <3>
   234 00002791 696E646F7753697A65- <3>
   234 0000279A 00                  <3>
   235                              <3>  %rotate 1
   233 0000279B 0000                <3>  HN_win32_%1: dw 0
   234 0000279D 4765744C6173744572- <3>  db %str(%1), 0
   234 000027A6 726F7200            <3>
   235                              <3>  %rotate 1
   233 000027AA 0000                <3>  HN_win32_%1: dw 0
   234 000027AC 4765744D6F64756C65- <3>  db %str(%1), 0
   234 000027B5 48616E646C655700    <3>
   235                              <3>  %rotate 1
   233 000027BD 0000                <3>  HN_win32_%1: dw 0
   234 000027BF 47657450726F634164- <3>  db %str(%1), 0
   234 000027C8 647265737300        <3>
   235                              <3>  %rotate 1
   233 000027CE 0000                <3>  HN_win32_%1: dw 0
   234 000027D0 47657453746448616E- <3>  db %str(%1), 0
   234 000027D9 646C6500            <3>
   235                              <3>  %rotate 1
   233 000027DD 0000                <3>  HN_win32_%1: dw 0
   234 000027DF 4C6F61644C69627261- <3>  db %str(%1), 0
   234 000027E8 72794100            <3>
   235                              <3>  %rotate 1
   233 000027EC 0000                <3>  HN_win32_%1: dw 0
   234 000027EE 4C6F63616C46726565- <3>  db %str(%1), 0
   234 000027F7 00                  <3>
   235                              <3>  %rotate 1
   233 000027F8 0000                <3>  HN_win32_%1: dw 0
   234 000027FA 52656164436F6E736F- <3>  db %str(%1), 0
   234 00002803 6C654100            <3>
   235                              <3>  %rotate 1
   233 00002807 0000                <3>  HN_win32_%1: dw 0
   234 00002809 52656164436F6E736F- <3>  db %str(%1), 0
   234 00002812 6C65496E7075745700  <3>
   235                              <3>  %rotate 1
   233 0000281B 0000                <3>  HN_win32_%1: dw 0
   234 0000281D 52656164436F6E736F- <3>  db %str(%1), 0
   234 00002826 6C655700            <3>
   235                              <3>  %rotate 1
   233 0000282A 0000                <3>  HN_win32_%1: dw 0
   234 0000282C 5265616446696C6500  <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 00002835 0000                <3>  HN_win32_%1: dw 0
   234 00002837 52746C4D6F76654D65- <3>  db %str(%1), 0
   234 00002840 6D6F727900          <3>
   235                              <3>  %rotate 1
   233 00002845 0000                <3>  HN_win32_%1: dw 0
   234 00002847 536574436F6E736F6C- <3>  db %str(%1), 0
   234 00002850 65435000            <3>
   235                              <3>  %rotate 1
   233 00002854 0000                <3>  HN_win32_%1: dw 0
   234 00002856 536574436F6E736F6C- <3>  db %str(%1), 0
   234 0000285F 65437572736F72506F- <3>
   234 00002868 736974696F6E00      <3>
   235                              <3>  %rotate 1
   233 0000286F 0000                <3>  HN_win32_%1: dw 0
   234 00002871 536574436F6E736F6C- <3>  db %str(%1), 0
   234 0000287A 654D6F646500        <3>
   235                              <3>  %rotate 1
   233 00002880 0000                <3>  HN_win32_%1: dw 0
   234 00002882 536574436F6E736F6C- <3>  db %str(%1), 0
   234 0000288B 654F75747075744350- <3>
   234 00002894 00                  <3>
   235                              <3>  %rotate 1
   233 00002895 0000                <3>  HN_win32_%1: dw 0
   234 00002897 536574436F6E736F6C- <3>  db %str(%1), 0
   234 000028A0 6553637265656E4275- <3>
   234 000028A9 6666657253697A6500  <3>
   235                              <3>  %rotate 1
   233 000028B2 0000                <3>  HN_win32_%1: dw 0
   234 000028B4 536574436F6E736F6C- <3>  db %str(%1), 0
   234 000028BD 655465787441747472- <3>
   234 000028C6 696275746500        <3>
   235                              <3>  %rotate 1
   233 000028CC 0000                <3>  HN_win32_%1: dw 0
   234 000028CE 536574436F6E736F6C- <3>  db %str(%1), 0
   234 000028D7 6557696E646F77496E- <3>
   234 000028E0 666F00              <3>
   235                              <3>  %rotate 1
   233 000028E3 0000                <3>  HN_win32_%1: dw 0
   234 000028E5 4D756C746942797465- <3>  db %str(%1), 0
   234 000028EE 546F57696465436861- <3>
   234 000028F7 7200                <3>
   235                              <3>  %rotate 1
   233 000028F9 0000                <3>  HN_win32_%1: dw 0
   234 000028FB 57616974466F725369- <3>  db %str(%1), 0
   234 00002904 6E676C654F626A6563- <3>
   234 0000290D 7400                <3>
   235                              <3>  %rotate 1
   233 0000290F 0000                <3>  HN_win32_%1: dw 0
   234 00002911 5772697465436F6E73- <3>  db %str(%1), 0
   234 0000291A 6F6C654100          <3>
   235                              <3>  %rotate 1
   233 0000291F 0000                <3>  HN_win32_%1: dw 0
   234 00002921 5772697465436F6E73- <3>  db %str(%1), 0
   234 0000292A 6F6C655700          <3>
   235                              <3>  %rotate 1
   233 0000292F 0000                <3>  HN_win32_%1: dw 0
   234 00002931 577269746546696C65- <3>  db %str(%1), 0
   234 0000293A 00                  <3>
   235                              <3>  %rotate 1
   237                              <2>  %endif
   238                              <2> %endif
    38                              <1> HNSTR USER32_FUNCS
   227                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   228                              <2>  EMIT_ERROR 'HNSTR is only used for Windows 10+ 64-Bit development.'
   229                              <2> %else
   230                              <2>  %if __pre_stop == 0
   231                              <2>  %assign __n %0
   232                              <2>  %rep __n
   233                              <2>  HN_win32_%1: dw 0
   234                              <2>  db %str(%1), 0
   235                              <2>  %rotate 1
   236                              <2>  %endrep
   233 0000293B 0000                <3>  HN_win32_%1: dw 0
   234 0000293D 43726561746557696E- <3>  db %str(%1), 0
   234 00002946 646F7745785700      <3>
   235                              <3>  %rotate 1
   233 0000294D 0000                <3>  HN_win32_%1: dw 0
   234 0000294F 44656657696E646F77- <3>  db %str(%1), 0
   234 00002958 50726F635700        <3>
   235                              <3>  %rotate 1
   233 0000295E 0000                <3>  HN_win32_%1: dw 0
   234 00002960 44697370617463684D- <3>  db %str(%1), 0
   234 00002969 6573736167655700    <3>
   235                              <3>  %rotate 1
   233 00002971 0000                <3>  HN_win32_%1: dw 0
   234 00002973 447261774D656E7542- <3>  db %str(%1), 0
   234 0000297C 617200              <3>
   235                              <3>  %rotate 1
   233 0000297F 0000                <3>  HN_win32_%1: dw 0
   234 00002981 456E61626C654D656E- <3>  db %str(%1), 0
   234 0000298A 754974656D00        <3>
   235                              <3>  %rotate 1
   233 00002990 0000                <3>  HN_win32_%1: dw 0
   234 00002992 46696C6C5265637400  <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 0000299B 0000                <3>  HN_win32_%1: dw 0
   234 0000299D 476574436C6173734C- <3>  db %str(%1), 0
   234 000029A6 6F6E675074725700    <3>
   235                              <3>  %rotate 1
   233 000029AE 0000                <3>  HN_win32_%1: dw 0
   234 000029B0 476574436C69656E74- <3>  db %str(%1), 0
   234 000029B9 5265637400          <3>
   235                              <3>  %rotate 1
   233 000029BE 0000                <3>  HN_win32_%1: dw 0
   234 000029C0 4765744D6573736167- <3>  db %str(%1), 0
   234 000029C9 655700              <3>
   235                              <3>  %rotate 1
   233 000029CC 0000                <3>  HN_win32_%1: dw 0
   234 000029CE 4765744D6F6E69746F- <3>  db %str(%1), 0
   234 000029D7 72496E666F5700      <3>
   235                              <3>  %rotate 1
   233 000029DE 0000                <3>  HN_win32_%1: dw 0
   234 000029E0 476574537973436F6C- <3>  db %str(%1), 0
   234 000029E9 6F72427275736800    <3>
   235                              <3>  %rotate 1
   233 000029F1 0000                <3>  HN_win32_%1: dw 0
   234 000029F3 47657453797374656D- <3>  db %str(%1), 0
   234 000029FC 4D656E7500          <3>
   235                              <3>  %rotate 1
   233 00002A01 0000                <3>  HN_win32_%1: dw 0
   234 00002A03 47657457696E646F77- <3>  db %str(%1), 0
   234 00002A0C 4C6F6E675074724100  <3>
   235                              <3>  %rotate 1
   233 00002A15 0000                <3>  HN_win32_%1: dw 0
   234 00002A17 47657457696E646F77- <3>  db %str(%1), 0
   234 00002A20 5265637400          <3>
   235                              <3>  %rotate 1
   233 00002A25 0000                <3>  HN_win32_%1: dw 0
   234 00002A27 4C6F6164437572736F- <3>  db %str(%1), 0
   234 00002A30 725700              <3>
   235                              <3>  %rotate 1
   233 00002A33 0000                <3>  HN_win32_%1: dw 0
   234 00002A35 4D657373616765426F- <3>  db %str(%1), 0
   234 00002A3E 784100              <3>
   235                              <3>  %rotate 1
   233 00002A41 0000                <3>  HN_win32_%1: dw 0
   234 00002A43 4D657373616765426F- <3>  db %str(%1), 0
   234 00002A4C 785700              <3>
   235                              <3>  %rotate 1
   233 00002A4F 0000                <3>  HN_win32_%1: dw 0
   234 00002A51 4D6F6E69746F724672- <3>  db %str(%1), 0
   234 00002A5A 6F6D57696E646F7700  <3>
   235                              <3>  %rotate 1
   233 00002A63 0000                <3>  HN_win32_%1: dw 0
   234 00002A65 4D6F766557696E646F- <3>  db %str(%1), 0
   234 00002A6E 7700                <3>
   235                              <3>  %rotate 1
   233 00002A70 0000                <3>  HN_win32_%1: dw 0
   234 00002A72 526567697374657243- <3>  db %str(%1), 0
   234 00002A7B 6C61737345785700    <3>
   235                              <3>  %rotate 1
   233 00002A83 0000                <3>  HN_win32_%1: dw 0
   234 00002A85 53657450726F636573- <3>  db %str(%1), 0
   234 00002A8E 734470694177617265- <3>
   234 00002A97 6E657373436F6E7465- <3>
   234 00002AA0 787400              <3>
   235                              <3>  %rotate 1
   233 00002AA3 0000                <3>  HN_win32_%1: dw 0
   234 00002AA5 53657457696E646F77- <3>  db %str(%1), 0
   234 00002AAE 4C6F6E675074724100  <3>
   235                              <3>  %rotate 1
   233 00002AB7 0000                <3>  HN_win32_%1: dw 0
   234 00002AB9 53657457696E646F77- <3>  db %str(%1), 0
   234 00002AC2 506F7300            <3>
   235                              <3>  %rotate 1
   233 00002AC6 0000                <3>  HN_win32_%1: dw 0
   234 00002AC8 53686F7757696E646F- <3>  db %str(%1), 0
   234 00002AD1 7700                <3>
   235                              <3>  %rotate 1
   233 00002AD3 0000                <3>  HN_win32_%1: dw 0
   234 00002AD5 506F7374517569744D- <3>  db %str(%1), 0
   234 00002ADE 65737361676500      <3>
   235                              <3>  %rotate 1
   233 00002AE5 0000                <3>  HN_win32_%1: dw 0
   234 00002AE7 5472616E736C617465- <3>  db %str(%1), 0
   234 00002AF0 4D65737361676500    <3>
   235                              <3>  %rotate 1
   233 00002AF8 0000                <3>  HN_win32_%1: dw 0
   234 00002AFA 55706461746557696E- <3>  db %str(%1), 0
   234 00002B03 646F7700            <3>
   235                              <3>  %rotate 1
   233 00002B07 0000                <3>  HN_win32_%1: dw 0
   234 00002B09 77737072696E746657- <3>  db %str(%1), 0
   234 00002B12 00                  <3>
   235                              <3>  %rotate 1
   237                              <2>  %endif
   238                              <2> %endif
    39                              <1> HNSTR MSVCRT_FUNCS
   227                              <2> %if ((DOS_SHELL == 1) && (__pre_stop == 0))
   228                              <2>  EMIT_ERROR 'HNSTR is only used for Windows 10+ 64-Bit development.'
   229                              <2> %else
   230                              <2>  %if __pre_stop == 0
   231                              <2>  %assign __n %0
   232                              <2>  %rep __n
   233                              <2>  HN_win32_%1: dw 0
   234                              <2>  db %str(%1), 0
   235                              <2>  %rotate 1
   236                              <2>  %endrep
   233 00002B13 0000                <3>  HN_win32_%1: dw 0
   234 00002B15 666765747300        <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 00002B1B 0000                <3>  HN_win32_%1: dw 0
   234 00002B1D 7363616E6600        <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 00002B23 0000                <3>  HN_win32_%1: dw 0
   234 00002B25 737072696E746600    <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 00002B2D 0000                <3>  HN_win32_%1: dw 0
   234 00002B2F 7072696E746600      <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   233 00002B36 0000                <3>  HN_win32_%1: dw 0
   234 00002B38 7075747300          <3>  db %str(%1), 0
   235                              <3>  %rotate 1
   237                              <2>  %endif
   238                              <2> %endif
    40                              <1> 
    41                              <1> ; -----------------------------------------------------------------------------
    42                              <1> ; DLL names
    43                              <1> ; -----------------------------------------------------------------------------
    44 00002B3D 6B65726E656C33322E- <1> dll_win32_kernel32: db 'kernel32.dll',0
    44 00002B46 646C6C00            <1>
    45 00002B4A 7573657233322E646C- <1> dll_win32_user32:   db 'user32.dll',0
    45 00002B53 6C00                <1>
    46 00002B55 6D73766372742E646C- <1> dll_win32_msvcrt:   db 'msvcrt.dll',0
    46 00002B5E 6C00                <1>
    47                              <1> 
    48                              <1> idata_end:
    49                              <1> ; -----------------------------------------------------------------------------
    34                                  %include 'data64.asm'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  data64.asm
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8 00002B60 00<rep A0h>         <1> times (DATA_RAW_PTR-($-$$)) db 0
     9                              <1> data_start:
    10                              <1> 
    11                              <1> %include 'data.inc'
    12                              <1> 
    13                              <1> ASTR cap2A          , "ein Text", 13,10,0
   512                              <2> %if __pre_stop == 0
   513 00002C00 65696E20546578740D- <2>  _cA_%1: db %2, 0
   513 00002C09 0A0000              <2>
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    14                              <1> 
    15                              <1> WSTR fmtW           , "Win32-Fehler: 0x%08X (%u)", 0      ; Format-String (UTF-16)
   327                              <2>  %if __pre_stop == 0
   328                              <2>  %push WSTR
   329                              <2> 
   330                              <2> 
   331                              <2>  %define _WSTR_LBL _cW_%1
   332                              <2>  %define _WSTR_END _cW_%1_end
   333                              <2>  %define _WSTR_LENB _cW_%1_length_bytes
   334                              <2>  %define _WSTR_LENW _cW_%1_length_words
   335                              <2> 
   336                              <2> _WSTR_LBL:
   337                              <2> 
   338                              <2>  %assign %$nargs %0-1
   339                              <2>  %rotate 1
   340                              <2> 
   341                              <2>  %rep %$nargs
   342                              <2>  %ifstr %1
   343                              <2>  %strlen %$n %1
   344                              <2>  %assign %$i 0
   345                              <2>  %rep %$n
   346                              <2>  %substr %$c %1 %$i+1,1
   347                              <2>  dw %$c
   348                              <2>  %assign %$i %$i+1
   349                              <2>  %endrep
   350                              <2>  %elifnum %1
   351                              <2>  dw %1
   352                              <2>  %else
   353                              <2>  dw %1
   354                              <2>  %endif
   355                              <2>  %rotate 1
   356                              <2>  %endrep
   342                              <3>  %ifstr %1
   343                              <3>  %strlen %$n %1
   344                              <3>  %assign %$i 0
   345                              <3>  %rep %$n
   346                              <3>  %substr %$c %1 %$i+1,1
   347                              <3>  dw %$c
   348                              <3>  %assign %$i %$i+1
   349                              <3>  %endrep
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C0C 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C0E 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C10 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C12 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C14 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C16 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C18 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C1A 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C1C 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C1E 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C20 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C22 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C24 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C26 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C28 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C2A 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C2C 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C2E 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C30 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C32 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C34 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C36 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C38 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C3A 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C3C 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   350                              <3>  %elifnum %1
   351                              <3>  dw %1
   352                              <3>  %else
   353                              <3>  dw %1
   354                              <3>  %endif
   355                              <3>  %rotate 1
   357                              <2> 
   358 00002C3E 0000                <2>  dw 0
   359                              <2> 
   360                              <2> _WSTR_END:
   361                              <2> _WSTR_LENB equ (_WSTR_END - _WSTR_LBL - 2)
   362                              <2> _WSTR_LENW equ (_WSTR_LENB/2)
   363                              <2> 
   364                              <2> 
   365                              <2>  %undef _WSTR_LBL
   366                              <2>  %undef _WSTR_END
   367                              <2>  %undef _WSTR_LENB
   368                              <2>  %undef _WSTR_LENW
   369                              <2>  %pop
   370                              <2>  %endif
    16                              <1> WSTR ErrTitleW      , "Fehler"
   327                              <2>  %if __pre_stop == 0
   328                              <2>  %push WSTR
   329                              <2> 
   330                              <2> 
   331                              <2>  %define _WSTR_LBL _cW_%1
   332                              <2>  %define _WSTR_END _cW_%1_end
   333                              <2>  %define _WSTR_LENB _cW_%1_length_bytes
   334                              <2>  %define _WSTR_LENW _cW_%1_length_words
   335                              <2> 
   336                              <2> _WSTR_LBL:
   337                              <2> 
   338                              <2>  %assign %$nargs %0-1
   339                              <2>  %rotate 1
   340                              <2> 
   341                              <2>  %rep %$nargs
   342                              <2>  %ifstr %1
   343                              <2>  %strlen %$n %1
   344                              <2>  %assign %$i 0
   345                              <2>  %rep %$n
   346                              <2>  %substr %$c %1 %$i+1,1
   347                              <2>  dw %$c
   348                              <2>  %assign %$i %$i+1
   349                              <2>  %endrep
   350                              <2>  %elifnum %1
   351                              <2>  dw %1
   352                              <2>  %else
   353                              <2>  dw %1
   354                              <2>  %endif
   355                              <2>  %rotate 1
   356                              <2>  %endrep
   342                              <3>  %ifstr %1
   343                              <3>  %strlen %$n %1
   344                              <3>  %assign %$i 0
   345                              <3>  %rep %$n
   346                              <3>  %substr %$c %1 %$i+1,1
   347                              <3>  dw %$c
   348                              <3>  %assign %$i %$i+1
   349                              <3>  %endrep
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C40 4600                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C42 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C44 6800                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C46 6C00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C48 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C4A 7200                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   350                              <3>  %elifnum %1
   351                              <3>  dw %1
   352                              <3>  %else
   353                              <3>  dw %1
   354                              <3>  %endif
   355                              <3>  %rotate 1
   357                              <2> 
   358 00002C4C 0000                <2>  dw 0
   359                              <2> 
   360                              <2> _WSTR_END:
   361                              <2> _WSTR_LENB equ (_WSTR_END - _WSTR_LBL - 2)
   362                              <2> _WSTR_LENW equ (_WSTR_LENB/2)
   363                              <2> 
   364                              <2> 
   365                              <2>  %undef _WSTR_LBL
   366                              <2>  %undef _WSTR_END
   367                              <2>  %undef _WSTR_LENB
   368                              <2>  %undef _WSTR_LENW
   369                              <2>  %pop
   370                              <2>  %endif
    17                              <1> 
    18                              <1> WSTR errmsgW        , 'RegisterClassExW failed'
   327                              <2>  %if __pre_stop == 0
   328                              <2>  %push WSTR
   329                              <2> 
   330                              <2> 
   331                              <2>  %define _WSTR_LBL _cW_%1
   332                              <2>  %define _WSTR_END _cW_%1_end
   333                              <2>  %define _WSTR_LENB _cW_%1_length_bytes
   334                              <2>  %define _WSTR_LENW _cW_%1_length_words
   335                              <2> 
   336                              <2> _WSTR_LBL:
   337                              <2> 
   338                              <2>  %assign %$nargs %0-1
   339                              <2>  %rotate 1
   340                              <2> 
   341                              <2>  %rep %$nargs
   342                              <2>  %ifstr %1
   343                              <2>  %strlen %$n %1
   344                              <2>  %assign %$i 0
   345                              <2>  %rep %$n
   346                              <2>  %substr %$c %1 %$i+1,1
   347                              <2>  dw %$c
   348                              <2>  %assign %$i %$i+1
   349                              <2>  %endrep
   350                              <2>  %elifnum %1
   351                              <2>  dw %1
   352                              <2>  %else
   353                              <2>  dw %1
   354                              <2>  %endif
   355                              <2>  %rotate 1
   356                              <2>  %endrep
   342                              <3>  %ifstr %1
   343                              <3>  %strlen %$n %1
   344                              <3>  %assign %$i 0
   345                              <3>  %rep %$n
   346                              <3>  %substr %$c %1 %$i+1,1
   347                              <3>  dw %$c
   348                              <3>  %assign %$i %$i+1
   349                              <3>  %endrep
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C4E 5200                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C50 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C52 6700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C54 6900                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C56 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C58 7400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C5A 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C5C 7200                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C5E 4300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C60 6C00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C62 6100                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C64 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C66 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C68 4500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C6A 7800                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C6C 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C6E 2000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C70 6600                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C72 6100                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C74 6900                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C76 6C00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C78 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C7A 6400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   350                              <3>  %elifnum %1
   351                              <3>  dw %1
   352                              <3>  %else
   353                              <3>  dw %1
   354                              <3>  %endif
   355                              <3>  %rotate 1
   357                              <2> 
   358 00002C7C 0000                <2>  dw 0
   359                              <2> 
   360                              <2> _WSTR_END:
   361                              <2> _WSTR_LENB equ (_WSTR_END - _WSTR_LBL - 2)
   362                              <2> _WSTR_LENW equ (_WSTR_LENB/2)
   363                              <2> 
   364                              <2> 
   365                              <2>  %undef _WSTR_LBL
   366                              <2>  %undef _WSTR_END
   367                              <2>  %undef _WSTR_LENB
   368                              <2>  %undef _WSTR_LENW
   369                              <2>  %pop
   370                              <2>  %endif
    19                              <1> WSTR titleW         , 'NASM PE64 GUI without Linker'
   327                              <2>  %if __pre_stop == 0
   328                              <2>  %push WSTR
   329                              <2> 
   330                              <2> 
   331                              <2>  %define _WSTR_LBL _cW_%1
   332                              <2>  %define _WSTR_END _cW_%1_end
   333                              <2>  %define _WSTR_LENB _cW_%1_length_bytes
   334                              <2>  %define _WSTR_LENW _cW_%1_length_words
   335                              <2> 
   336                              <2> _WSTR_LBL:
   337                              <2> 
   338                              <2>  %assign %$nargs %0-1
   339                              <2>  %rotate 1
   340                              <2> 
   341                              <2>  %rep %$nargs
   342                              <2>  %ifstr %1
   343                              <2>  %strlen %$n %1
   344                              <2>  %assign %$i 0
   345                              <2>  %rep %$n
   346                              <2>  %substr %$c %1 %$i+1,1
   347                              <2>  dw %$c
   348                              <2>  %assign %$i %$i+1
   349                              <2>  %endrep
   350                              <2>  %elifnum %1
   351                              <2>  dw %1
   352                              <2>  %else
   353                              <2>  dw %1
   354                              <2>  %endif
   355                              <2>  %rotate 1
   356                              <2>  %endrep
   342                              <3>  %ifstr %1
   343                              <3>  %strlen %$n %1
   344                              <3>  %assign %$i 0
   345                              <3>  %rep %$n
   346                              <3>  %substr %$c %1 %$i+1,1
   347                              <3>  dw %$c
   348                              <3>  %assign %$i %$i+1
   349                              <3>  %endrep
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C7E 4E00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C80 4100                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C82 5300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C84 4D00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C86 2000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C88 5000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C8A 4500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C8C 3600                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C8E 3400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C90 2000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C92 4700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C94 5500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C96 4900                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C98 2000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C9A 7700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C9C 6900                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002C9E 7400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CA0 6800                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CA2 6F00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CA4 7500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CA6 7400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CA8 2000                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CAA 4C00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CAC 6900                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CAE 6E00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CB0 6B00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CB2 6500                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CB4 7200                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   350                              <3>  %elifnum %1
   351                              <3>  dw %1
   352                              <3>  %else
   353                              <3>  dw %1
   354                              <3>  %endif
   355                              <3>  %rotate 1
   357                              <2> 
   358 00002CB6 0000                <2>  dw 0
   359                              <2> 
   360                              <2> _WSTR_END:
   361                              <2> _WSTR_LENB equ (_WSTR_END - _WSTR_LBL - 2)
   362                              <2> _WSTR_LENW equ (_WSTR_LENB/2)
   363                              <2> 
   364                              <2> 
   365                              <2>  %undef _WSTR_LBL
   366                              <2>  %undef _WSTR_END
   367                              <2>  %undef _WSTR_LENB
   368                              <2>  %undef _WSTR_LENW
   369                              <2>  %pop
   370                              <2>  %endif
    20                              <1> WSTR winclassW      , 'NasmWndClass'
   327                              <2>  %if __pre_stop == 0
   328                              <2>  %push WSTR
   329                              <2> 
   330                              <2> 
   331                              <2>  %define _WSTR_LBL _cW_%1
   332                              <2>  %define _WSTR_END _cW_%1_end
   333                              <2>  %define _WSTR_LENB _cW_%1_length_bytes
   334                              <2>  %define _WSTR_LENW _cW_%1_length_words
   335                              <2> 
   336                              <2> _WSTR_LBL:
   337                              <2> 
   338                              <2>  %assign %$nargs %0-1
   339                              <2>  %rotate 1
   340                              <2> 
   341                              <2>  %rep %$nargs
   342                              <2>  %ifstr %1
   343                              <2>  %strlen %$n %1
   344                              <2>  %assign %$i 0
   345                              <2>  %rep %$n
   346                              <2>  %substr %$c %1 %$i+1,1
   347                              <2>  dw %$c
   348                              <2>  %assign %$i %$i+1
   349                              <2>  %endrep
   350                              <2>  %elifnum %1
   351                              <2>  dw %1
   352                              <2>  %else
   353                              <2>  dw %1
   354                              <2>  %endif
   355                              <2>  %rotate 1
   356                              <2>  %endrep
   342                              <3>  %ifstr %1
   343                              <3>  %strlen %$n %1
   344                              <3>  %assign %$i 0
   345                              <3>  %rep %$n
   346                              <3>  %substr %$c %1 %$i+1,1
   347                              <3>  dw %$c
   348                              <3>  %assign %$i %$i+1
   349                              <3>  %endrep
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CB8 4E00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CBA 6100                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CBC 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CBE 6D00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CC0 5700                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CC2 6E00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CC4 6400                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CC6 4300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CC8 6C00                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CCA 6100                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CCC 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   346                              <4>  %substr %$c %1 %$i+1,1
   347 00002CCE 7300                <4>  dw %$c
   348                              <4>  %assign %$i %$i+1
   350                              <3>  %elifnum %1
   351                              <3>  dw %1
   352                              <3>  %else
   353                              <3>  dw %1
   354                              <3>  %endif
   355                              <3>  %rotate 1
   357                              <2> 
   358 00002CD0 0000                <2>  dw 0
   359                              <2> 
   360                              <2> _WSTR_END:
   361                              <2> _WSTR_LENB equ (_WSTR_END - _WSTR_LBL - 2)
   362                              <2> _WSTR_LENW equ (_WSTR_LENB/2)
   363                              <2> 
   364                              <2> 
   365                              <2>  %undef _WSTR_LBL
   366                              <2>  %undef _WSTR_END
   367                              <2>  %undef _WSTR_LENB
   368                              <2>  %undef _WSTR_LENW
   369                              <2>  %pop
   370                              <2>  %endif
    21                              <1> 
    22                              <1> ASTR prompt         , "Eingabe: ",0
   512                              <2> %if __pre_stop == 0
   513 00002CD2 45696E676162653A20- <2>  _cA_%1: db %2, 0
   513 00002CDB 0000                <2>
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    23                              <1> ; -----------------------------------------------------------------------------
    24                              <1> ; Setze: Reset, Cursor Home, Farbe (helles Cyan auf blau), löschen, wieder Home
    25                              <1> ;  - ESC[0m       -> Attribute reset
    26                              <1> ;  - ESC[48;5;4m  -> Hintergrund Blau (xterm 256)
    27                              <1> ;  - ESC[38;5;14m -> Vordergrund Hell-Cyan
    28                              <1> ;  - ESC[2J       -> Bildschirm löschen (mit Spaces + aktuellen Attributen)
    29                              <1> ;  - ESC[H        -> Cursor 1;1
    30                              <1> ; -----------------------------------------------------------------------------
    31                              <1> ASTR consoleColor_0,  27,'[0m'
   512                              <2> %if __pre_stop == 0
   513 00002CDD 1B5B306D00          <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    32                              <1> ASTR consoleColor_1,  27,'[1;'
   512                              <2> %if __pre_stop == 0
   513 00002CE2 1B5B313B00          <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    33                              <1> ASTR consoleColor_2,  "m"
   512                              <2> %if __pre_stop == 0
   513 00002CE7 6D00                <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    34                              <1> ASTR consoleColor_3,  27,'[H',27,'[2J',27,'[H'
   512                              <2> %if __pre_stop == 0
   513 00002CE9 1B5B481B5B324A1B5B- <2>  _cA_%1: db %2, 0
   513 00002CF2 4800                <2>
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    35                              <1> ASTR buffer_semi, ";"
   512                              <2> %if __pre_stop == 0
   513 00002CF4 3B00                <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    36                              <1> ; -----------------------------------------------------------------------------
    37                              <1> ; DOS ANSI foreground color's   0..15
    38                              <1> ; -----------------------------------------------------------------------------
    39                              <1> ASTR console_color_30 , "30"
   512                              <2> %if __pre_stop == 0
   513 00002CF6 333000              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    40                              <1> ASTR console_color_31 , "31"
   512                              <2> %if __pre_stop == 0
   513 00002CF9 333100              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    41                              <1> ASTR console_color_32 , "32"
   512                              <2> %if __pre_stop == 0
   513 00002CFC 333200              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    42                              <1> ASTR console_color_33 , "33"
   512                              <2> %if __pre_stop == 0
   513 00002CFF 333300              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    43                              <1> ASTR console_color_34 , "34"
   512                              <2> %if __pre_stop == 0
   513 00002D02 333400              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    44                              <1> ASTR console_color_35 , "35"
   512                              <2> %if __pre_stop == 0
   513 00002D05 333500              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    45                              <1> ASTR console_color_36 , "36"
   512                              <2> %if __pre_stop == 0
   513 00002D08 333600              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    46                              <1> ASTR console_color_37 , "37"
   512                              <2> %if __pre_stop == 0
   513 00002D0B 333700              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    47                              <1> ; -----------------------------------------------------------------------------
    48                              <1> ASTR console_color_90 , "90"
   512                              <2> %if __pre_stop == 0
   513 00002D0E 393000              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    49                              <1> ASTR console_color_91 , "91"
   512                              <2> %if __pre_stop == 0
   513 00002D11 393100              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    50                              <1> ASTR console_color_92 , "92"
   512                              <2> %if __pre_stop == 0
   513 00002D14 393200              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    51                              <1> ASTR console_color_93 , "93"
   512                              <2> %if __pre_stop == 0
   513 00002D17 393300              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    52                              <1> ASTR console_color_94 , "94"
   512                              <2> %if __pre_stop == 0
   513 00002D1A 393400              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    53                              <1> ASTR console_color_95 , "95"
   512                              <2> %if __pre_stop == 0
   513 00002D1D 393500              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    54                              <1> ASTR console_color_96 , "96"
   512                              <2> %if __pre_stop == 0
   513 00002D20 393600              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    55                              <1> ASTR console_color_97 , "97"
   512                              <2> %if __pre_stop == 0
   513 00002D23 393700              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    56                              <1> 
    57                              <1> ; -----------------------------------------------------------------------------
    58                              <1> ; DOS ANSI background color's   0..15
    59                              <1> ; -----------------------------------------------------------------------------
    60                              <1> ASTR console_color_40 , "40"
   512                              <2> %if __pre_stop == 0
   513 00002D26 343000              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    61                              <1> ASTR console_color_41 , "41"
   512                              <2> %if __pre_stop == 0
   513 00002D29 343100              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    62                              <1> ASTR console_color_42 , "42"
   512                              <2> %if __pre_stop == 0
   513 00002D2C 343200              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    63                              <1> ASTR console_color_43 , "43"
   512                              <2> %if __pre_stop == 0
   513 00002D2F 343300              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    64                              <1> ASTR console_color_44 , "44"
   512                              <2> %if __pre_stop == 0
   513 00002D32 343400              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    65                              <1> ASTR console_color_45 , "45"
   512                              <2> %if __pre_stop == 0
   513 00002D35 343500              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    66                              <1> ASTR console_color_46 , "46"
   512                              <2> %if __pre_stop == 0
   513 00002D38 343600              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    67                              <1> ASTR console_color_47 , "47"
   512                              <2> %if __pre_stop == 0
   513 00002D3B 343700              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    68                              <1> 
    69                              <1> ASTR console_color_100, "100"
   512                              <2> %if __pre_stop == 0
   513 00002D3E 31303000            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    70                              <1> ASTR console_color_101, "101"
   512                              <2> %if __pre_stop == 0
   513 00002D42 31303100            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    71                              <1> ASTR console_color_102, "102"
   512                              <2> %if __pre_stop == 0
   513 00002D46 31303200            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    72                              <1> ASTR console_color_103, "103"
   512                              <2> %if __pre_stop == 0
   513 00002D4A 31303300            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    73                              <1> ASTR console_color_104, "104"
   512                              <2> %if __pre_stop == 0
   513 00002D4E 31303400            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    74                              <1> ASTR console_color_105, "105"
   512                              <2> %if __pre_stop == 0
   513 00002D52 31303500            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    75                              <1> ASTR console_color_106, "106"
   512                              <2> %if __pre_stop == 0
   513 00002D56 31303600            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    76                              <1> ASTR console_color_107, "107"
   512                              <2> %if __pre_stop == 0
   513 00002D5A 31303700            <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    77                              <1> 
    78 00002D5E 000000004F001800    <1> Rect80x25:          dw 0, 0, 79, 24         ; SMALL_RECT {Left,Top,Right,Bottom} = {0,0,79,24}
    79 00002D66 0000000000000000    <1> pMsg:               dq 0                    ; LPWSTR, wird von FormatMessageW allokiert
    80 00002D6E 6F                  <1> spaceW:             db 'o'                  ; wide char ' '
    81                              <1> 
    82                              <1> ; -----------------------------------------------------------------------------
    83                              <1> ; default console values ...
    84                              <1> ; -----------------------------------------------------------------------------
    85 00002D6F 2800                <1> _cA_console_bg:     db ATTR_BG_BLACK, 0
    86 00002D71 5D00                <1> _cA_console_fg:     db ATTR_FG_LIGHT_YELLOW, 0
    87                              <1> 
    88 00002D73 257300              <1> _fmt: db "%s", 0
    89                              <1> 
    90                              <1> ASTR buffer , ATTR_BG_BLACK, ATTR_FG_LIGHT_YELLOW
   512                              <2> %if __pre_stop == 0
   513 00002D76 285D00              <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    91                              <1> ASTR buffer2, " oI_01", 0
   512                              <2> %if __pre_stop == 0
   513 00002D79 206F495F30310000    <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    92                              <1> 
    93                              <1> ASTR buffer_2, "moin", 0
   512                              <2> %if __pre_stop == 0
   513 00002D81 6D6F696E0000        <2>  _cA_%1: db %2, 0
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    94                              <1> ASTR buffer_1, "Hello %s", 0
   512                              <2> %if __pre_stop == 0
   513 00002D87 48656C6C6F20257300- <2>  _cA_%1: db %2, 0
   513 00002D90 00                  <2>
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    95                              <1> ASTR buffer_3, " smile"  , 13, 10, 0
   512                              <2> %if __pre_stop == 0
   513 00002D91 20736D696C650D0A00- <2>  _cA_%1: db %2, 0
   513 00002D9A 00                  <2>
   514                              <2>  _cA_%1_end:
   515                              <2>  _cA_%1_length equ (_cA_%1_end - _cA_%1 - 1)
   516                              <2> %endif
    96                              <1> 
    97                              <1> data_end:
    98 00002D9B 00<rep 65h>         <1> times (ALIGN_UP($-$$,FILEALIGN)-($-$$)) db 0
    35                                  
    36                                  section .bss
    37                                  %include 'bss64.asm'
     1                              <1> ; -----------------------------------------------------------------------------
     2                              <1> ; \file  bss64.asm
     3                              <1> ; \note  (c) 2025 by Jens Kallup - paule32
     4                              <1> ;        all rights reserved.
     5                              <1> ;
     6                              <1> ; \desc  Create a dBASE MS-Windows 11 64-bit Pro EXE.
     7                              <1> ; -----------------------------------------------------------------------------
     8                              <1> 
     9                              <1> bss_start:
    10                              <1> 
    11                              <1> ; -----------------------------------------------------------------------------
    12                              <1> ; Strukturen (kompakt modelliert)
    13                              <1> ; -----------------------------------------------------------------------------
    14                              <1> struc COORD
    15 00000000 ????                <1>     .X                  resw 1
    16 00000002 ????                <1>     .Y                  resw 1
    17                              <1> endstruc
    18                              <1> 
    19                              <1> struc SMALL_RECT
    20 00000000 ????                <1>     .Left               resw 1
    21 00000002 ????                <1>     .Top                resw 1
    22 00000004 ????                <1>     .Right              resw 1
    23 00000006 ????                <1>     .Bot                resw 1
    24                              <1> endstruc
    25                              <1> 
    26                              <1> ; -----------------------------------------------------------------------------
    27                              <1> ; CONSOLE_SCREEN_BUFFER_INFO (Layout wie in WinSDK; 22 Bytes + Padding)
    28                              <1> ; -----------------------------------------------------------------------------
    29                              <1> struc CSBI
    30 00000000 ????????            <1>     .dwSize             resw 2      ; COORD
    31 00000004 ????????            <1>     .dwCursorPos        resw 2      ; COORD
    32 00000008 ????                <1>     .wAttributes        resw 1
    33 0000000A ????????????????    <1>     .srWindow           resw 4      ; SMALL_RECT
    34 00000012 ????????            <1>     .dwMaxWindowSize    resw 2      ; COORD
    35 00000016 ????                <1>     ._pad               resw 1      ; pad to 24 bytes (alignment)
    36                              <1> endstruc
    37                              <1> ; -----------------------------------------------------------------------------
    38 00000000 <res 18h>           <1> csbi:               resb CSBI_size
    39                              <1> 
    40 00000018 <res 80h>           <1> _cA_buffer_dst:     resb 128
    41                              <1> 
    42 00000098 <res 80h>           <1> _cA_buffer_A:       resb 128
    43 00000118 <res 80h>           <1> _cA_buffer_B:       resb 128
    44                              <1> 
    45                              <1> ;_cA_src_length:     resb 256
    46                              <1> ;_cA_dst_length:     resb 512
    47                              <1> 
    48 00000198 <res 80h>           <1> _cA_src:            resb 128
    49 00000218 <res 80h>           <1> _cA_dst:            resb 128
    50                              <1> 
    51 00000298 ????????            <1> mode_in:            resd 1
    52 0000029C ????????            <1> mode_out:           resd 1
    53                              <1> ; -----------------------------------------------------------------------------
    54 000002A0 ??                  <1> _cA_empty:          resb 1
    55                              <1> 
    56 000002A1 <res 40h>           <1> _cA_buf:            resb 64
    57                              <1> 
    58 000002E1 ????????????????    <1> hIn:                resq 1
    59 000002E9 ????????????????    <1> hOut:               resq 1
    60 000002F1 ????????            <1> read:               resd 1
    61 000002F5 ????????            <1> tmpConsoleMode:     resd 1
    62 000002F9 ????????            <1> last_error:         resd 1
    63                              <1> 
    64 000002FD ????????????????    <1> written:            resq 1
    65                              <1> bss_end:
    66                              <1> 
    38                                  
    39                                  ; -----------------------------------------------------------------------------
    40                                  section .text
    41                                  file_end:
